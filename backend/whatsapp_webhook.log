2025-08-19 02:55:17,654 - server - INFO - Connected to MongoDB successfully
2025-08-19 02:55:45,062 - server - INFO - Connected to MongoDB successfully
2025-08-19 02:56:38,986 - server - INFO - Connected to MongoDB successfully
2025-08-19 02:56:48,965 - server - INFO - Connected to MongoDB successfully
2025-08-19 02:57:04,039 - server - INFO - Connected to MongoDB successfully
2025-08-19 02:58:32,407 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:00:12,691 - server - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-19 03:00:12,692 - server - INFO - Received webhook verification request:
2025-08-19 03:00:12,692 - server - INFO -   - Mode: subscribe
2025-08-19 03:00:12,693 - server - INFO -   - Challenge: 1552828846
2025-08-19 03:00:12,694 - server - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-19 03:00:12,694 - server - INFO -   - Expected Token: demo_verify_token
2025-08-19 03:00:12,694 - server - INFO -   - Token Match: False
2025-08-19 03:00:12,695 - server - ERROR - Error loading .env file: 'utf-8' codec can't decode byte 0xff in position 0: invalid start byte
2025-08-19 03:00:12,696 - server - ERROR - Webhook verification FAILED
2025-08-19 03:00:12,696 - server - ERROR - Mode check: passed
2025-08-19 03:00:12,697 - server - ERROR - Token check: failed
2025-08-19 03:00:12,697 - server - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-19 03:01:09,957 - server - ERROR - Error loading environment variables: 'utf-8' codec can't decode byte 0xff in position 0: invalid start byte
2025-08-19 03:01:09,998 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:01:25,930 - server - ERROR - Error loading environment variables: 'utf-8' codec can't decode byte 0xff in position 0: invalid start byte
2025-08-19 03:01:25,949 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:02:04,332 - server - ERROR - Error loading environment variables: 'utf-8' codec can't decode byte 0xff in position 0: invalid start byte
2025-08-19 03:02:04,372 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:05:19,181 - server - ERROR - Error loading environment variables: 'utf-8' codec can't decode byte 0xff in position 0: invalid start byte
2025-08-19 03:05:19,224 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:06:18,483 - server - ERROR - Error loading environment variables: 'utf-8' codec can't decode byte 0xff in position 0: invalid start byte
2025-08-19 03:06:18,501 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:06:58,640 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 03:06:58,689 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:07:44,648 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 03:07:44,704 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:09:55,955 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 03:09:56,004 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:09:56,005 - server - INFO - No Google Sheets credentials provided; skipping Sheets initialization
2025-08-19 03:10:04,852 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 03:10:04,882 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:10:04,882 - server - INFO - No Google Sheets credentials provided; skipping Sheets initialization
2025-08-19 03:10:32,842 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 03:10:32,859 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:10:32,859 - server - INFO - No Google Sheets credentials provided; skipping Sheets initialization
2025-08-19 03:11:26,527 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 03:11:26,547 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:11:26,548 - server - WARNING - GOOGLE_SHEETS_CREDENTIALS set but file not found: AIzaSyAiP4ruu59Kf3eCHSvcVS-WLv81jtvGoWs
2025-08-19 03:12:26,326 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 03:12:26,344 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:12:26,345 - server - INFO - No Google Sheets credentials provided; skipping Sheets initialization
2025-08-19 03:16:08,509 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 03:16:08,549 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:16:08,550 - server - INFO - No Google Sheets credentials provided; skipping Sheets initialization
2025-08-19 03:16:19,180 - server - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-19 03:16:19,181 - server - INFO - Received webhook verification request:
2025-08-19 03:16:19,181 - server - INFO -   - Mode: subscribe
2025-08-19 03:16:19,181 - server - INFO -   - Challenge: 1828435430
2025-08-19 03:16:19,182 - server - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-19 03:16:19,182 - server - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-19 03:16:19,182 - server - INFO -   - Token Match: True
2025-08-19 03:16:19,184 - server - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-19 03:16:19,184 - server - INFO - Webhook verification SUCCESSFUL
2025-08-19 03:16:19,184 - server - INFO - Returning challenge: 1828435430
2025-08-19 03:16:19,185 - server - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-19 03:19:19,201 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 03:19:19,304 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:19:19,308 - server - INFO - No Google Sheets credentials provided; skipping Sheets initialization
2025-08-19 03:22:06,621 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 03:22:06,643 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:22:06,644 - server - INFO - No Google Sheets credentials provided; skipping Sheets initialization
2025-08-19 03:23:16,065 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 03:23:16,110 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:23:16,111 - server - INFO - No Google Sheets credentials provided; skipping Sheets initialization
2025-08-19 03:23:30,356 - server - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-19 03:23:30,357 - server - INFO - Received webhook verification request:
2025-08-19 03:23:30,357 - server - INFO -   - Mode: subscribe
2025-08-19 03:23:30,357 - server - INFO -   - Challenge: test_challenge_123
2025-08-19 03:23:30,357 - server - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-19 03:23:30,358 - server - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-19 03:23:30,358 - server - INFO -   - Token Match: True
2025-08-19 03:23:30,360 - server - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-19 03:23:30,360 - server - INFO - Webhook verification SUCCESSFUL
2025-08-19 03:23:30,360 - server - INFO - Returning challenge: test_challenge_123
2025-08-19 03:23:30,360 - server - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-19 03:25:41,439 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 03:25:41,469 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:25:41,470 - server - INFO - No Google Sheets credentials provided; skipping Sheets initialization
2025-08-19 03:25:55,352 - server - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-19 03:25:55,352 - server - INFO - Received webhook verification request:
2025-08-19 03:25:55,352 - server - INFO -   - Mode: subscribe
2025-08-19 03:25:55,353 - server - INFO -   - Challenge: test_challenge_123
2025-08-19 03:25:55,353 - server - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-19 03:25:55,353 - server - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-19 03:25:55,354 - server - INFO -   - Token Match: True
2025-08-19 03:25:55,355 - server - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-19 03:25:55,355 - server - INFO - Webhook verification SUCCESSFUL
2025-08-19 03:25:55,356 - server - INFO - Returning challenge: test_challenge_123
2025-08-19 03:25:55,356 - server - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-19 03:27:55,584 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 03:27:55,634 - server - INFO - Connected to MongoDB successfully
2025-08-19 03:27:55,634 - server - INFO - No Google Sheets credentials provided; skipping Sheets initialization
2025-08-19 03:28:11,787 - server - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-19 03:28:11,787 - server - INFO - Received webhook verification request:
2025-08-19 03:28:11,788 - server - INFO -   - Mode: subscribe
2025-08-19 03:28:11,788 - server - INFO -   - Challenge: test_challenge_123
2025-08-19 03:28:11,788 - server - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-19 03:28:11,789 - server - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-19 03:28:11,789 - server - INFO -   - Token Match: True
2025-08-19 03:28:11,790 - server - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-19 03:28:11,790 - server - INFO - Webhook verification SUCCESSFUL
2025-08-19 03:28:11,790 - server - INFO - Returning challenge: test_challenge_123
2025-08-19 03:28:11,791 - server - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-19 03:28:58,635 - server - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-19 03:28:58,635 - server - INFO - Received webhook verification request:
2025-08-19 03:28:58,637 - server - INFO -   - Mode: subscribe
2025-08-19 03:28:58,638 - server - INFO -   - Challenge: test_challenge_123
2025-08-19 03:28:58,638 - server - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-19 03:28:58,639 - server - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-19 03:28:58,640 - server - INFO -   - Token Match: True
2025-08-19 03:28:58,643 - server - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-19 03:28:58,643 - server - INFO - Webhook verification SUCCESSFUL
2025-08-19 03:28:58,644 - server - INFO - Returning challenge: test_challenge_123
2025-08-19 03:28:58,644 - server - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-19 04:08:14,842 - __main__ - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 04:08:14,874 - __main__ - INFO - Connected to MongoDB successfully
2025-08-19 04:08:14,874 - __main__ - INFO - No Google Sheets credentials provided; skipping Sheets initialization
2025-08-19 04:08:51,835 - __main__ - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 04:08:51,855 - __main__ - INFO - Connected to MongoDB successfully
2025-08-19 04:08:51,855 - __main__ - INFO - No Google Sheets credentials provided; skipping Sheets initialization
2025-08-19 04:08:59,797 - __main__ - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 04:08:59,819 - __main__ - INFO - Connected to MongoDB successfully
2025-08-19 04:08:59,820 - __main__ - INFO - No Google Sheets credentials provided; skipping Sheets initialization
2025-08-19 04:10:17,734 - __main__ - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-19 04:10:17,736 - __main__ - INFO - Received webhook verification request:
2025-08-19 04:10:17,737 - __main__ - INFO -   - Mode: subscribe
2025-08-19 04:10:17,737 - __main__ - INFO -   - Challenge: test_challenge_123
2025-08-19 04:10:17,737 - __main__ - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-19 04:10:17,738 - __main__ - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-19 04:10:17,738 - __main__ - INFO -   - Token Match: True
2025-08-19 04:10:17,740 - __main__ - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-19 04:10:17,740 - __main__ - INFO - Webhook verification SUCCESSFUL
2025-08-19 04:10:17,740 - __main__ - INFO - Returning challenge: test_challenge_123
2025-08-19 04:10:17,741 - __main__ - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-19 04:12:12,771 - __main__ - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-19 04:12:12,771 - __main__ - INFO - Received webhook verification request:
2025-08-19 04:12:12,772 - __main__ - INFO -   - Mode: subscribe
2025-08-19 04:12:12,772 - __main__ - INFO -   - Challenge: test_challenge_123
2025-08-19 04:12:12,772 - __main__ - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-19 04:12:12,773 - __main__ - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-19 04:12:12,773 - __main__ - INFO -   - Token Match: True
2025-08-19 04:12:12,808 - __main__ - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-19 04:12:12,808 - __main__ - INFO - Webhook verification SUCCESSFUL
2025-08-19 04:12:12,809 - __main__ - INFO - Returning challenge: test_challenge_123
2025-08-19 04:12:12,809 - __main__ - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-19 04:13:12,981 - __main__ - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-19 04:13:12,981 - __main__ - INFO - Received webhook verification request:
2025-08-19 04:13:12,981 - __main__ - INFO -   - Mode: subscribe
2025-08-19 04:13:12,982 - __main__ - INFO -   - Challenge: test_challenge_123
2025-08-19 04:13:12,982 - __main__ - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-19 04:13:12,982 - __main__ - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-19 04:13:12,983 - __main__ - INFO -   - Token Match: True
2025-08-19 04:13:12,988 - __main__ - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-19 04:13:12,988 - __main__ - INFO - Webhook verification SUCCESSFUL
2025-08-19 04:13:12,988 - __main__ - INFO - Returning challenge: test_challenge_123
2025-08-19 04:13:12,989 - __main__ - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-19 04:14:59,517 - __main__ - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-19 04:14:59,517 - __main__ - INFO - Received webhook verification request:
2025-08-19 04:14:59,518 - __main__ - INFO -   - Mode: subscribe
2025-08-19 04:14:59,518 - __main__ - INFO -   - Challenge: test_challenge_123
2025-08-19 04:14:59,518 - __main__ - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-19 04:14:59,519 - __main__ - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-19 04:14:59,519 - __main__ - INFO -   - Token Match: True
2025-08-19 04:14:59,569 - __main__ - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-19 04:14:59,570 - __main__ - INFO - Webhook verification SUCCESSFUL
2025-08-19 04:14:59,570 - __main__ - INFO - Returning challenge: test_challenge_123
2025-08-19 04:14:59,571 - __main__ - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-19 04:16:19,251 - __main__ - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-19 04:16:19,252 - __main__ - INFO - Received webhook verification request:
2025-08-19 04:16:19,253 - __main__ - INFO -   - Mode: subscribe
2025-08-19 04:16:19,253 - __main__ - INFO -   - Challenge: test_challenge_123
2025-08-19 04:16:19,253 - __main__ - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-19 04:16:19,254 - __main__ - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-19 04:16:19,254 - __main__ - INFO -   - Token Match: True
2025-08-19 04:16:19,258 - __main__ - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-19 04:16:19,259 - __main__ - INFO - Webhook verification SUCCESSFUL
2025-08-19 04:16:19,259 - __main__ - INFO - Returning challenge: test_challenge_123
2025-08-19 04:16:19,259 - __main__ - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-19 04:17:08,936 - __main__ - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-19 04:17:08,936 - __main__ - INFO - Received webhook verification request:
2025-08-19 04:17:08,937 - __main__ - INFO -   - Mode: subscribe
2025-08-19 04:17:08,937 - __main__ - INFO -   - Challenge: test_challenge_123
2025-08-19 04:17:08,938 - __main__ - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-19 04:17:08,938 - __main__ - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-19 04:17:08,938 - __main__ - INFO -   - Token Match: True
2025-08-19 04:17:08,940 - __main__ - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-19 04:17:08,941 - __main__ - INFO - Webhook verification SUCCESSFUL
2025-08-19 04:17:08,941 - __main__ - INFO - Returning challenge: test_challenge_123
2025-08-19 04:17:08,941 - __main__ - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-19 04:21:22,507 - __main__ - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 04:21:22,529 - __main__ - INFO - Connected to MongoDB successfully
2025-08-19 04:21:22,529 - __main__ - INFO - No Google Sheets credentials provided; skipping Sheets initialization
2025-08-19 04:21:49,113 - __main__ - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 04:21:49,138 - __main__ - INFO - Connected to MongoDB successfully
2025-08-19 04:21:49,139 - __main__ - INFO - No Google Sheets credentials provided; skipping Sheets initialization
2025-08-19 04:41:12,713 - __main__ - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 04:41:12,746 - __main__ - INFO - Connected to MongoDB successfully
2025-08-19 04:41:12,793 - __main__ - INFO - Google Sheets client initialized
2025-08-19 04:41:35,064 - __main__ - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 04:41:35,085 - __main__ - INFO - Connected to MongoDB successfully
2025-08-19 04:41:35,125 - __main__ - INFO - Google Sheets client initialized
2025-08-19 04:41:56,190 - __main__ - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 04:41:56,216 - __main__ - INFO - Connected to MongoDB successfully
2025-08-19 04:41:56,258 - __main__ - INFO - Google Sheets client initialized
2025-08-19 04:57:30,211 - __main__ - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 04:57:30,249 - __main__ - INFO - Connected to MongoDB successfully
2025-08-19 04:57:30,287 - __main__ - INFO - Google Sheets client initialized
2025-08-19 05:16:03,645 - __main__ - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 05:16:03,700 - __main__ - INFO - Connected to MongoDB successfully
2025-08-19 05:16:03,746 - __main__ - INFO - Google Sheets client initialized
2025-08-19 05:35:43,697 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-19 05:35:45,899 - server - INFO - Connected to MongoDB successfully
2025-08-19 05:35:45,949 - server - INFO - Google Sheets client initialized
2025-08-20 05:41:19,955 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 05:41:20,035 - server - INFO - Connected to MongoDB successfully
2025-08-20 05:41:20,037 - server - INFO - Google Sheets client initialized
2025-08-20 06:26:55,240 - server - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-20 06:26:55,245 - server - INFO - Received webhook verification request:
2025-08-20 06:26:55,245 - server - INFO -   - Mode: subscribe
2025-08-20 06:26:55,245 - server - INFO -   - Challenge: 1422743348
2025-08-20 06:26:55,246 - server - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-20 06:26:55,246 - server - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-20 06:26:55,247 - server - INFO -   - Token Match: True
2025-08-20 06:26:55,252 - server - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-20 06:26:55,252 - server - INFO - Webhook verification SUCCESSFUL
2025-08-20 06:26:55,253 - server - INFO - Returning challenge: 1422743348
2025-08-20 06:26:55,255 - server - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-20 06:29:12,513 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:29:12,513 - server - INFO - Headers: {'host': 'f753da24476f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '421', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:32ff:72::', 'x-forwarded-host': 'f753da24476f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=fb7840ec22d92bf641f2683c4101b5b39f7fb406', 'x-hub-signature-256': 'sha256=ec44734629aa8bb3d55874c2938193ec2d46ae5e97296b714d1ae71fd179902b'}
2025-08-20 06:29:12,516 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "0",
      "changes": [
        {
          "field": "messages",
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "16505551111",
              "phone_number_id": "123456123"
            },
            "contacts": [
              {
                "profile": {
                  "name": "test user name"
                },
                "wa_id": "16315551181"
              }
            ],
            "messages": [
              {
                "from": "16315551181",
                "id": "ABGGFlA5Fpa",
                "timestamp": "1504902988",
                "type": "text",
                "text": {
                  "body": "this is a text message"
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
2025-08-20 06:29:12,521 - server - INFO - Entry ID: 0
2025-08-20 06:29:12,522 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "16505551111",
    "phone_number_id": "123456123"
  },
  "contacts": [
    {
      "profile": {
        "name": "test user name"
      },
      "wa_id": "16315551181"
    }
  ],
  "messages": [
    {
      "from": "16315551181",
      "id": "ABGGFlA5Fpa",
      "timestamp": "1504902988",
      "type": "text",
      "text": {
        "body": "this is a text message"
      }
    }
  ]
}
2025-08-20 06:29:12,524 - server - INFO - Message ID: ABGGFlA5Fpa
2025-08-20 06:29:12,524 - server - INFO - From: 16315551181
2025-08-20 06:29:12,524 - server - INFO - Timestamp: 1504902988
2025-08-20 06:29:12,525 - server - INFO - Type: text
2025-08-20 06:29:12,526 - server - INFO - Content: this is a text message
2025-08-20 06:29:12,527 - server - INFO - Message queued for processing
2025-08-20 06:29:12,527 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:29:12,529 - server - INFO - Processing message from 16315551181: this is a text message
2025-08-20 06:29:12,574 - server - INFO - Created new contact: 16315551181
2025-08-20 06:29:12,592 - server - INFO - Created new conversation: fb643f46-2ab3-4c3c-8199-d3eb59cb1034
2025-08-20 06:29:16,891 - server - ERROR - Error classifying message: Expecting value: line 1 column 1 (char 0)
2025-08-20 06:29:20,610 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 401 Unauthorized"
2025-08-20 06:29:20,610 - server - ERROR - Error sending message to 16315551181: Client error '401 Unauthorized' for url 'https://graph.facebook.com/v18.0/764456666746638/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401
2025-08-20 06:29:20,611 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 06:29:43,732 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:29:43,732 - server - INFO - Headers: {'host': 'f753da24476f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '421', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:32ff:71::', 'x-forwarded-host': 'f753da24476f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=fb7840ec22d92bf641f2683c4101b5b39f7fb406', 'x-hub-signature-256': 'sha256=ec44734629aa8bb3d55874c2938193ec2d46ae5e97296b714d1ae71fd179902b'}
2025-08-20 06:29:43,733 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "0",
      "changes": [
        {
          "field": "messages",
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "16505551111",
              "phone_number_id": "123456123"
            },
            "contacts": [
              {
                "profile": {
                  "name": "test user name"
                },
                "wa_id": "16315551181"
              }
            ],
            "messages": [
              {
                "from": "16315551181",
                "id": "ABGGFlA5Fpa",
                "timestamp": "1504902988",
                "type": "text",
                "text": {
                  "body": "this is a text message"
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
2025-08-20 06:29:43,735 - server - INFO - Entry ID: 0
2025-08-20 06:29:43,736 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "16505551111",
    "phone_number_id": "123456123"
  },
  "contacts": [
    {
      "profile": {
        "name": "test user name"
      },
      "wa_id": "16315551181"
    }
  ],
  "messages": [
    {
      "from": "16315551181",
      "id": "ABGGFlA5Fpa",
      "timestamp": "1504902988",
      "type": "text",
      "text": {
        "body": "this is a text message"
      }
    }
  ]
}
2025-08-20 06:29:43,738 - server - INFO - Message ID: ABGGFlA5Fpa
2025-08-20 06:29:43,738 - server - INFO - From: 16315551181
2025-08-20 06:29:43,738 - server - INFO - Timestamp: 1504902988
2025-08-20 06:29:43,739 - server - INFO - Type: text
2025-08-20 06:29:43,739 - server - INFO - Content: this is a text message
2025-08-20 06:29:43,739 - server - INFO - Message queued for processing
2025-08-20 06:29:43,740 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:29:43,742 - server - INFO - Processing message from 16315551181: this is a text message
2025-08-20 06:29:45,048 - server - ERROR - Error classifying message: Expecting value: line 1 column 1 (char 0)
2025-08-20 06:29:47,127 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 401 Unauthorized"
2025-08-20 06:29:47,128 - server - ERROR - Error sending message to 16315551181: Client error '401 Unauthorized' for url 'https://graph.facebook.com/v18.0/764456666746638/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401
2025-08-20 06:29:47,129 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 06:31:23,998 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:31:23,999 - server - INFO - Headers: {'host': 'f753da24476f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '421', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:32ff::', 'x-forwarded-host': 'f753da24476f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=fb7840ec22d92bf641f2683c4101b5b39f7fb406', 'x-hub-signature-256': 'sha256=ec44734629aa8bb3d55874c2938193ec2d46ae5e97296b714d1ae71fd179902b'}
2025-08-20 06:31:23,999 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "0",
      "changes": [
        {
          "field": "messages",
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "16505551111",
              "phone_number_id": "123456123"
            },
            "contacts": [
              {
                "profile": {
                  "name": "test user name"
                },
                "wa_id": "16315551181"
              }
            ],
            "messages": [
              {
                "from": "16315551181",
                "id": "ABGGFlA5Fpa",
                "timestamp": "1504902988",
                "type": "text",
                "text": {
                  "body": "this is a text message"
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
2025-08-20 06:31:24,004 - server - INFO - Entry ID: 0
2025-08-20 06:31:24,005 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "16505551111",
    "phone_number_id": "123456123"
  },
  "contacts": [
    {
      "profile": {
        "name": "test user name"
      },
      "wa_id": "16315551181"
    }
  ],
  "messages": [
    {
      "from": "16315551181",
      "id": "ABGGFlA5Fpa",
      "timestamp": "1504902988",
      "type": "text",
      "text": {
        "body": "this is a text message"
      }
    }
  ]
}
2025-08-20 06:31:24,008 - server - INFO - Message ID: ABGGFlA5Fpa
2025-08-20 06:31:24,008 - server - INFO - From: 16315551181
2025-08-20 06:31:24,009 - server - INFO - Timestamp: 1504902988
2025-08-20 06:31:24,009 - server - INFO - Type: text
2025-08-20 06:31:24,010 - server - INFO - Content: this is a text message
2025-08-20 06:31:24,010 - server - INFO - Message queued for processing
2025-08-20 06:31:24,010 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:31:24,012 - server - INFO - Processing message from 16315551181: this is a text message
2025-08-20 06:31:25,253 - server - ERROR - Error classifying message: Expecting value: line 1 column 1 (char 0)
2025-08-20 06:31:28,491 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 401 Unauthorized"
2025-08-20 06:31:28,492 - server - ERROR - Error sending message to 16315551181: Client error '401 Unauthorized' for url 'https://graph.facebook.com/v18.0/764456666746638/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401
2025-08-20 06:31:28,493 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 06:35:00,265 - server - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-20 06:35:00,265 - server - INFO - Received webhook verification request:
2025-08-20 06:35:00,265 - server - INFO -   - Mode: subscribe
2025-08-20 06:35:00,266 - server - INFO -   - Challenge: 1860701112
2025-08-20 06:35:00,266 - server - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-20 06:35:00,266 - server - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-20 06:35:00,267 - server - INFO -   - Token Match: True
2025-08-20 06:35:00,270 - server - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-20 06:35:00,271 - server - INFO - Webhook verification SUCCESSFUL
2025-08-20 06:35:00,271 - server - INFO - Returning challenge: 1860701112
2025-08-20 06:35:00,272 - server - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-20 06:35:02,905 - server - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-20 06:35:02,905 - server - INFO - Received webhook verification request:
2025-08-20 06:35:02,905 - server - INFO -   - Mode: subscribe
2025-08-20 06:35:02,906 - server - INFO -   - Challenge: 1288731312
2025-08-20 06:35:02,906 - server - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-20 06:35:02,906 - server - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-20 06:35:02,907 - server - INFO -   - Token Match: True
2025-08-20 06:35:02,909 - server - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-20 06:35:02,909 - server - INFO - Webhook verification SUCCESSFUL
2025-08-20 06:35:02,910 - server - INFO - Returning challenge: 1288731312
2025-08-20 06:35:02,910 - server - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-20 06:40:14,854 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:40:14,855 - server - INFO - Headers: {'host': 'f753da24476f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '488', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:7::', 'x-forwarded-host': 'f753da24476f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=44178596c1977b14f94f661e162678a009e832ae', 'x-hub-signature-256': 'sha256=ea936c93e26b3a00c36186b0fb58efe6c283bda619e93c804c32e25bcd9bef5f'}
2025-08-20 06:40:14,855 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggQUI5NkJCRDUyMzM4RUZGMDYxRTgzRTM4MTVDNUNCNDEA",
                "timestamp": "1755661212",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:40:14,858 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:40:14,858 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggQUI5NkJCRDUyMzM4RUZGMDYxRTgzRTM4MTVDNUNCNDEA",
      "timestamp": "1755661212",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 06:40:14,860 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggQUI5NkJCRDUyMzM4RUZGMDYxRTgzRTM4MTVDNUNCNDEA
2025-08-20 06:40:14,860 - server - INFO - From: 254702944890
2025-08-20 06:40:14,861 - server - INFO - Timestamp: 1755661212
2025-08-20 06:40:14,861 - server - INFO - Type: text
2025-08-20 06:40:14,861 - server - INFO - Content: Hi
2025-08-20 06:40:14,861 - server - INFO - Message queued for processing
2025-08-20 06:40:14,862 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:40:14,863 - server - INFO - Processing message from 254702944890: Hi
2025-08-20 06:40:14,866 - server - INFO - Created new contact: 254702944890
2025-08-20 06:40:14,868 - server - INFO - Created new conversation: ac4aa41e-be90-4cab-9d87-c4cace2a0418
2025-08-20 06:40:18,954 - server - ERROR - Error classifying message: Expecting value: line 1 column 1 (char 0)
2025-08-20 06:40:20,116 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 401 Unauthorized"
2025-08-20 06:40:20,117 - server - ERROR - Error sending message to 254702944890: Client error '401 Unauthorized' for url 'https://graph.facebook.com/v18.0/764456666746638/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401
2025-08-20 06:40:20,118 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 06:44:03,456 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 06:44:03,480 - server - INFO - Connected to MongoDB successfully
2025-08-20 06:44:03,484 - server - INFO - Google Sheets client initialized
2025-08-20 06:46:37,432 - server - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-20 06:46:37,432 - server - INFO - Received webhook verification request:
2025-08-20 06:46:37,433 - server - INFO -   - Mode: subscribe
2025-08-20 06:46:37,433 - server - INFO -   - Challenge: 1080199864
2025-08-20 06:46:37,433 - server - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-20 06:46:37,434 - server - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-20 06:46:37,434 - server - INFO -   - Token Match: True
2025-08-20 06:46:37,436 - server - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-20 06:46:37,436 - server - INFO - Webhook verification SUCCESSFUL
2025-08-20 06:46:37,437 - server - INFO - Returning challenge: 1080199864
2025-08-20 06:46:37,437 - server - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-20 06:46:43,558 - server - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-20 06:46:43,558 - server - INFO - Received webhook verification request:
2025-08-20 06:46:43,558 - server - INFO -   - Mode: subscribe
2025-08-20 06:46:43,559 - server - INFO -   - Challenge: 1244386464
2025-08-20 06:46:43,559 - server - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-20 06:46:43,560 - server - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-20 06:46:43,560 - server - INFO -   - Token Match: True
2025-08-20 06:46:43,562 - server - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-20 06:46:43,562 - server - INFO - Webhook verification SUCCESSFUL
2025-08-20 06:46:43,562 - server - INFO - Returning challenge: 1244386464
2025-08-20 06:46:43,562 - server - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-20 06:46:50,405 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:46:50,405 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '488', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:d::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=ca778fef2cba1d8e5aba280f4abf08533a3ef21d', 'x-hub-signature-256': 'sha256=388f5a61abe38e3e297a0d8f242da6178331537d2cd7b284c881b562d78d3e85'}
2025-08-20 06:46:50,406 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggN0NEMDNEMTFGN0E2ODI4MUJGMjZCMDg3RDNDNjlGMTQA",
                "timestamp": "1755661608",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:46:50,408 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:46:50,408 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggN0NEMDNEMTFGN0E2ODI4MUJGMjZCMDg3RDNDNjlGMTQA",
      "timestamp": "1755661608",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 06:46:50,410 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggN0NEMDNEMTFGN0E2ODI4MUJGMjZCMDg3RDNDNjlGMTQA
2025-08-20 06:46:50,410 - server - INFO - From: 254702944890
2025-08-20 06:46:50,410 - server - INFO - Timestamp: 1755661608
2025-08-20 06:46:50,410 - server - INFO - Type: text
2025-08-20 06:46:50,411 - server - INFO - Content: Hi
2025-08-20 06:46:50,411 - server - INFO - Message queued for processing
2025-08-20 06:46:50,411 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:46:50,413 - server - INFO - Processing message from 254702944890: Hi
2025-08-20 06:46:51,390 - server - ERROR - Error classifying message: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-08-20 06:46:51,950 - server - ERROR - Error generating AI response: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-08-20 06:46:53,493 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 06:46:53,494 - server - INFO - Message sent to 254702944890: Thank you for your message. I'll get back to you s...
2025-08-20 06:46:53,504 - server - INFO - Message processed successfully for 254702944890
2025-08-20 06:46:54,835 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:46:54,836 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=613b7c3d1cd871d0d32d875b1f5ad31ec2994aae', 'x-hub-signature-256': 'sha256=5f45135260e7ba6c70707f0674a760c103bccb6905900c7a9800e41a46f6279d'}
2025-08-20 06:46:54,837 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOEM0M0M0NEJDNzQzMTc3QUVGAA==",
                "status": "sent",
                "timestamp": "1755661613",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "2043a883c2d2e4a37ca1c2e395f38fc6",
                  "expiration_timestamp": "1755661613",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:46:54,841 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:46:54,841 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOEM0M0M0NEJDNzQzMTc3QUVGAA==",
      "status": "sent",
      "timestamp": "1755661613",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "2043a883c2d2e4a37ca1c2e395f38fc6",
        "expiration_timestamp": "1755661613",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 06:46:54,844 - server - INFO - Message queued for processing
2025-08-20 06:46:54,845 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:46:54,846 - server - INFO - No messages in webhook
2025-08-20 06:46:54,885 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:46:54,886 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:49::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=d78b6c2e9d6212fae1adf23ef9d6ce711923459f', 'x-hub-signature-256': 'sha256=35be1aeec6d2fbb20605b7ce5bae794859d237b6c55d3557cca98b3ad3775907'}
2025-08-20 06:46:54,887 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOEM0M0M0NEJDNzQzMTc3QUVGAA==",
                "status": "read",
                "timestamp": "1755661613",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "2043a883c2d2e4a37ca1c2e395f38fc6",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:46:54,891 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:46:54,892 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOEM0M0M0NEJDNzQzMTc3QUVGAA==",
      "status": "read",
      "timestamp": "1755661613",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "2043a883c2d2e4a37ca1c2e395f38fc6",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 06:46:54,895 - server - INFO - Message queued for processing
2025-08-20 06:46:54,895 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:46:54,897 - server - INFO - No messages in webhook
2025-08-20 06:48:03,114 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:48:03,114 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '497', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=9f230fac085d15344d376a896337a4371d3d9e73', 'x-hub-signature-256': 'sha256=99354c78cbf756b5ec8aa47db9b80a86827d98561c3f9a1f9bb60ca1d07f96f0'}
2025-08-20 06:48:03,115 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggQkQ1NDcyNzlCOTQwNUY5OTAxMjc4OUMxMDlENTg3RjUA",
                "timestamp": "1755661681",
                "text": {
                  "body": "How are you"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:48:03,117 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:48:03,117 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggQkQ1NDcyNzlCOTQwNUY5OTAxMjc4OUMxMDlENTg3RjUA",
      "timestamp": "1755661681",
      "text": {
        "body": "How are you"
      },
      "type": "text"
    }
  ]
}
2025-08-20 06:48:03,119 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggQkQ1NDcyNzlCOTQwNUY5OTAxMjc4OUMxMDlENTg3RjUA
2025-08-20 06:48:03,120 - server - INFO - From: 254702944890
2025-08-20 06:48:03,120 - server - INFO - Timestamp: 1755661681
2025-08-20 06:48:03,121 - server - INFO - Type: text
2025-08-20 06:48:03,121 - server - INFO - Content: How are you
2025-08-20 06:48:03,122 - server - INFO - Message queued for processing
2025-08-20 06:48:03,122 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:48:03,124 - server - INFO - Processing message from 254702944890: How are you
2025-08-20 06:48:03,799 - server - ERROR - Error classifying message: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-08-20 06:48:04,685 - server - ERROR - Error generating AI response: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-08-20 06:48:06,933 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 06:48:06,934 - server - INFO - Message sent to 254702944890: Thank you for your message. I'll get back to you s...
2025-08-20 06:48:07,263 - server - ERROR - Error generating summary: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-08-20 06:48:10,916 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'consumer': 'projects/260626823147', 'service': 'drive.googleapis.com', 'serviceTitle': 'Google Drive API', 'containerInfo': '260626823147'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 06:48:10,922 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 06:48:10,938 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:48:10,938 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:a::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=44625c75794be6b725221a46a40540df4a279fab', 'x-hub-signature-256': 'sha256=603f6d2e256646601a7828493ad7999e60ee681badae89353c9d6fc36caa8735'}
2025-08-20 06:48:10,940 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOTk3MjgyM0EzMUE1ODQxRUMyAA==",
                "status": "sent",
                "timestamp": "1755661686",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "1676c272f360536bc59fea56e2bb5701",
                  "expiration_timestamp": "1755661686",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:48:10,941 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:48:10,942 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOTk3MjgyM0EzMUE1ODQxRUMyAA==",
      "status": "sent",
      "timestamp": "1755661686",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "1676c272f360536bc59fea56e2bb5701",
        "expiration_timestamp": "1755661686",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 06:48:10,944 - server - INFO - Message queued for processing
2025-08-20 06:48:10,944 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:48:10,946 - server - INFO - No messages in webhook
2025-08-20 06:48:10,948 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:48:10,948 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:42::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=69f525ed45729ea6a86b887d078bea4b338cd1f7', 'x-hub-signature-256': 'sha256=0b3888c58de655a77c19456a83483e8af84e29fc24eec4c0a34f8017e70c1f8e'}
2025-08-20 06:48:10,949 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOTk3MjgyM0EzMUE1ODQxRUMyAA==",
                "status": "read",
                "timestamp": "1755661686",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "1676c272f360536bc59fea56e2bb5701",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:48:10,952 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:48:10,952 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOTk3MjgyM0EzMUE1ODQxRUMyAA==",
      "status": "read",
      "timestamp": "1755661686",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "1676c272f360536bc59fea56e2bb5701",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 06:48:10,955 - server - INFO - Message queued for processing
2025-08-20 06:48:10,955 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:48:10,957 - server - INFO - No messages in webhook
2025-08-20 06:48:12,287 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 06:48:12,289 - server - ERROR - Error sending message to +15551926618: Client error '400 Bad Request' for url 'https://graph.facebook.com/v18.0/764456666746638/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-08-20 06:48:12,289 - server - WARNING - Failed to send owner notification: 
2025-08-20 06:48:12,290 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 06:48:12,290 - server - INFO - Message processed successfully for 254702944890
2025-08-20 06:49:44,216 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:49:44,217 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '488', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:72::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=8bb0101e0a9156820564059e78d388cc4d0dd99f', 'x-hub-signature-256': 'sha256=a253b4df382f4478de39062bde369c49ea8e99cdbd66491adaed3b0b0ed7a026'}
2025-08-20 06:49:44,217 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggRDU0NjcwNjg5NUZCOTdGQ0UyRDZCNUVBNkE0NTgxNUUA",
                "timestamp": "1755661782",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:49:44,221 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:49:44,221 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggRDU0NjcwNjg5NUZCOTdGQ0UyRDZCNUVBNkE0NTgxNUUA",
      "timestamp": "1755661782",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 06:49:44,224 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggRDU0NjcwNjg5NUZCOTdGQ0UyRDZCNUVBNkE0NTgxNUUA
2025-08-20 06:49:44,225 - server - INFO - From: 254702944890
2025-08-20 06:49:44,225 - server - INFO - Timestamp: 1755661782
2025-08-20 06:49:44,225 - server - INFO - Type: text
2025-08-20 06:49:44,226 - server - INFO - Content: Hi
2025-08-20 06:49:44,226 - server - INFO - Message queued for processing
2025-08-20 06:49:44,226 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:49:44,228 - server - INFO - Processing message from 254702944890: Hi
2025-08-20 06:49:44,382 - server - ERROR - Error classifying message: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-08-20 06:49:44,961 - server - ERROR - Error generating AI response: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-08-20 06:49:46,066 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 06:49:46,067 - server - INFO - Message sent to 254702944890: Thank you for your message. I'll get back to you s...
2025-08-20 06:49:46,241 - server - ERROR - Error generating summary: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-08-20 06:49:46,563 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'serviceTitle': 'Google Drive API', 'containerInfo': '260626823147', 'service': 'drive.googleapis.com', 'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'consumer': 'projects/260626823147'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 06:49:46,565 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 06:49:47,057 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:49:47,057 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:8::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=9d522196568b1d5dcdbe815f0fa2612e8bc0ed4c', 'x-hub-signature-256': 'sha256=acd76f96a4df48312fbb86b9c921128635e80a3dc5102691f25362380c4dd310'}
2025-08-20 06:49:47,089 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRkQ4OUY3N0Q4NEMwMTgwNzI5AA==",
                "status": "sent",
                "timestamp": "1755661786",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "6a77352214a07b284b2792fa2e5d1780",
                  "expiration_timestamp": "1755661786",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:49:47,092 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:49:47,093 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRkQ4OUY3N0Q4NEMwMTgwNzI5AA==",
      "status": "sent",
      "timestamp": "1755661786",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "6a77352214a07b284b2792fa2e5d1780",
        "expiration_timestamp": "1755661786",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 06:49:47,096 - server - INFO - Message queued for processing
2025-08-20 06:49:47,096 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:49:47,099 - server - INFO - No messages in webhook
2025-08-20 06:49:47,419 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 06:49:47,420 - server - ERROR - Error sending message to +15551926618: Client error '400 Bad Request' for url 'https://graph.facebook.com/v18.0/764456666746638/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-08-20 06:49:47,421 - server - WARNING - Failed to send owner notification: 
2025-08-20 06:49:47,422 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 06:49:47,422 - server - INFO - Message processed successfully for 254702944890
2025-08-20 06:49:47,484 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:49:47,484 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:12ff:2::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=94714fb661b2903b0b123defac28fe23681ec407', 'x-hub-signature-256': 'sha256=eef1edd2119f6cc093ca74a0c3cbe8cadb2d7feed19abdcbc0dae6a611ad8855'}
2025-08-20 06:49:47,484 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRkQ4OUY3N0Q4NEMwMTgwNzI5AA==",
                "status": "read",
                "timestamp": "1755661786",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "6a77352214a07b284b2792fa2e5d1780",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:49:47,488 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:49:47,489 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRkQ4OUY3N0Q4NEMwMTgwNzI5AA==",
      "status": "read",
      "timestamp": "1755661786",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "6a77352214a07b284b2792fa2e5d1780",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 06:49:47,491 - server - INFO - Message queued for processing
2025-08-20 06:49:47,491 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:49:47,493 - server - INFO - No messages in webhook
2025-08-20 06:49:55,986 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 06:49:56,012 - server - INFO - Connected to MongoDB successfully
2025-08-20 06:49:56,014 - server - INFO - Google Sheets client initialized
2025-08-20 06:50:49,222 - server - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-20 06:50:49,222 - server - INFO - Received webhook verification request:
2025-08-20 06:50:49,223 - server - INFO -   - Mode: subscribe
2025-08-20 06:50:49,223 - server - INFO -   - Challenge: 2044242549
2025-08-20 06:50:49,223 - server - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-20 06:50:49,224 - server - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-20 06:50:49,224 - server - INFO -   - Token Match: True
2025-08-20 06:50:49,226 - server - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-20 06:50:49,227 - server - INFO - Webhook verification SUCCESSFUL
2025-08-20 06:50:49,227 - server - INFO - Returning challenge: 2044242549
2025-08-20 06:50:49,227 - server - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-20 06:50:51,612 - server - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-20 06:50:51,613 - server - INFO - Received webhook verification request:
2025-08-20 06:50:51,613 - server - INFO -   - Mode: subscribe
2025-08-20 06:50:51,614 - server - INFO -   - Challenge: 241808589
2025-08-20 06:50:51,614 - server - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-20 06:50:51,614 - server - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-20 06:50:51,614 - server - INFO -   - Token Match: True
2025-08-20 06:50:51,616 - server - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-20 06:50:51,617 - server - INFO - Webhook verification SUCCESSFUL
2025-08-20 06:50:51,617 - server - INFO - Returning challenge: 241808589
2025-08-20 06:50:51,617 - server - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-20 06:51:11,271 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:51:11,272 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '488', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=6d0e5181a45021e863cad4199421e96be0f18a94', 'x-hub-signature-256': 'sha256=ef64121b8aa7b7945343b37642725cf997bc0d6212a29ccaeff7557661786114'}
2025-08-20 06:51:11,272 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggQUFEMkExNjM4QUY0MDcxODJFQ0Y4Rjc1MDg2N0EzMUEA",
                "timestamp": "1755661869",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:51:11,277 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:51:11,277 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggQUFEMkExNjM4QUY0MDcxODJFQ0Y4Rjc1MDg2N0EzMUEA",
      "timestamp": "1755661869",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 06:51:11,279 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggQUFEMkExNjM4QUY0MDcxODJFQ0Y4Rjc1MDg2N0EzMUEA
2025-08-20 06:51:11,279 - server - INFO - From: 254702944890
2025-08-20 06:51:11,279 - server - INFO - Timestamp: 1755661869
2025-08-20 06:51:11,280 - server - INFO - Type: text
2025-08-20 06:51:11,280 - server - INFO - Content: Hi
2025-08-20 06:51:11,280 - server - INFO - Message queued for processing
2025-08-20 06:51:11,281 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:51:11,283 - server - INFO - Processing message from 254702944890: Hi
2025-08-20 06:51:15,351 - server - ERROR - Error classifying message: Expecting value: line 1 column 1 (char 0)
2025-08-20 06:51:21,365 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:51:21,365 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '488', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:12ff:5::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=235820bc604651c80a1f28cbb0417ac5adf54559', 'x-hub-signature-256': 'sha256=fa557152027e9a9826557a4010f31d82c39242ef344fb63ba31928f5f7c26bc0'}
2025-08-20 06:51:21,366 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggODM1QjM1QzZBQTY0MTE2QkY1OEQwMjA4NTlDRUVERjQA",
                "timestamp": "1755661481",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:51:21,368 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:51:21,368 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggODM1QjM1QzZBQTY0MTE2QkY1OEQwMjA4NTlDRUVERjQA",
      "timestamp": "1755661481",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 06:51:21,370 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggODM1QjM1QzZBQTY0MTE2QkY1OEQwMjA4NTlDRUVERjQA
2025-08-20 06:51:21,371 - server - INFO - From: 254702944890
2025-08-20 06:51:21,371 - server - INFO - Timestamp: 1755661481
2025-08-20 06:51:21,371 - server - INFO - Type: text
2025-08-20 06:51:21,372 - server - INFO - Content: Hi
2025-08-20 06:51:21,372 - server - INFO - Message queued for processing
2025-08-20 06:51:21,372 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:51:21,374 - server - INFO - Processing message from 254702944890: Hi
2025-08-20 06:51:22,756 - server - ERROR - Error classifying message: Expecting value: line 1 column 1 (char 0)
2025-08-20 06:51:27,180 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:51:27,180 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:9::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=83e04474ebd8f4953e1ead403ed151f424709f04', 'x-hub-signature-256': 'sha256=6ad11eb5caad418488df56fa223b00ced115c3efe32faf3acc1f85e3b416d165'}
2025-08-20 06:51:27,181 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNUNBNkQ4M0MxNTY5OEZFRDVFAA==",
                "status": "sent",
                "timestamp": "1755661885",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "1f0557a11a1014dc1c28ba3b4d309f77",
                  "expiration_timestamp": "1755661885",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:51:27,183 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:51:27,184 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNUNBNkQ4M0MxNTY5OEZFRDVFAA==",
      "status": "sent",
      "timestamp": "1755661885",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "1f0557a11a1014dc1c28ba3b4d309f77",
        "expiration_timestamp": "1755661885",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 06:51:27,186 - server - INFO - Message queued for processing
2025-08-20 06:51:27,186 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:51:27,188 - server - INFO - No messages in webhook
2025-08-20 06:51:27,263 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 06:51:27,264 - server - INFO - Message sent to 254702944890: Please state your name and the purpose of your mes...
2025-08-20 06:51:36,062 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'service': 'drive.googleapis.com', 'serviceTitle': 'Google Drive API', 'consumer': 'projects/260626823147', 'containerInfo': '260626823147'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 06:51:36,066 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 06:51:36,081 - server - ERROR - Error sending message to 254702944890: 
2025-08-20 06:51:36,081 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 06:51:36,085 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:51:36,085 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:6::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=913324e31cc7f1672e4d2480b113842435ec97bc', 'x-hub-signature-256': 'sha256=3ac5dbafa63c13c0e81dd60c06f4fdd0d623f2b066f5a10f8b88fc6f4bbab102'}
2025-08-20 06:51:36,085 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNUNBNkQ4M0MxNTY5OEZFRDVFAA==",
                "status": "read",
                "timestamp": "1755661886",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "1f0557a11a1014dc1c28ba3b4d309f77",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:51:36,088 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:51:36,089 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNUNBNkQ4M0MxNTY5OEZFRDVFAA==",
      "status": "read",
      "timestamp": "1755661886",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "1f0557a11a1014dc1c28ba3b4d309f77",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 06:51:36,091 - server - INFO - Message queued for processing
2025-08-20 06:51:36,091 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:51:36,094 - server - INFO - No messages in webhook
2025-08-20 06:51:38,103 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 06:51:38,104 - server - ERROR - Error sending message to +15551926618: Client error '400 Bad Request' for url 'https://graph.facebook.com/v18.0/764456666746638/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-08-20 06:51:38,105 - server - WARNING - Failed to send owner notification: 
2025-08-20 06:51:38,105 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 06:51:38,106 - server - INFO - Message processed successfully for 254702944890
2025-08-20 06:52:34,070 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:52:34,071 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '537', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:b::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=09309ab5787eba3b345ac97ec846132d7ec25294', 'x-hub-signature-256': 'sha256=38befa7b73cd0323b1ff0392217f704bec7e223e6da08090b745b683a78ab437'}
2025-08-20 06:52:34,072 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNkU0NEIwOURERDZDMTE5NkZDM0E0NjI2OTU5MDY5QzQA",
                "timestamp": "1755661952",
                "text": {
                  "body": "Dan kosgey,I want to schedule a meeting with kosgey"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:52:34,074 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:52:34,074 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNkU0NEIwOURERDZDMTE5NkZDM0E0NjI2OTU5MDY5QzQA",
      "timestamp": "1755661952",
      "text": {
        "body": "Dan kosgey,I want to schedule a meeting with kosgey"
      },
      "type": "text"
    }
  ]
}
2025-08-20 06:52:34,076 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNkU0NEIwOURERDZDMTE5NkZDM0E0NjI2OTU5MDY5QzQA
2025-08-20 06:52:34,076 - server - INFO - From: 254702944890
2025-08-20 06:52:34,076 - server - INFO - Timestamp: 1755661952
2025-08-20 06:52:34,077 - server - INFO - Type: text
2025-08-20 06:52:34,077 - server - INFO - Content: Dan kosgey,I want to schedule a meeting with kosgey
2025-08-20 06:52:34,077 - server - INFO - Message queued for processing
2025-08-20 06:52:34,078 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:52:34,079 - server - INFO - Processing message from 254702944890: Dan kosgey,I want to schedule a meeting with kosgey
2025-08-20 06:52:35,459 - server - ERROR - Error classifying message: Expecting value: line 1 column 1 (char 0)
2025-08-20 06:52:37,764 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 06:52:37,765 - server - INFO - Message sent to 254702944890: Mr. Kosgey, please provide details regarding the p...
2025-08-20 06:52:39,425 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'serviceTitle': 'Google Drive API', 'containerInfo': '260626823147', 'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'consumer': 'projects/260626823147', 'service': 'drive.googleapis.com'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 06:52:39,427 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 06:52:39,442 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:52:39,443 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:d::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=c843fc91fddeb7f7a0ca63408b61ad9517d287b8', 'x-hub-signature-256': 'sha256=0085bb7e9e557fe1e02f28f90415db5a1725f1a9cbd868ccb3b4e1f3149b342f'}
2025-08-20 06:52:39,446 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNkI3RUFBMzdDMThDRjkwNDM2AA==",
                "status": "sent",
                "timestamp": "1755661957",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "9fb5ca24e3462cbabc9d0a34a5042d40",
                  "expiration_timestamp": "1755661957",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:52:39,449 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:52:39,449 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNkI3RUFBMzdDMThDRjkwNDM2AA==",
      "status": "sent",
      "timestamp": "1755661957",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "9fb5ca24e3462cbabc9d0a34a5042d40",
        "expiration_timestamp": "1755661957",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 06:52:39,453 - server - INFO - Message queued for processing
2025-08-20 06:52:39,453 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:52:39,455 - server - INFO - No messages in webhook
2025-08-20 06:52:39,456 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:52:39,457 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:9::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=8affc56e56507ef2f5d3e50cc480a30d6f6b61db', 'x-hub-signature-256': 'sha256=85f921dfdbbe410be3c01168069e8da692cdde2cf67eeefce9db0a5e08f44bfe'}
2025-08-20 06:52:39,459 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNkI3RUFBMzdDMThDRjkwNDM2AA==",
                "status": "read",
                "timestamp": "1755661958",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "9fb5ca24e3462cbabc9d0a34a5042d40",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:52:39,461 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:52:39,461 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNkI3RUFBMzdDMThDRjkwNDM2AA==",
      "status": "read",
      "timestamp": "1755661958",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "9fb5ca24e3462cbabc9d0a34a5042d40",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 06:52:39,464 - server - INFO - Message queued for processing
2025-08-20 06:52:39,464 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:52:39,465 - server - INFO - No messages in webhook
2025-08-20 06:52:40,199 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 06:52:40,200 - server - ERROR - Error sending message to +15551926618: Client error '400 Bad Request' for url 'https://graph.facebook.com/v18.0/764456666746638/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-08-20 06:52:40,201 - server - WARNING - Failed to send owner notification: 
2025-08-20 06:52:40,201 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 06:52:40,202 - server - INFO - Message processed successfully for 254702944890
2025-08-20 06:53:49,625 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:53:49,626 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '516', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:b::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=ccbc63d24f179585efdd60fb4f462120e5b0beef', 'x-hub-signature-256': 'sha256=9a28d33d0b64087cf375a1696ddd7f7f9dc1b94d6c066c95f8e440b0eb35ac64'}
2025-08-20 06:53:49,626 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNEZGMTJCMzZDODg5NTJENzU5ODA4RURGRDk4RUMxQzEA",
                "timestamp": "1755662025",
                "text": {
                  "body": "I want to meet korrir tomorrow"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:53:49,628 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:53:49,628 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNEZGMTJCMzZDODg5NTJENzU5ODA4RURGRDk4RUMxQzEA",
      "timestamp": "1755662025",
      "text": {
        "body": "I want to meet korrir tomorrow"
      },
      "type": "text"
    }
  ]
}
2025-08-20 06:53:49,630 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNEZGMTJCMzZDODg5NTJENzU5ODA4RURGRDk4RUMxQzEA
2025-08-20 06:53:49,630 - server - INFO - From: 254702944890
2025-08-20 06:53:49,631 - server - INFO - Timestamp: 1755662025
2025-08-20 06:53:49,631 - server - INFO - Type: text
2025-08-20 06:53:49,631 - server - INFO - Content: I want to meet korrir tomorrow
2025-08-20 06:53:49,632 - server - INFO - Message queued for processing
2025-08-20 06:53:49,632 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:53:49,634 - server - INFO - Processing message from 254702944890: I want to meet korrir tomorrow
2025-08-20 06:53:53,202 - server - ERROR - Error classifying message: Expecting value: line 1 column 1 (char 0)
2025-08-20 06:54:01,460 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 06:54:01,461 - server - INFO - Message sent to 254702944890: Please state your name and the purpose of your mee...
2025-08-20 06:54:05,909 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'service': 'drive.googleapis.com', 'serviceTitle': 'Google Drive API', 'consumer': 'projects/260626823147', 'containerInfo': '260626823147'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 06:54:05,911 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 06:54:05,924 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:54:05,925 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:2::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=84a55b767075af130e160db91d7f34ea2a62b393', 'x-hub-signature-256': 'sha256=8c3a78c563a0cfa7ac6de8dd49e5e427643bd1e5799ca0274100084c4179314e'}
2025-08-20 06:54:05,926 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOUZGN0I1MTE1MzdFNjMxN0M2AA==",
                "status": "sent",
                "timestamp": "1755662038",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "0dd1b47648295fb1a0b5ee291eca1cb5",
                  "expiration_timestamp": "1755662038",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:54:05,929 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:54:05,930 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOUZGN0I1MTE1MzdFNjMxN0M2AA==",
      "status": "sent",
      "timestamp": "1755662038",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "0dd1b47648295fb1a0b5ee291eca1cb5",
        "expiration_timestamp": "1755662038",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 06:54:05,931 - server - INFO - Message queued for processing
2025-08-20 06:54:05,932 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:54:05,933 - server - INFO - No messages in webhook
2025-08-20 06:54:05,934 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:54:05,934 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:6::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=c0c4b95e79c3c97a5ebd521c99e025084cdfb19b', 'x-hub-signature-256': 'sha256=f372f42b99a648856e66d2f68eaebb5237b09c4ba90fe4482f58fa05324e54d1'}
2025-08-20 06:54:05,937 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOUZGN0I1MTE1MzdFNjMxN0M2AA==",
                "status": "read",
                "timestamp": "1755662039",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "0dd1b47648295fb1a0b5ee291eca1cb5",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:54:05,942 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:54:05,942 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOUZGN0I1MTE1MzdFNjMxN0M2AA==",
      "status": "read",
      "timestamp": "1755662039",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "0dd1b47648295fb1a0b5ee291eca1cb5",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 06:54:05,945 - server - INFO - Message queued for processing
2025-08-20 06:54:05,945 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:54:05,947 - server - INFO - No messages in webhook
2025-08-20 06:54:12,843 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 06:54:12,843 - server - ERROR - Error sending message to +15551926618: Client error '400 Bad Request' for url 'https://graph.facebook.com/v18.0/764456666746638/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-08-20 06:54:12,844 - server - WARNING - Failed to send owner notification: 
2025-08-20 06:54:12,844 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 06:54:12,845 - server - INFO - Message processed successfully for 254702944890
2025-08-20 06:54:27,365 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:54:27,365 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '477', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:74::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=ff41cffc142d94570aa2d82f2112fb2357ce4854', 'x-hub-signature-256': 'sha256=8b9f874daba35827d5273fd406d124b61e189ef23272b50fb8c03492b0ba9163'}
2025-08-20 06:54:27,366 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "."
                },
                "wa_id": "254745026933"
              }
            ],
            "messages": [
              {
                "from": "254745026933",
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAEhggMUMwRDlCN0VEQTY2RTA5MkFGMTA5ODI2QUJGREU5OTcA",
                "timestamp": "1755662065",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:54:27,369 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:54:27,369 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "."
      },
      "wa_id": "254745026933"
    }
  ],
  "messages": [
    {
      "from": "254745026933",
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAEhggMUMwRDlCN0VEQTY2RTA5MkFGMTA5ODI2QUJGREU5OTcA",
      "timestamp": "1755662065",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 06:54:27,372 - server - INFO - Message ID: wamid.HBgMMjU0NzQ1MDI2OTMzFQIAEhggMUMwRDlCN0VEQTY2RTA5MkFGMTA5ODI2QUJGREU5OTcA
2025-08-20 06:54:27,372 - server - INFO - From: 254745026933
2025-08-20 06:54:27,372 - server - INFO - Timestamp: 1755662065
2025-08-20 06:54:27,373 - server - INFO - Type: text
2025-08-20 06:54:27,373 - server - INFO - Content: Hi
2025-08-20 06:54:27,373 - server - INFO - Message queued for processing
2025-08-20 06:54:27,374 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:54:27,375 - server - INFO - Processing message from 254745026933: Hi
2025-08-20 06:54:27,377 - server - INFO - Created new contact: 254745026933
2025-08-20 06:54:27,379 - server - INFO - Created new conversation: 9bc1f1eb-d72e-4818-874e-c1426bf0f5df
2025-08-20 06:54:29,046 - server - ERROR - Error classifying message: Expecting value: line 1 column 1 (char 0)
2025-08-20 06:54:30,989 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 06:54:30,990 - server - ERROR - Error sending message to 254745026933: Client error '400 Bad Request' for url 'https://graph.facebook.com/v18.0/764456666746638/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-08-20 06:54:30,991 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 06:54:49,875 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:54:49,875 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '486', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:70::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=76a8af82a4590a76a0e960621d3d4246131db5c3', 'x-hub-signature-256': 'sha256=37cbd70158c4df4b7f7eb6ab69d0323fb4c66333c4103a02a41b7fa266450286'}
2025-08-20 06:54:49,876 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "."
                },
                "wa_id": "254745026933"
              }
            ],
            "messages": [
              {
                "from": "254745026933",
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAEhggQTFENkE0MURGM0UyMzk4MDcxMjQyNzQyRUZFQzFBNTgA",
                "timestamp": "1755662087",
                "text": {
                  "body": "How are you"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:54:49,878 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:54:49,879 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "."
      },
      "wa_id": "254745026933"
    }
  ],
  "messages": [
    {
      "from": "254745026933",
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAEhggQTFENkE0MURGM0UyMzk4MDcxMjQyNzQyRUZFQzFBNTgA",
      "timestamp": "1755662087",
      "text": {
        "body": "How are you"
      },
      "type": "text"
    }
  ]
}
2025-08-20 06:54:49,880 - server - INFO - Message ID: wamid.HBgMMjU0NzQ1MDI2OTMzFQIAEhggQTFENkE0MURGM0UyMzk4MDcxMjQyNzQyRUZFQzFBNTgA
2025-08-20 06:54:49,881 - server - INFO - From: 254745026933
2025-08-20 06:54:49,881 - server - INFO - Timestamp: 1755662087
2025-08-20 06:54:49,881 - server - INFO - Type: text
2025-08-20 06:54:49,882 - server - INFO - Content: How are you
2025-08-20 06:54:49,882 - server - INFO - Message queued for processing
2025-08-20 06:54:49,882 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:54:49,884 - server - INFO - Processing message from 254745026933: How are you
2025-08-20 06:54:51,941 - server - ERROR - Error classifying message: Expecting value: line 1 column 1 (char 0)
2025-08-20 06:54:54,960 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 06:54:54,969 - server - ERROR - Error sending message to 254745026933: Client error '400 Bad Request' for url 'https://graph.facebook.com/v18.0/764456666746638/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-08-20 06:54:54,970 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 06:55:56,443 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:55:56,444 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '521', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:70::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=d3133106c5a05174c8e6b1e1c5e486db0c1987a6', 'x-hub-signature-256': 'sha256=c338ada3923785c2cb2d43ae25206e7e1c47dde1f9eb2e436d9870530d8753b1'}
2025-08-20 06:55:56,445 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNzcxM0EzOTMyQzZDQjcyNzdGRkI2RjhERjdBMTMyODkA",
                "timestamp": "1755662153",
                "text": {
                  "body": "Change your tone you are too strict"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:55:56,448 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:55:56,449 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNzcxM0EzOTMyQzZDQjcyNzdGRkI2RjhERjdBMTMyODkA",
      "timestamp": "1755662153",
      "text": {
        "body": "Change your tone you are too strict"
      },
      "type": "text"
    }
  ]
}
2025-08-20 06:55:56,451 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNzcxM0EzOTMyQzZDQjcyNzdGRkI2RjhERjdBMTMyODkA
2025-08-20 06:55:56,451 - server - INFO - From: 254702944890
2025-08-20 06:55:56,452 - server - INFO - Timestamp: 1755662153
2025-08-20 06:55:56,452 - server - INFO - Type: text
2025-08-20 06:55:56,452 - server - INFO - Content: Change your tone you are too strict
2025-08-20 06:55:56,453 - server - INFO - Message queued for processing
2025-08-20 06:55:56,453 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:55:56,455 - server - INFO - Processing message from 254702944890: Change your tone you are too strict
2025-08-20 06:55:58,530 - server - ERROR - Error classifying message: Expecting value: line 1 column 1 (char 0)
2025-08-20 06:56:02,767 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 06:56:02,768 - server - INFO - Message sent to 254702944890: Please state your name and the purpose of your mes...
2025-08-20 06:56:05,742 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'service': 'drive.googleapis.com', 'containerInfo': '260626823147', 'consumer': 'projects/260626823147', 'serviceTitle': 'Google Drive API', 'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 06:56:05,747 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 06:56:05,762 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:56:05,762 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:7::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=41db3fb5e6793249fcef6da7048d644879cd0ed7', 'x-hub-signature-256': 'sha256=a85f3dc235574d8e811a49f7e7e33c0e273dcd0f872f73e32bb035c0e021c29e'}
2025-08-20 06:56:05,763 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSODZGRjE3NDI3RjYzRDZDNkM3AA==",
                "status": "sent",
                "timestamp": "1755662161",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "a506007e49aa868d778f7d9193715c3b",
                  "expiration_timestamp": "1755662161",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:56:05,766 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:56:05,766 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSODZGRjE3NDI3RjYzRDZDNkM3AA==",
      "status": "sent",
      "timestamp": "1755662161",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "a506007e49aa868d778f7d9193715c3b",
        "expiration_timestamp": "1755662161",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 06:56:05,768 - server - INFO - Message queued for processing
2025-08-20 06:56:05,768 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:56:05,770 - server - INFO - No messages in webhook
2025-08-20 06:56:05,770 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:56:05,771 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:12ff:70::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=a491c7f24b4edb4eba61ff81637944468b2b695e', 'x-hub-signature-256': 'sha256=d1865eb732f3f29da5400f17b860838bb8ab20e68807605f63d21ddaa08025b3'}
2025-08-20 06:56:05,772 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSODZGRjE3NDI3RjYzRDZDNkM3AA==",
                "status": "read",
                "timestamp": "1755662163",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "a506007e49aa868d778f7d9193715c3b",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:56:05,778 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:56:05,778 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSODZGRjE3NDI3RjYzRDZDNkM3AA==",
      "status": "read",
      "timestamp": "1755662163",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "a506007e49aa868d778f7d9193715c3b",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 06:56:05,780 - server - INFO - Message queued for processing
2025-08-20 06:56:05,780 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:56:05,782 - server - INFO - No messages in webhook
2025-08-20 06:56:10,952 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 06:56:10,953 - server - ERROR - Error sending message to +15551926618: Client error '400 Bad Request' for url 'https://graph.facebook.com/v18.0/764456666746638/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-08-20 06:56:10,954 - server - WARNING - Failed to send owner notification: 
2025-08-20 06:56:10,954 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 06:56:10,955 - server - INFO - Message processed successfully for 254702944890
2025-08-20 06:56:46,246 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:56:46,246 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '584', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:12ff:70::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=81e00e768d248fb06603ab569b1bef17c43ac44f', 'x-hub-signature-256': 'sha256=d7d7cb1d4a3195d56c003c0e5be67e8dd362da268cbd046e38d8e103f41ad842'}
2025-08-20 06:56:46,247 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggQ0M2Qjg4RjQ2MDE0NUVCOTNDQUY0RUQ0NUI1OUI4RjAA",
                "timestamp": "1755662199",
                "type": "image",
                "image": {
                  "mime_type": "image/jpeg",
                  "sha256": "VSmbh5OEMup6GGaD+Qh361H9OQKj8uw7Ai30jRpac50=",
                  "id": "1182917060234553"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:56:46,249 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:56:46,250 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggQ0M2Qjg4RjQ2MDE0NUVCOTNDQUY0RUQ0NUI1OUI4RjAA",
      "timestamp": "1755662199",
      "type": "image",
      "image": {
        "mime_type": "image/jpeg",
        "sha256": "VSmbh5OEMup6GGaD+Qh361H9OQKj8uw7Ai30jRpac50=",
        "id": "1182917060234553"
      }
    }
  ]
}
2025-08-20 06:56:46,253 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggQ0M2Qjg4RjQ2MDE0NUVCOTNDQUY0RUQ0NUI1OUI4RjAA
2025-08-20 06:56:46,253 - server - INFO - From: 254702944890
2025-08-20 06:56:46,254 - server - INFO - Timestamp: 1755662199
2025-08-20 06:56:46,254 - server - INFO - Type: image
2025-08-20 06:56:46,254 - server - INFO - Message queued for processing
2025-08-20 06:56:46,255 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:56:46,256 - server - INFO - Processing message from 254702944890: [IMAGE message received]
2025-08-20 06:56:47,899 - server - ERROR - Error classifying message: Expecting value: line 1 column 1 (char 0)
2025-08-20 06:56:52,103 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 06:56:52,106 - server - INFO - Message sent to 254702944890: Please state your name and the purpose of this ima...
2025-08-20 06:56:54,071 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'serviceTitle': 'Google Drive API', 'containerInfo': '260626823147', 'service': 'drive.googleapis.com', 'consumer': 'projects/260626823147'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 06:56:54,074 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 06:56:54,092 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:56:54,093 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:3::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=e27b1f26dc48212a2c9275d30384f33dae9e4e6a', 'x-hub-signature-256': 'sha256=20ba686ebffb247b66154ee1ea6ed895faa65de80d218d8b869c90bb0dabdea1'}
2025-08-20 06:56:54,093 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSN0M0MzMwMzM5NUQ2Q0YwNjg3AA==",
                "status": "read",
                "timestamp": "1755662212",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "4373a23fe7e59624cf989f0f1a976df2",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:56:54,095 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:56:54,096 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSN0M0MzMwMzM5NUQ2Q0YwNjg3AA==",
      "status": "read",
      "timestamp": "1755662212",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "4373a23fe7e59624cf989f0f1a976df2",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 06:56:54,098 - server - INFO - Message queued for processing
2025-08-20 06:56:54,099 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:56:54,100 - server - INFO - No messages in webhook
2025-08-20 06:56:54,101 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 06:56:54,101 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:44::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=809ce504fe0131b3556520fc5332182b1277c069', 'x-hub-signature-256': 'sha256=5344728b00172d10fba72fa69d4fe0a6a714dcd9b261ced1982eee0c66d5bf31'}
2025-08-20 06:56:54,102 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSN0M0MzMwMzM5NUQ2Q0YwNjg3AA==",
                "status": "sent",
                "timestamp": "1755662211",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "4373a23fe7e59624cf989f0f1a976df2",
                  "expiration_timestamp": "1755662211",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 06:56:54,105 - server - INFO - Entry ID: 648237557784508
2025-08-20 06:56:54,105 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSN0M0MzMwMzM5NUQ2Q0YwNjg3AA==",
      "status": "sent",
      "timestamp": "1755662211",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "4373a23fe7e59624cf989f0f1a976df2",
        "expiration_timestamp": "1755662211",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 06:56:54,108 - server - INFO - Message queued for processing
2025-08-20 06:56:54,109 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 06:56:54,111 - server - INFO - No messages in webhook
2025-08-20 06:56:55,773 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 06:56:55,775 - server - ERROR - Error sending message to +15551926618: Client error '400 Bad Request' for url 'https://graph.facebook.com/v18.0/764456666746638/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-08-20 06:56:55,776 - server - WARNING - Failed to send owner notification: 
2025-08-20 06:56:55,776 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 06:56:55,776 - server - INFO - Message processed successfully for 254702944890
2025-08-20 07:01:14,057 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:01:14,058 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '488', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:8::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=c84ec9c05263b09609726bc1310fc22e12b395c8', 'x-hub-signature-256': 'sha256=b86423eec0c59e8740ec9e1c4712fc01b03fd02a67a57f510200e945f818b502'}
2025-08-20 07:01:14,059 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMTAwMzY1MTYzMjc4MUJCMkNEMUQwQjM1QjMyMkNGM0MA",
                "timestamp": "1755662471",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 07:01:14,062 - server - INFO - Entry ID: 648237557784508
2025-08-20 07:01:14,063 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMTAwMzY1MTYzMjc4MUJCMkNEMUQwQjM1QjMyMkNGM0MA",
      "timestamp": "1755662471",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 07:01:14,065 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMTAwMzY1MTYzMjc4MUJCMkNEMUQwQjM1QjMyMkNGM0MA
2025-08-20 07:01:14,066 - server - INFO - From: 254702944890
2025-08-20 07:01:14,066 - server - INFO - Timestamp: 1755662471
2025-08-20 07:01:14,066 - server - INFO - Type: text
2025-08-20 07:01:14,067 - server - INFO - Content: Hi
2025-08-20 07:01:14,067 - server - INFO - Message queued for processing
2025-08-20 07:01:14,067 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:01:14,069 - server - INFO - Processing message from 254702944890: Hi
2025-08-20 07:01:19,016 - server - ERROR - Error classifying message: Expecting value: line 1 column 1 (char 0)
2025-08-20 07:01:19,628 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:01:19,629 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '488', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:4::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=e29cbcb5d1d6e19a6f72a0215ba447978c91419a', 'x-hub-signature-256': 'sha256=a2a98982c6ddc73923dcb4b0a03a598ec09dbc6d7af7ef2a48308cb441f4f0e5'}
2025-08-20 07:01:19,630 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggODI1ODQ4NjExNTlERjRGMzc4NkRBMDlBMjI3RTJCMkYA",
                "timestamp": "1755662447",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 07:01:19,632 - server - INFO - Entry ID: 648237557784508
2025-08-20 07:01:19,633 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggODI1ODQ4NjExNTlERjRGMzc4NkRBMDlBMjI3RTJCMkYA",
      "timestamp": "1755662447",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 07:01:19,635 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggODI1ODQ4NjExNTlERjRGMzc4NkRBMDlBMjI3RTJCMkYA
2025-08-20 07:01:19,636 - server - INFO - From: 254702944890
2025-08-20 07:01:19,636 - server - INFO - Timestamp: 1755662447
2025-08-20 07:01:19,636 - server - INFO - Type: text
2025-08-20 07:01:19,637 - server - INFO - Content: Hi
2025-08-20 07:01:19,637 - server - INFO - Message queued for processing
2025-08-20 07:01:19,637 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:01:19,639 - server - INFO - Processing message from 254702944890: Hi
2025-08-20 07:01:21,410 - server - ERROR - Error classifying message: Expecting value: line 1 column 1 (char 0)
2025-08-20 07:01:27,633 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 07:01:27,634 - server - INFO - Message sent to 254702944890: Please state your name and the purpose of your mes...
2025-08-20 07:01:40,047 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'containerInfo': '260626823147', 'service': 'drive.googleapis.com', 'serviceTitle': 'Google Drive API', 'consumer': 'projects/260626823147'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 07:01:40,051 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 07:01:40,066 - server - ERROR - Error sending message to 254702944890: 
2025-08-20 07:01:40,067 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 07:01:40,069 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:01:40,069 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:12ff:1::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=ef6c9deeacbe56b2932cb2701f14f4c5b808d63c', 'x-hub-signature-256': 'sha256=be20528862287549f1733a48dfb12fb283cf312798208193385f124974fc3f29'}
2025-08-20 07:01:40,070 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQzYxRjNFMjBFQjg5Nzc1NThCAA==",
                "status": "read",
                "timestamp": "1755662488",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "d9d78861e537c722f42ca1e1dd90ad2d",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 07:01:40,075 - server - INFO - Entry ID: 648237557784508
2025-08-20 07:01:40,076 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQzYxRjNFMjBFQjg5Nzc1NThCAA==",
      "status": "read",
      "timestamp": "1755662488",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "d9d78861e537c722f42ca1e1dd90ad2d",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 07:01:40,079 - server - INFO - Message queued for processing
2025-08-20 07:01:40,079 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:01:40,081 - server - INFO - No messages in webhook
2025-08-20 07:01:40,082 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:01:40,083 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:c::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=d6b98558636b36430bef858b081ff0ff8250b6cf', 'x-hub-signature-256': 'sha256=31d5f5fca8605de03b68c0ba729ee519f05a748ede834ccc46c51f447e9d6077'}
2025-08-20 07:01:40,084 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQzYxRjNFMjBFQjg5Nzc1NThCAA==",
                "status": "sent",
                "timestamp": "1755662487",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "d9d78861e537c722f42ca1e1dd90ad2d",
                  "expiration_timestamp": "1755662487",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 07:01:40,087 - server - INFO - Entry ID: 648237557784508
2025-08-20 07:01:40,088 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQzYxRjNFMjBFQjg5Nzc1NThCAA==",
      "status": "sent",
      "timestamp": "1755662487",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "d9d78861e537c722f42ca1e1dd90ad2d",
        "expiration_timestamp": "1755662487",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 07:01:40,091 - server - INFO - Message queued for processing
2025-08-20 07:01:40,092 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:01:40,094 - server - INFO - No messages in webhook
2025-08-20 07:01:40,095 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:01:40,095 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:48::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=3592fc257d82285e65bf2b0cf3a13f163f2d9742', 'x-hub-signature-256': 'sha256=029e692868af5146a50596e212a5c49d8e7adfd3c86eea0bff632f82e2ed5793'}
2025-08-20 07:01:40,095 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRkNENzYyNjQzMzYzNTY0RjM0AA==",
                "status": "sent",
                "timestamp": "1755662487",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "c68aeeb3e64963fa12c024780392d796",
                  "expiration_timestamp": "1755662487",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 07:01:40,099 - server - INFO - Entry ID: 648237557784508
2025-08-20 07:01:40,099 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRkNENzYyNjQzMzYzNTY0RjM0AA==",
      "status": "sent",
      "timestamp": "1755662487",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "c68aeeb3e64963fa12c024780392d796",
        "expiration_timestamp": "1755662487",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 07:01:40,101 - server - INFO - Message queued for processing
2025-08-20 07:01:40,102 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:01:40,103 - server - INFO - No messages in webhook
2025-08-20 07:01:40,104 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:01:40,105 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:12ff:1::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=63957a8b8a06f88903281df42c9c9333214d9b63', 'x-hub-signature-256': 'sha256=e11bc80b32ace26aca94adfef6238635de6abc54726bd1fe7591a4002956d238'}
2025-08-20 07:01:40,106 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRkNENzYyNjQzMzYzNTY0RjM0AA==",
                "status": "read",
                "timestamp": "1755662488",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "c68aeeb3e64963fa12c024780392d796",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 07:01:40,111 - server - INFO - Entry ID: 648237557784508
2025-08-20 07:01:40,111 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRkNENzYyNjQzMzYzNTY0RjM0AA==",
      "status": "read",
      "timestamp": "1755662488",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "c68aeeb3e64963fa12c024780392d796",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 07:01:40,114 - server - INFO - Message queued for processing
2025-08-20 07:01:40,114 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:01:40,116 - server - INFO - No messages in webhook
2025-08-20 07:01:41,573 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 07:01:41,574 - server - ERROR - Error sending message to +15551926618: Client error '400 Bad Request' for url 'https://graph.facebook.com/v18.0/764456666746638/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-08-20 07:01:41,575 - server - WARNING - Failed to send owner notification: 
2025-08-20 07:01:41,575 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 07:01:41,575 - server - INFO - Message processed successfully for 254702944890
2025-08-20 07:04:39,912 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:04:39,913 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '489', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:41::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=ca8968a7c8ff8ba21702c74431ee7c2d2257dd90', 'x-hub-signature-256': 'sha256=5d95585e38a9316adf4b8f619b9822b944e7e237c670c18671c5866ae1b07886'}
2025-08-20 07:04:39,914 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMUM1MjVDNjk1OURENDU3QzRFQUJBQjhFMkUyOTVFNzcA",
                "timestamp": "1755662678",
                "text": {
                  "body": "Bye"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 07:04:39,916 - server - INFO - Entry ID: 648237557784508
2025-08-20 07:04:39,916 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMUM1MjVDNjk1OURENDU3QzRFQUJBQjhFMkUyOTVFNzcA",
      "timestamp": "1755662678",
      "text": {
        "body": "Bye"
      },
      "type": "text"
    }
  ]
}
2025-08-20 07:04:39,919 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMUM1MjVDNjk1OURENDU3QzRFQUJBQjhFMkUyOTVFNzcA
2025-08-20 07:04:39,919 - server - INFO - From: 254702944890
2025-08-20 07:04:39,920 - server - INFO - Timestamp: 1755662678
2025-08-20 07:04:39,920 - server - INFO - Type: text
2025-08-20 07:04:39,920 - server - INFO - Content: Bye
2025-08-20 07:04:39,921 - server - INFO - Message queued for processing
2025-08-20 07:04:39,921 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:04:39,922 - server - INFO - Processing message from 254702944890: Bye
2025-08-20 07:04:42,015 - server - ERROR - Error classifying message: Expecting value: line 1 column 1 (char 0)
2025-08-20 07:04:53,198 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 07:04:53,199 - server - INFO - Message sent to 254702944890: Please state your name and the purpose of your mes...
2025-08-20 07:04:54,323 - server - ERROR - Error generating summary: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 6
}
]
2025-08-20 07:04:55,469 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'service': 'drive.googleapis.com', 'consumer': 'projects/260626823147', 'containerInfo': '260626823147', 'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'serviceTitle': 'Google Drive API'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 07:04:55,474 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 07:04:55,491 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:04:55,491 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:2::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=37c2f9518e58d8efb43757d6d30645fbb69d1a30', 'x-hub-signature-256': 'sha256=ecc4defcb3bdd5afec00f3fcf0a0cad7e14dfc2bc07107d33606ee3f22495b0a'}
2025-08-20 07:04:55,496 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOTQ4NTkwNUU3NkI2OTVFRDRFAA==",
                "status": "sent",
                "timestamp": "1755662692",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "92395d2a5cce9f671131077bbe729111",
                  "expiration_timestamp": "1755662692",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 07:04:55,499 - server - INFO - Entry ID: 648237557784508
2025-08-20 07:04:55,499 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOTQ4NTkwNUU3NkI2OTVFRDRFAA==",
      "status": "sent",
      "timestamp": "1755662692",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "92395d2a5cce9f671131077bbe729111",
        "expiration_timestamp": "1755662692",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 07:04:55,501 - server - INFO - Message queued for processing
2025-08-20 07:04:55,501 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:04:55,503 - server - INFO - No messages in webhook
2025-08-20 07:04:56,560 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:04:56,560 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:8::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=e942c7637268f54f9a7084fb8594420197508f2d', 'x-hub-signature-256': 'sha256=4e68f6ea2ff3c4fdfb1ab46ae29394dc0a61e8af326238351d78ec2a2e5dd634'}
2025-08-20 07:04:56,561 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOTQ4NTkwNUU3NkI2OTVFRDRFAA==",
                "status": "read",
                "timestamp": "1755662694",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "92395d2a5cce9f671131077bbe729111",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 07:04:56,564 - server - INFO - Entry ID: 648237557784508
2025-08-20 07:04:56,565 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOTQ4NTkwNUU3NkI2OTVFRDRFAA==",
      "status": "read",
      "timestamp": "1755662694",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "92395d2a5cce9f671131077bbe729111",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 07:04:56,566 - server - INFO - Message queued for processing
2025-08-20 07:04:56,566 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:04:56,568 - server - INFO - No messages in webhook
2025-08-20 07:04:57,878 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 07:04:57,879 - server - ERROR - Error sending message to +15551926618: Client error '400 Bad Request' for url 'https://graph.facebook.com/v18.0/764456666746638/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-08-20 07:04:57,880 - server - WARNING - Failed to send owner notification: 
2025-08-20 07:04:57,880 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 07:04:57,880 - server - INFO - Message processed successfully for 254702944890
2025-08-20 07:06:24,733 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:06:24,733 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '497', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:73::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=f5899eeb3b9f5c98d13dfbad7381df94b2780be3', 'x-hub-signature-256': 'sha256=5ea38a5477a9ecdb555072a11803e2e4f3e8b7414f886adb3ab1e23782c467d4'}
2025-08-20 07:06:24,733 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNDg0NjE5RjAyRjUzNUU5OTM1NDc5RjdDQTAyOTcyODAA",
                "timestamp": "1755662782",
                "text": {
                  "body": "Yoooh,niaje"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 07:06:24,736 - server - INFO - Entry ID: 648237557784508
2025-08-20 07:06:24,736 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNDg0NjE5RjAyRjUzNUU5OTM1NDc5RjdDQTAyOTcyODAA",
      "timestamp": "1755662782",
      "text": {
        "body": "Yoooh,niaje"
      },
      "type": "text"
    }
  ]
}
2025-08-20 07:06:24,737 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNDg0NjE5RjAyRjUzNUU5OTM1NDc5RjdDQTAyOTcyODAA
2025-08-20 07:06:24,738 - server - INFO - From: 254702944890
2025-08-20 07:06:24,738 - server - INFO - Timestamp: 1755662782
2025-08-20 07:06:24,738 - server - INFO - Type: text
2025-08-20 07:06:24,739 - server - INFO - Content: Yoooh,niaje
2025-08-20 07:06:24,739 - server - INFO - Message queued for processing
2025-08-20 07:06:24,739 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:06:24,741 - server - INFO - Processing message from 254702944890: Yoooh,niaje
2025-08-20 07:06:25,664 - server - ERROR - Error classifying message: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 35
}
]
2025-08-20 07:06:26,301 - server - ERROR - Error generating AI response: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 34
}
]
2025-08-20 07:06:31,820 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 07:06:31,821 - server - INFO - Message sent to 254702944890: Thank you for your message. I'll get back to you s...
2025-08-20 07:06:32,634 - server - ERROR - Error generating summary: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 28
}
]
2025-08-20 07:06:33,484 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'serviceTitle': 'Google Drive API', 'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'containerInfo': '260626823147', 'service': 'drive.googleapis.com', 'consumer': 'projects/260626823147'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 07:06:33,486 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 07:06:35,494 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:06:35,495 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:4c::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=265df43fe02956160ac23a78215feb657531e539', 'x-hub-signature-256': 'sha256=b776e5481876513771dfa4f53d4e320d353dcb179c38d12c736e122f1c5580bd'}
2025-08-20 07:06:35,496 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQkZFRUQyQzgxRTJGNjAzNEE0AA==",
                "status": "sent",
                "timestamp": "1755662790",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "944bb9de6794805091baf6a72e243c8b",
                  "expiration_timestamp": "1755662790",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 07:06:35,499 - server - INFO - Entry ID: 648237557784508
2025-08-20 07:06:35,499 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQkZFRUQyQzgxRTJGNjAzNEE0AA==",
      "status": "sent",
      "timestamp": "1755662790",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "944bb9de6794805091baf6a72e243c8b",
        "expiration_timestamp": "1755662790",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 07:06:35,502 - server - INFO - Message queued for processing
2025-08-20 07:06:35,503 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:06:35,504 - server - INFO - No messages in webhook
2025-08-20 07:06:35,506 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:06:35,506 - server - INFO - Headers: {'host': 'c298a35b2b7f.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:12ff:6::', 'x-forwarded-host': 'c298a35b2b7f.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=77caee4a309008782cba04cfc53a1a31193a4ae5', 'x-hub-signature-256': 'sha256=83d99ce3f7b62396d5afde152577fa5b0cd67a1b13ca0647d22f7972546846f8'}
2025-08-20 07:06:35,507 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQkZFRUQyQzgxRTJGNjAzNEE0AA==",
                "status": "read",
                "timestamp": "1755662792",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "944bb9de6794805091baf6a72e243c8b",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 07:06:35,512 - server - INFO - Entry ID: 648237557784508
2025-08-20 07:06:35,512 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQkZFRUQyQzgxRTJGNjAzNEE0AA==",
      "status": "read",
      "timestamp": "1755662792",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "944bb9de6794805091baf6a72e243c8b",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 07:06:35,514 - server - INFO - Message queued for processing
2025-08-20 07:06:35,515 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:06:35,516 - server - INFO - No messages in webhook
2025-08-20 07:06:37,434 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 07:06:37,435 - server - ERROR - Error sending message to +15551926618: Client error '400 Bad Request' for url 'https://graph.facebook.com/v18.0/764456666746638/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-08-20 07:06:37,436 - server - WARNING - Failed to send owner notification: 
2025-08-20 07:06:37,436 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 07:06:37,436 - server - INFO - Message processed successfully for 254702944890
2025-08-20 07:20:10,239 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 07:20:10,267 - server - INFO - Connected to MongoDB successfully
2025-08-20 07:20:10,270 - server - INFO - Google Sheets client initialized
2025-08-20 07:48:26,863 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 07:48:26,887 - server - INFO - Connected to MongoDB successfully
2025-08-20 07:48:26,889 - server - INFO - Google Sheets client initialized
2025-08-20 07:49:12,590 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 07:49:12,608 - server - INFO - Connected to MongoDB successfully
2025-08-20 07:49:12,611 - server - INFO - Google Sheets client initialized
2025-08-20 07:52:24,565 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 07:52:24,590 - server - INFO - Connected to MongoDB successfully
2025-08-20 07:52:24,591 - server - INFO - Google Sheets client initialized
2025-08-20 07:52:33,364 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 07:52:33,401 - server - INFO - Connected to MongoDB successfully
2025-08-20 07:52:33,404 - server - INFO - Google Sheets client initialized
2025-08-20 07:53:13,324 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:53:13,324 - server - INFO - Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.19041.6216', 'content-type': 'application/json', 'host': '127.0.0.1:8001', 'content-length': '1384', 'expect': '100-continue', 'connection': 'Keep-Alive'}
2025-08-20 07:53:13,327 - server - INFO - Raw webhook payload: {
  "entry": [
    {
      "id": "test_entry",
      "changes": [
        {
          "value": {
            "messages": [
              {
                "from": "+15551234567",
                "timestamp": "1692547201",
                "id": "test_msg_1",
                "type": "text",
                "text": {
                  "body": "Test message 1"
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
2025-08-20 07:53:13,329 - server - INFO - Entry ID: test_entry
2025-08-20 07:53:13,329 - server - INFO - Change Value: {
  "messages": [
    {
      "from": "+15551234567",
      "timestamp": "1692547201",
      "id": "test_msg_1",
      "type": "text",
      "text": {
        "body": "Test message 1"
      }
    }
  ]
}
2025-08-20 07:53:13,331 - server - INFO - Message ID: test_msg_1
2025-08-20 07:53:13,332 - server - INFO - From: +15551234567
2025-08-20 07:53:13,332 - server - INFO - Timestamp: 1692547201
2025-08-20 07:53:13,333 - server - INFO - Type: text
2025-08-20 07:53:13,333 - server - INFO - Content: Test message 1
2025-08-20 07:53:13,333 - server - INFO - Message queued for processing
2025-08-20 07:53:13,334 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:53:13,335 - server - INFO - Processing message from +15551234567: Test message 1
2025-08-20 07:53:13,340 - server - INFO - Created new contact: +15551234567
2025-08-20 07:53:13,343 - server - INFO - Created new conversation: a7ad429d-974e-46f4-8550-dc68872a4035
2025-08-20 07:53:15,549 - server - ERROR - Error classifying message: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 45
}
]
2025-08-20 07:53:16,124 - server - ERROR - Error generating AI response: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 44
}
]
2025-08-20 07:53:16,179 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:53:16,180 - server - INFO - Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.19041.6216', 'content-type': 'application/json', 'host': '127.0.0.1:8001', 'content-length': '1384', 'expect': '100-continue'}
2025-08-20 07:53:16,181 - server - INFO - Raw webhook payload: {
  "entry": [
    {
      "id": "test_entry",
      "changes": [
        {
          "value": {
            "messages": [
              {
                "from": "+15551234567",
                "timestamp": "1692547202",
                "id": "test_msg_2",
                "type": "text",
                "text": {
                  "body": "Test message 2"
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
2025-08-20 07:53:16,183 - server - INFO - Entry ID: test_entry
2025-08-20 07:53:16,184 - server - INFO - Change Value: {
  "messages": [
    {
      "from": "+15551234567",
      "timestamp": "1692547202",
      "id": "test_msg_2",
      "type": "text",
      "text": {
        "body": "Test message 2"
      }
    }
  ]
}
2025-08-20 07:53:16,185 - server - INFO - Message ID: test_msg_2
2025-08-20 07:53:16,185 - server - INFO - From: +15551234567
2025-08-20 07:53:16,186 - server - INFO - Timestamp: 1692547202
2025-08-20 07:53:16,186 - server - INFO - Type: text
2025-08-20 07:53:16,186 - server - INFO - Content: Test message 2
2025-08-20 07:53:16,187 - server - INFO - Message queued for processing
2025-08-20 07:53:16,187 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:53:16,188 - server - INFO - Processing message from +15551234567: Test message 2
2025-08-20 07:53:16,684 - server - ERROR - Error classifying message: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 43
}
]
2025-08-20 07:53:17,243 - server - ERROR - Error generating AI response: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 43
}
]
2025-08-20 07:53:17,259 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:53:17,260 - server - INFO - Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.19041.6216', 'content-type': 'application/json', 'host': '127.0.0.1:8001', 'content-length': '1384', 'expect': '100-continue'}
2025-08-20 07:53:17,260 - server - INFO - Raw webhook payload: {
  "entry": [
    {
      "id": "test_entry",
      "changes": [
        {
          "value": {
            "messages": [
              {
                "from": "+15551234567",
                "timestamp": "1692547203",
                "id": "test_msg_3",
                "type": "text",
                "text": {
                  "body": "Test message 3"
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
2025-08-20 07:53:17,263 - server - INFO - Entry ID: test_entry
2025-08-20 07:53:17,264 - server - INFO - Change Value: {
  "messages": [
    {
      "from": "+15551234567",
      "timestamp": "1692547203",
      "id": "test_msg_3",
      "type": "text",
      "text": {
        "body": "Test message 3"
      }
    }
  ]
}
2025-08-20 07:53:17,265 - server - INFO - Message ID: test_msg_3
2025-08-20 07:53:17,266 - server - INFO - From: +15551234567
2025-08-20 07:53:17,266 - server - INFO - Timestamp: 1692547203
2025-08-20 07:53:17,266 - server - INFO - Type: text
2025-08-20 07:53:17,266 - server - INFO - Content: Test message 3
2025-08-20 07:53:17,267 - server - INFO - Message queued for processing
2025-08-20 07:53:17,267 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:53:17,269 - server - INFO - Processing message from +15551234567: Test message 3
2025-08-20 07:53:18,110 - server - ERROR - Error classifying message: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 42
}
]
2025-08-20 07:53:18,703 - server - ERROR - Error generating AI response: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 42
}
]
2025-08-20 07:53:18,719 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:53:18,720 - server - INFO - Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.19041.6216', 'content-type': 'application/json', 'host': '127.0.0.1:8001', 'content-length': '1384', 'expect': '100-continue'}
2025-08-20 07:53:18,721 - server - INFO - Raw webhook payload: {
  "entry": [
    {
      "id": "test_entry",
      "changes": [
        {
          "value": {
            "messages": [
              {
                "from": "+15551234567",
                "timestamp": "1692547204",
                "id": "test_msg_4",
                "type": "text",
                "text": {
                  "body": "Test message 4"
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
2025-08-20 07:53:18,722 - server - INFO - Entry ID: test_entry
2025-08-20 07:53:18,722 - server - INFO - Change Value: {
  "messages": [
    {
      "from": "+15551234567",
      "timestamp": "1692547204",
      "id": "test_msg_4",
      "type": "text",
      "text": {
        "body": "Test message 4"
      }
    }
  ]
}
2025-08-20 07:53:18,723 - server - INFO - Message ID: test_msg_4
2025-08-20 07:53:18,724 - server - INFO - From: +15551234567
2025-08-20 07:53:18,724 - server - INFO - Timestamp: 1692547204
2025-08-20 07:53:18,724 - server - INFO - Type: text
2025-08-20 07:53:18,725 - server - INFO - Content: Test message 4
2025-08-20 07:53:18,725 - server - INFO - Message queued for processing
2025-08-20 07:53:18,725 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:53:18,726 - server - INFO - Processing message from +15551234567: Test message 4
2025-08-20 07:53:19,254 - server - ERROR - Error classifying message: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 41
}
]
2025-08-20 07:53:19,742 - server - ERROR - Error generating AI response: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 40
}
]
2025-08-20 07:53:19,758 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:53:19,758 - server - INFO - Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.19041.6216', 'content-type': 'application/json', 'host': '127.0.0.1:8001', 'content-length': '1384', 'expect': '100-continue'}
2025-08-20 07:53:19,760 - server - INFO - Raw webhook payload: {
  "entry": [
    {
      "id": "test_entry",
      "changes": [
        {
          "value": {
            "messages": [
              {
                "from": "+15551234567",
                "timestamp": "1692547205",
                "id": "test_msg_5",
                "type": "text",
                "text": {
                  "body": "Test message 5"
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
2025-08-20 07:53:19,762 - server - INFO - Entry ID: test_entry
2025-08-20 07:53:19,763 - server - INFO - Change Value: {
  "messages": [
    {
      "from": "+15551234567",
      "timestamp": "1692547205",
      "id": "test_msg_5",
      "type": "text",
      "text": {
        "body": "Test message 5"
      }
    }
  ]
}
2025-08-20 07:53:19,764 - server - INFO - Message ID: test_msg_5
2025-08-20 07:53:19,765 - server - INFO - From: +15551234567
2025-08-20 07:53:19,765 - server - INFO - Timestamp: 1692547205
2025-08-20 07:53:19,765 - server - INFO - Type: text
2025-08-20 07:53:19,766 - server - INFO - Content: Test message 5
2025-08-20 07:53:19,766 - server - INFO - Message queued for processing
2025-08-20 07:53:19,767 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:53:19,768 - server - INFO - Processing message from +15551234567: Test message 5
2025-08-20 07:53:20,179 - server - ERROR - Error classifying message: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 40
}
]
2025-08-20 07:53:20,525 - server - ERROR - Error generating AI response: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 39
}
]
2025-08-20 07:53:21,646 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 07:53:21,660 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 07:53:21,673 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 07:53:21,688 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 07:53:21,713 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 07:53:22,183 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 07:53:22,185 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AQY0yqyIqrIjBhTKYBB_KC3"}}
2025-08-20 07:53:22,185 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 07:53:22,230 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 07:53:22,232 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AybFTzOYA70bcTqC9oZYKTa"}}
2025-08-20 07:53:22,232 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 07:53:22,341 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 07:53:22,342 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AFr6Ap9sf9giRJX6awqJehH"}}
2025-08-20 07:53:22,343 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 07:53:22,370 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 07:53:22,372 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AnkkvLGMZQiTw0KPROwLFLT"}}
2025-08-20 07:53:22,372 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 07:53:22,386 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 07:53:22,387 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AD1CsKy9REhBJR1Ykdtbk5I"}}
2025-08-20 07:53:22,388 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 07:55:02,265 - server - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-20 07:55:02,265 - server - INFO - Received webhook verification request:
2025-08-20 07:55:02,265 - server - INFO -   - Mode: subscribe
2025-08-20 07:55:02,266 - server - INFO -   - Challenge: 854945978
2025-08-20 07:55:02,266 - server - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-20 07:55:02,266 - server - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-20 07:55:02,267 - server - INFO -   - Token Match: True
2025-08-20 07:55:02,269 - server - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-20 07:55:02,269 - server - INFO - Webhook verification SUCCESSFUL
2025-08-20 07:55:02,269 - server - INFO - Returning challenge: 854945978
2025-08-20 07:55:02,269 - server - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-20 07:55:12,371 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 07:55:12,402 - server - INFO - Connected to MongoDB successfully
2025-08-20 07:55:12,405 - server - INFO - Google Sheets client initialized
2025-08-20 07:55:12,420 - server - INFO - ========== WEBHOOK VERIFICATION START ==========
2025-08-20 07:55:12,421 - server - INFO - Received webhook verification request:
2025-08-20 07:55:12,421 - server - INFO -   - Mode: subscribe
2025-08-20 07:55:12,421 - server - INFO -   - Challenge: 1436527863
2025-08-20 07:55:12,421 - server - INFO -   - Verify Token: whatsapp_webhook_2025
2025-08-20 07:55:12,422 - server - INFO -   - Expected Token: whatsapp_webhook_2025
2025-08-20 07:55:12,422 - server - INFO -   - Token Match: True
2025-08-20 07:55:12,424 - server - INFO -   - Token from .env file: whatsapp_webhook_2025
2025-08-20 07:55:12,424 - server - INFO - Webhook verification SUCCESSFUL
2025-08-20 07:55:12,424 - server - INFO - Returning challenge: 1436527863
2025-08-20 07:55:12,425 - server - INFO - ========== WEBHOOK VERIFICATION END ==========
2025-08-20 07:59:22,732 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 07:59:22,750 - server - INFO - Connected to MongoDB successfully
2025-08-20 07:59:22,752 - server - INFO - Google Sheets client initialized
2025-08-20 07:59:35,801 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 07:59:35,802 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '488', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=300e723d94967db37027277fcbd4cf806343d9f3', 'x-hub-signature-256': 'sha256=03e03b9d4b81d53f0d0613a6efec09773e8b0fcc682f2baa3ea2bec7e171b4ab'}
2025-08-20 07:59:35,803 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMEYwNjdCMjg5NzVCOTZEM0I0QTk2MDlFNDg1NjVGNUQA",
                "timestamp": "1755665974",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 07:59:35,805 - server - INFO - Entry ID: 648237557784508
2025-08-20 07:59:35,805 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMEYwNjdCMjg5NzVCOTZEM0I0QTk2MDlFNDg1NjVGNUQA",
      "timestamp": "1755665974",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 07:59:35,807 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMEYwNjdCMjg5NzVCOTZEM0I0QTk2MDlFNDg1NjVGNUQA
2025-08-20 07:59:35,807 - server - INFO - From: 254702944890
2025-08-20 07:59:35,808 - server - INFO - Timestamp: 1755665974
2025-08-20 07:59:35,808 - server - INFO - Type: text
2025-08-20 07:59:35,808 - server - INFO - Content: Hi
2025-08-20 07:59:35,809 - server - INFO - Message queued for processing
2025-08-20 07:59:35,809 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 07:59:35,810 - server - INFO - Processing message from 254702944890: Hi
2025-08-20 07:59:39,679 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 07:59:40,298 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 07:59:40,299 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#10) Application does not have permission for this action","type":"OAuthException","code":10,"error_data":{"messaging_product":"whatsapp","details":"There was a problem with the access token or permissions you are using for the API call."},"fbtrace_id":"AsutQtoabWa5JCTZ7AQslVO"}}
2025-08-20 07:59:40,300 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 08:01:22,470 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 08:01:22,487 - server - INFO - Connected to MongoDB successfully
2025-08-20 08:01:22,489 - server - INFO - Google Sheets client initialized
2025-08-20 08:01:31,755 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 08:01:31,790 - server - INFO - Connected to MongoDB successfully
2025-08-20 08:01:31,792 - server - INFO - Google Sheets client initialized
2025-08-20 08:01:42,881 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:01:42,881 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '488', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=a1b5ff4780ad34b5f5d3a96cb0855f5f254ce7ec', 'x-hub-signature-256': 'sha256=1bc48835aa896a47885fff11ddb5ef483751e87bfdf053168e3606d798d4ebfb'}
2025-08-20 08:01:42,882 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMEQyNzM2MkIxMDk0NTc5NEEwNjU1QUUwNTBFOUEwQUYA",
                "timestamp": "1755666100",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:01:42,884 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:01:42,885 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMEQyNzM2MkIxMDk0NTc5NEEwNjU1QUUwNTBFOUEwQUYA",
      "timestamp": "1755666100",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 08:01:42,887 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMEQyNzM2MkIxMDk0NTc5NEEwNjU1QUUwNTBFOUEwQUYA
2025-08-20 08:01:42,887 - server - INFO - From: 254702944890
2025-08-20 08:01:42,888 - server - INFO - Timestamp: 1755666100
2025-08-20 08:01:42,888 - server - INFO - Type: text
2025-08-20 08:01:42,888 - server - INFO - Content: Hi
2025-08-20 08:01:42,889 - server - INFO - Message queued for processing
2025-08-20 08:01:42,889 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:01:42,891 - server - INFO - Processing message from 254702944890: Hi
2025-08-20 08:01:50,062 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 401 Unauthorized"
2025-08-20 08:01:51,165 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 401 Unauthorized"
2025-08-20 08:01:51,166 - server - ERROR - WhatsApp send failed status=401 body={"error":{"message":"Error validating access token: Session has expired on Tuesday, 19-Aug-25 22:00:00 PDT. The current time is Tuesday, 19-Aug-25 22:01:50 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"A6Ilolw6OZeE5xwMh9A0YhI"}}
2025-08-20 08:01:51,167 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 08:03:04,211 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:03:04,211 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:2::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=42d91e004e50a0a7a4f3f2b3af5ac28f8ef85da1', 'x-hub-signature-256': 'sha256=1af680234e42d9d076cabb9ba119502263a23df80cd6043c4aa2cc960c03a75e'}
2025-08-20 08:03:04,212 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNkI4Q0E5RjExNURBRTQ3MENCAA==",
                "status": "sent",
                "timestamp": "1755666182",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "000bd8652b6c4e82fe74773ad13998cb",
                  "expiration_timestamp": "1755666182",
                  "origin": {
                    "type": "utility"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "utility",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:03:04,214 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:03:04,214 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNkI4Q0E5RjExNURBRTQ3MENCAA==",
      "status": "sent",
      "timestamp": "1755666182",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "000bd8652b6c4e82fe74773ad13998cb",
        "expiration_timestamp": "1755666182",
        "origin": {
          "type": "utility"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "utility",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:03:04,217 - server - INFO - Message queued for processing
2025-08-20 08:03:04,217 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:03:04,218 - server - INFO - No messages in webhook
2025-08-20 08:03:04,438 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:03:04,438 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:6::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=99e679ecc41bc47d5cec184139ece3b7d2be10be', 'x-hub-signature-256': 'sha256=33fbc880043bb267074e6414c581dc05dddd585a59e696e49a0a5e1831570e4d'}
2025-08-20 08:03:04,438 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNkI4Q0E5RjExNURBRTQ3MENCAA==",
                "status": "read",
                "timestamp": "1755666183",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "000bd8652b6c4e82fe74773ad13998cb",
                  "origin": {
                    "type": "utility"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "utility",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:03:04,441 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:03:04,441 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNkI4Q0E5RjExNURBRTQ3MENCAA==",
      "status": "read",
      "timestamp": "1755666183",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "000bd8652b6c4e82fe74773ad13998cb",
        "origin": {
          "type": "utility"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "utility",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:03:04,443 - server - INFO - Message queued for processing
2025-08-20 08:03:04,443 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:03:04,444 - server - INFO - No messages in webhook
2025-08-20 08:03:10,024 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:03:10,024 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '488', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:71::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=92463d6572b89cc689e43e193a2da17f9fbb7d56', 'x-hub-signature-256': 'sha256=6642243c5ef37af75922cca44e45106c17aa54672cffb157676fe84ab6b19283'}
2025-08-20 08:03:10,025 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggOEFCMjE1QUUzRTdCREI4NzdBODY2NjgyMTM0RjhGMzgA",
                "timestamp": "1755666188",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:03:10,027 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:03:10,028 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggOEFCMjE1QUUzRTdCREI4NzdBODY2NjgyMTM0RjhGMzgA",
      "timestamp": "1755666188",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 08:03:10,030 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggOEFCMjE1QUUzRTdCREI4NzdBODY2NjgyMTM0RjhGMzgA
2025-08-20 08:03:10,030 - server - INFO - From: 254702944890
2025-08-20 08:03:10,030 - server - INFO - Timestamp: 1755666188
2025-08-20 08:03:10,031 - server - INFO - Type: text
2025-08-20 08:03:10,031 - server - INFO - Content: Hi
2025-08-20 08:03:10,031 - server - INFO - Message queued for processing
2025-08-20 08:03:10,031 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:03:10,033 - server - INFO - Processing message from 254702944890: Hi
2025-08-20 08:03:16,564 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 401 Unauthorized"
2025-08-20 08:03:16,929 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 401 Unauthorized"
2025-08-20 08:03:16,931 - server - ERROR - WhatsApp send failed status=401 body={"error":{"message":"Error validating access token: Session has expired on Tuesday, 19-Aug-25 22:00:00 PDT. The current time is Tuesday, 19-Aug-25 22:03:16 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"A70Mwr0GcqyQFNkblG6pOy8"}}
2025-08-20 08:03:16,931 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 08:05:57,331 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 08:05:57,382 - server - INFO - Connected to MongoDB successfully
2025-08-20 08:05:57,384 - server - INFO - Google Sheets client initialized
2025-08-20 08:06:18,039 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:06:18,039 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '488', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:42::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=03640ce9c2ffcd35de0ff6bbe94287a865f2eb6c', 'x-hub-signature-256': 'sha256=7f87ec73119a745dbd37da6bc9a909a2e83d1aaf09ae76803eeb8475e1698ad0'}
2025-08-20 08:06:18,040 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNTlGMTk1ODIwODNERDg5NUI2RDJDQkU3RTIwODU5MTQA",
                "timestamp": "1755666376",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:06:18,042 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:06:18,042 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNTlGMTk1ODIwODNERDg5NUI2RDJDQkU3RTIwODU5MTQA",
      "timestamp": "1755666376",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 08:06:18,044 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNTlGMTk1ODIwODNERDg5NUI2RDJDQkU3RTIwODU5MTQA
2025-08-20 08:06:18,044 - server - INFO - From: 254702944890
2025-08-20 08:06:18,044 - server - INFO - Timestamp: 1755666376
2025-08-20 08:06:18,045 - server - INFO - Type: text
2025-08-20 08:06:18,045 - server - INFO - Content: Hi
2025-08-20 08:06:18,045 - server - INFO - Message queued for processing
2025-08-20 08:06:18,046 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:06:18,048 - server - INFO - Processing message from 254702944890: Hi
2025-08-20 08:06:24,014 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 401 Unauthorized"
2025-08-20 08:06:24,345 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 401 Unauthorized"
2025-08-20 08:06:24,346 - server - ERROR - WhatsApp send failed status=401 body={"error":{"message":"Invalid OAuth access token - Cannot parse access token","type":"OAuthException","code":190,"fbtrace_id":"ADmed1fkWqtJr2G4UlqErHy"}}
2025-08-20 08:06:24,346 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 08:06:47,224 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:06:47,224 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '488', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:e::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=deaa3fd7ea3862c18524d355f4936dc2e99d3017', 'x-hub-signature-256': 'sha256=5493d786d9da0ac6be7545fb0fcf856966d0a8d2d9e3dffc6308e263f209ab9f'}
2025-08-20 08:06:47,225 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggM0EwNzRFMUJEODEwMUIxODJDMUY1RkYyMDM4RjY2MTIA",
                "timestamp": "1755666405",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:06:47,227 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:06:47,227 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggM0EwNzRFMUJEODEwMUIxODJDMUY1RkYyMDM4RjY2MTIA",
      "timestamp": "1755666405",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 08:06:47,229 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggM0EwNzRFMUJEODEwMUIxODJDMUY1RkYyMDM4RjY2MTIA
2025-08-20 08:06:47,229 - server - INFO - From: 254702944890
2025-08-20 08:06:47,229 - server - INFO - Timestamp: 1755666405
2025-08-20 08:06:47,230 - server - INFO - Type: text
2025-08-20 08:06:47,230 - server - INFO - Content: Hi
2025-08-20 08:06:47,230 - server - INFO - Message queued for processing
2025-08-20 08:06:47,231 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:06:47,233 - server - INFO - Processing message from 254702944890: Hi
2025-08-20 08:06:51,890 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 401 Unauthorized"
2025-08-20 08:06:52,781 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 401 Unauthorized"
2025-08-20 08:06:52,782 - server - ERROR - WhatsApp send failed status=401 body={"error":{"message":"Invalid OAuth access token - Cannot parse access token","type":"OAuthException","code":190,"fbtrace_id":"AvZ7voSliDkd3EZMGAK95Og"}}
2025-08-20 08:06:52,782 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 08:07:01,570 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 08:07:01,622 - server - INFO - Connected to MongoDB successfully
2025-08-20 08:07:01,624 - server - INFO - Google Sheets client initialized
2025-08-20 08:07:06,555 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:07:06,555 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '488', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:a::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=8de8c5ff4abfb106c17e9f3962b64f0a56310b71', 'x-hub-signature-256': 'sha256=2d2b2645cf13b8e4938ba9b8aacc69d6abb950a6b4061f53c363fce6a461daec'}
2025-08-20 08:07:06,557 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMzhBQjlGOTk5RjE3QkNFRUU3OUI3ODBBMkI0RDMwM0YA",
                "timestamp": "1755666423",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:07:06,561 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:07:06,561 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMzhBQjlGOTk5RjE3QkNFRUU3OUI3ODBBMkI0RDMwM0YA",
      "timestamp": "1755666423",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 08:07:06,564 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMzhBQjlGOTk5RjE3QkNFRUU3OUI3ODBBMkI0RDMwM0YA
2025-08-20 08:07:06,564 - server - INFO - From: 254702944890
2025-08-20 08:07:06,564 - server - INFO - Timestamp: 1755666423
2025-08-20 08:07:06,565 - server - INFO - Type: text
2025-08-20 08:07:06,565 - server - INFO - Content: Hi
2025-08-20 08:07:06,566 - server - INFO - Message queued for processing
2025-08-20 08:07:06,566 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:07:06,568 - server - INFO - Processing message from 254702944890: Hi
2025-08-20 08:07:12,923 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 401 Unauthorized"
2025-08-20 08:07:13,222 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 401 Unauthorized"
2025-08-20 08:07:13,223 - server - ERROR - WhatsApp send failed status=401 body={"error":{"message":"Error validating access token: Session has expired on Tuesday, 19-Aug-25 22:00:00 PDT. The current time is Tuesday, 19-Aug-25 22:07:12 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"A345UkEfXl7L00s8Zas2f3t"}}
2025-08-20 08:07:13,223 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 08:07:49,026 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 08:07:49,060 - server - INFO - Connected to MongoDB successfully
2025-08-20 08:07:49,062 - server - INFO - Google Sheets client initialized
2025-08-20 08:07:54,640 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:07:54,640 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '488', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:a::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=d4c543eb273667167f7e711c871ec6260d1ec7be', 'x-hub-signature-256': 'sha256=2633fa4ccfce91bc094cf87f7cc1c069a54dc4d658193261083c2977f4be61aa'}
2025-08-20 08:07:54,641 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggM0Q2MDIyQTFEODY2OTRFRTAzQjM1QUM4NTk3MUU3MjUA",
                "timestamp": "1755666472",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:07:54,645 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:07:54,646 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggM0Q2MDIyQTFEODY2OTRFRTAzQjM1QUM4NTk3MUU3MjUA",
      "timestamp": "1755666472",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 08:07:54,649 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggM0Q2MDIyQTFEODY2OTRFRTAzQjM1QUM4NTk3MUU3MjUA
2025-08-20 08:07:54,650 - server - INFO - From: 254702944890
2025-08-20 08:07:54,650 - server - INFO - Timestamp: 1755666472
2025-08-20 08:07:54,651 - server - INFO - Type: text
2025-08-20 08:07:54,651 - server - INFO - Content: Hi
2025-08-20 08:07:54,651 - server - INFO - Message queued for processing
2025-08-20 08:07:54,652 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:07:54,654 - server - INFO - Processing message from 254702944890: Hi
2025-08-20 08:08:03,951 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:08:04,752 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:08:04,753 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:2::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=b9f186fd14337397c8deb011ed06c35039c402fd', 'x-hub-signature-256': 'sha256=33d9adea81201cb79d54d2c8040b0fb1c3559030cb08c97d7b3effe9d978e332'}
2025-08-20 08:08:04,754 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNkQ3OEUyQzQxMzE4M0I2ODQwAA==",
                "status": "sent",
                "timestamp": "1755666482",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "fe3777feaf626c1bb4eac7e74fad62a0",
                  "expiration_timestamp": "1755666482",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:08:04,756 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:08:04,757 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNkQ3OEUyQzQxMzE4M0I2ODQwAA==",
      "status": "sent",
      "timestamp": "1755666482",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "fe3777feaf626c1bb4eac7e74fad62a0",
        "expiration_timestamp": "1755666482",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:08:04,758 - server - INFO - Message queued for processing
2025-08-20 08:08:04,759 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:08:04,760 - server - INFO - No messages in webhook
2025-08-20 08:08:05,406 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:08:05,407 - server - INFO - Message sent to 254702944890: Please state your name and the purpose of your mes...
2025-08-20 08:08:11,300 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'containerInfo': '260626823147', 'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'consumer': 'projects/260626823147', 'service': 'drive.googleapis.com', 'serviceTitle': 'Google Drive API'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 08:08:11,306 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 08:08:11,330 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:08:11,330 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:4d::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=bc6bce051e3dc04fc22e5eeb73db81846731d2cc', 'x-hub-signature-256': 'sha256=57d02083364f701ffa8ca2247ab4725efaa985de320b4616c552675612f0baa1'}
2025-08-20 08:08:11,331 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNkQ3OEUyQzQxMzE4M0I2ODQwAA==",
                "status": "read",
                "timestamp": "1755666483",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "fe3777feaf626c1bb4eac7e74fad62a0",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:08:11,335 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:08:11,336 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNkQ3OEUyQzQxMzE4M0I2ODQwAA==",
      "status": "read",
      "timestamp": "1755666483",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "fe3777feaf626c1bb4eac7e74fad62a0",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:08:11,337 - server - INFO - Message queued for processing
2025-08-20 08:08:11,338 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:08:11,340 - server - INFO - No messages in webhook
2025-08-20 08:08:11,340 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:08:11,341 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:12ff:9::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=8d918a2d4f6150b42b119c3e047863d219e02628', 'x-hub-signature-256': 'sha256=a5bd9dda02290eec6fb2a65cc94c8d85b07dc0c99d1835a9b3f833a26850feb6'}
2025-08-20 08:08:11,342 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMDk2QjI5OUFCMDQzMzNGOTREAA==",
                "status": "sent",
                "timestamp": "1755666484",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "c1c06c9bbbb249bcc51518586a0e8c79",
                  "expiration_timestamp": "1755666484",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:08:11,345 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:08:11,345 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMDk2QjI5OUFCMDQzMzNGOTREAA==",
      "status": "sent",
      "timestamp": "1755666484",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "c1c06c9bbbb249bcc51518586a0e8c79",
        "expiration_timestamp": "1755666484",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:08:11,348 - server - INFO - Message queued for processing
2025-08-20 08:08:11,348 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:08:11,350 - server - INFO - No messages in webhook
2025-08-20 08:08:11,351 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:08:11,352 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:44::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=27db613342ca503f7c33b769581a64ffb5563e6d', 'x-hub-signature-256': 'sha256=6102ac16706f9dc4c5124e001dbc911c45346442e8ef0a71ddbeb6aca80825af'}
2025-08-20 08:08:11,353 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMDk2QjI5OUFCMDQzMzNGOTREAA==",
                "status": "read",
                "timestamp": "1755666486",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "c1c06c9bbbb249bcc51518586a0e8c79",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:08:11,355 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:08:11,355 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMDk2QjI5OUFCMDQzMzNGOTREAA==",
      "status": "read",
      "timestamp": "1755666486",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "c1c06c9bbbb249bcc51518586a0e8c79",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:08:11,357 - server - INFO - Message queued for processing
2025-08-20 08:08:11,357 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:08:11,358 - server - INFO - No messages in webhook
2025-08-20 08:08:13,246 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:08:14,192 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:08:14,194 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"A0e-AgX71j_geg1ol_nNLLC"}}
2025-08-20 08:08:14,194 - server - WARNING - Failed to send owner notification: 
2025-08-20 08:08:14,195 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 08:08:14,195 - server - INFO - Message processed successfully for 254702944890
2025-08-20 08:09:09,599 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:09:09,600 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '534', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:9::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=d3d189d02e91985cbe7c926d811531d18b8a3d4f', 'x-hub-signature-256': 'sha256=48f5142cf863a367a2a4f898460a95bcca3de1d58a435628246d4438893bfaef'}
2025-08-20 08:09:09,600 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggRjMzQTU2QzYzNEE2NTZCQzI3NTBDNTdCRTFEMkQ3QzEA",
                "timestamp": "1755666548",
                "text": {
                  "body": "Dan kosgey is korrir available tomorrow at 10am?"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:09:09,602 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:09:09,603 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggRjMzQTU2QzYzNEE2NTZCQzI3NTBDNTdCRTFEMkQ3QzEA",
      "timestamp": "1755666548",
      "text": {
        "body": "Dan kosgey is korrir available tomorrow at 10am?"
      },
      "type": "text"
    }
  ]
}
2025-08-20 08:09:09,604 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggRjMzQTU2QzYzNEE2NTZCQzI3NTBDNTdCRTFEMkQ3QzEA
2025-08-20 08:09:09,604 - server - INFO - From: 254702944890
2025-08-20 08:09:09,605 - server - INFO - Timestamp: 1755666548
2025-08-20 08:09:09,605 - server - INFO - Type: text
2025-08-20 08:09:09,605 - server - INFO - Content: Dan kosgey is korrir available tomorrow at 10am?
2025-08-20 08:09:09,606 - server - INFO - Message queued for processing
2025-08-20 08:09:09,606 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:09:09,608 - server - INFO - Processing message from 254702944890: Dan kosgey is korrir available tomorrow at 10am?
2025-08-20 08:09:14,303 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:09:15,599 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:09:15,600 - server - INFO - Message sent to 254702944890: Please state your name and the purpose of your inq...
2025-08-20 08:09:21,941 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'consumer': 'projects/260626823147', 'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'containerInfo': '260626823147', 'service': 'drive.googleapis.com', 'serviceTitle': 'Google Drive API'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 08:09:21,944 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 08:09:21,957 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:09:21,957 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:7::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=f1790a99fd242172e26f8a286b0fb67a3e06623b', 'x-hub-signature-256': 'sha256=6567412af004c65bff2134ae1629f129a3537f62c219192122c3e9741fc42c85'}
2025-08-20 08:09:21,958 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNDZBQzI1M0U3MjYwMjhDRDY4AA==",
                "status": "sent",
                "timestamp": "1755666553",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "81b629c98a29064eb5e3d80aa052efbc",
                  "expiration_timestamp": "1755666553",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:09:21,960 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:09:21,961 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNDZBQzI1M0U3MjYwMjhDRDY4AA==",
      "status": "sent",
      "timestamp": "1755666553",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "81b629c98a29064eb5e3d80aa052efbc",
        "expiration_timestamp": "1755666553",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:09:21,962 - server - INFO - Message queued for processing
2025-08-20 08:09:21,962 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:09:21,964 - server - INFO - No messages in webhook
2025-08-20 08:09:21,965 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:09:21,966 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:4d::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=8a704fc593bd5fc8bf6a0fe172baa793f88da885', 'x-hub-signature-256': 'sha256=d08dad9f3310f65564d4638a01b08d9f4364bd9525a1ad64595f0c105226efb6'}
2025-08-20 08:09:21,966 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNDZBQzI1M0U3MjYwMjhDRDY4AA==",
                "status": "read",
                "timestamp": "1755666554",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "81b629c98a29064eb5e3d80aa052efbc",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:09:21,969 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:09:21,969 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSNDZBQzI1M0U3MjYwMjhDRDY4AA==",
      "status": "read",
      "timestamp": "1755666554",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "81b629c98a29064eb5e3d80aa052efbc",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:09:21,971 - server - INFO - Message queued for processing
2025-08-20 08:09:21,971 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:09:21,973 - server - INFO - No messages in webhook
2025-08-20 08:09:21,973 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:09:21,974 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:c::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=345c455f3c4592c7c0d51e8281237f945a4992ed', 'x-hub-signature-256': 'sha256=8c268d0516b64e6e758f39df4907fb021cddbedfd78899958ef3063b6b2ad9d6'}
2025-08-20 08:09:21,974 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRTMxRjY3QkJFMDYyQjA4NjU0AA==",
                "status": "read",
                "timestamp": "1755666555",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "c57b03af55d0d6d36e0c84805c4c14d5",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:09:21,976 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:09:21,977 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRTMxRjY3QkJFMDYyQjA4NjU0AA==",
      "status": "read",
      "timestamp": "1755666555",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "c57b03af55d0d6d36e0c84805c4c14d5",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:09:21,978 - server - INFO - Message queued for processing
2025-08-20 08:09:21,978 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:09:21,980 - server - INFO - No messages in webhook
2025-08-20 08:09:21,981 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:09:21,981 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=a98c2f536b5c1f01f988754437696e253542a86d', 'x-hub-signature-256': 'sha256=1a655e6132875e34fbd11115f9b594a4933bdea87e8d342461b16e489716ad23'}
2025-08-20 08:09:21,982 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRTMxRjY3QkJFMDYyQjA4NjU0AA==",
                "status": "sent",
                "timestamp": "1755666555",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "c57b03af55d0d6d36e0c84805c4c14d5",
                  "expiration_timestamp": "1755666555",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:09:21,984 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:09:21,985 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRTMxRjY3QkJFMDYyQjA4NjU0AA==",
      "status": "sent",
      "timestamp": "1755666555",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "c57b03af55d0d6d36e0c84805c4c14d5",
        "expiration_timestamp": "1755666555",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:09:21,988 - server - INFO - Message queued for processing
2025-08-20 08:09:21,988 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:09:21,990 - server - INFO - No messages in webhook
2025-08-20 08:09:22,540 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:09:23,025 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:09:23,026 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AFiJ8qJ4ej-DvLEol12V9vw"}}
2025-08-20 08:09:23,027 - server - WARNING - Failed to send owner notification: 
2025-08-20 08:09:23,027 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 08:09:23,028 - server - INFO - Message processed successfully for 254702944890
2025-08-20 08:09:49,689 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 08:09:49,724 - server - INFO - Connected to MongoDB successfully
2025-08-20 08:09:49,727 - server - INFO - Google Sheets client initialized
2025-08-20 08:10:16,610 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 08:10:16,647 - server - INFO - Connected to MongoDB successfully
2025-08-20 08:10:16,650 - server - INFO - Google Sheets client initialized
2025-08-20 08:10:26,299 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:10:26,300 - server - INFO - Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.19041.6216', 'content-type': 'application/json', 'host': '127.0.0.1:8001', 'content-length': '1381', 'expect': '100-continue', 'connection': 'Keep-Alive'}
2025-08-20 08:10:26,301 - server - INFO - Raw webhook payload: {
  "entry": [
    {
      "id": "t1",
      "changes": [
        {
          "value": {
            "messages": [
              {
                "from": "+15551234567",
                "timestamp": "1692547201",
                "id": "t1m1",
                "type": "text",
                "text": {
                  "body": "Force test message for AI"
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
2025-08-20 08:10:26,303 - server - INFO - Entry ID: t1
2025-08-20 08:10:26,303 - server - INFO - Change Value: {
  "messages": [
    {
      "from": "+15551234567",
      "timestamp": "1692547201",
      "id": "t1m1",
      "type": "text",
      "text": {
        "body": "Force test message for AI"
      }
    }
  ]
}
2025-08-20 08:10:26,304 - server - INFO - Message ID: t1m1
2025-08-20 08:10:26,304 - server - INFO - From: +15551234567
2025-08-20 08:10:26,305 - server - INFO - Timestamp: 1692547201
2025-08-20 08:10:26,305 - server - INFO - Type: text
2025-08-20 08:10:26,305 - server - INFO - Content: Force test message for AI
2025-08-20 08:10:26,305 - server - INFO - Message queued for processing
2025-08-20 08:10:26,306 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:10:26,307 - server - INFO - Processing message from +15551234567: Force test message for AI
2025-08-20 08:10:31,470 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:10:32,196 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:10:32,198 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"ANedfs9C_BBL8ndcrX5RzJQ"}}
2025-08-20 08:10:32,199 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 08:11:04,927 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 08:11:04,946 - server - INFO - Connected to MongoDB successfully
2025-08-20 08:11:04,949 - server - INFO - Google Sheets client initialized
2025-08-20 08:11:47,055 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:11:47,056 - server - INFO - Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.19041.6216', 'content-type': 'application/json', 'host': '127.0.0.1:8001', 'content-length': '0', 'connection': 'Keep-Alive'}
2025-08-20 08:11:47,056 - server - ERROR - ========== WEBHOOK ERROR ==========
2025-08-20 08:11:47,056 - server - ERROR - Error processing webhook: Expecting value: line 1 column 1 (char 0)
2025-08-20 08:11:47,057 - server - ERROR - Error type: JSONDecodeError
2025-08-20 08:11:47,059 - server - ERROR - Error traceback: Traceback (most recent call last):
  File "C:\Users\PC\OneDrive\Desktop\python\whatsapp\agent\whats-app-agent\backend\server.py", line 501, in handle_webhook
    body = await request.json()
  File "C:\Users\PC\OneDrive\Desktop\python\whatsapp\agent\whats-app-agent\backend\.venv\lib\site-packages\starlette\requests.py", line 244, in json
    self._json = json.loads(body)
  File "C:\Users\PC\AppData\Local\Programs\Python\Python310\lib\json\__init__.py", line 346, in loads
    return _default_decoder.decode(s)
  File "C:\Users\PC\AppData\Local\Programs\Python\Python310\lib\json\decoder.py", line 337, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
  File "C:\Users\PC\AppData\Local\Programs\Python\Python310\lib\json\decoder.py", line 355, in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)

2025-08-20 08:11:47,060 - server - ERROR - ========== WEBHOOK ERROR END ==========
2025-08-20 08:12:51,695 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:12:51,696 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '488', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:47::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=7911512951f5182e21ec123f74a7853ea725c30a', 'x-hub-signature-256': 'sha256=4037e9f0bd6cb9b61f6bfc52cf9f64986360ec6c621a93cb135bf1da54978475'}
2025-08-20 08:12:51,697 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggOTlCRDgzQ0RGQ0QyMkMxQUI1ODg5OUMwQTIyN0M5MkIA",
                "timestamp": "1755666770",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:12:51,699 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:12:51,700 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggOTlCRDgzQ0RGQ0QyMkMxQUI1ODg5OUMwQTIyN0M5MkIA",
      "timestamp": "1755666770",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 08:12:51,701 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggOTlCRDgzQ0RGQ0QyMkMxQUI1ODg5OUMwQTIyN0M5MkIA
2025-08-20 08:12:51,702 - server - INFO - From: 254702944890
2025-08-20 08:12:51,702 - server - INFO - Timestamp: 1755666770
2025-08-20 08:12:51,702 - server - INFO - Type: text
2025-08-20 08:12:51,702 - server - INFO - Content: Hi
2025-08-20 08:12:51,703 - server - INFO - Message queued for processing
2025-08-20 08:12:51,703 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:12:51,704 - server - INFO - Processing message from 254702944890: Hi
2025-08-20 08:12:56,778 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:12:58,268 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:12:58,269 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:44::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=5cf4c52a55b009bbab492e8f5e9fb9b946c88f29', 'x-hub-signature-256': 'sha256=050137b348db8d810a7d9cfc0b97413b42ab6e6196afc862963176db71f5ccb6'}
2025-08-20 08:12:58,270 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQkM5RjVCOTUyRUQ1NTQ2N0E0AA==",
                "status": "sent",
                "timestamp": "1755666776",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "52b7fb8253a3058d2f23170a47b873ca",
                  "expiration_timestamp": "1755666776",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:12:58,273 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:12:58,273 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQkM5RjVCOTUyRUQ1NTQ2N0E0AA==",
      "status": "sent",
      "timestamp": "1755666776",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "52b7fb8253a3058d2f23170a47b873ca",
        "expiration_timestamp": "1755666776",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:12:58,275 - server - INFO - Message queued for processing
2025-08-20 08:12:58,275 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:12:58,276 - server - INFO - No messages in webhook
2025-08-20 08:12:58,380 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:12:58,381 - server - INFO - Message sent to 254702944890: Please state your name and the purpose of your mes...
2025-08-20 08:13:03,306 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'consumer': 'projects/260626823147', 'serviceTitle': 'Google Drive API', 'service': 'drive.googleapis.com', 'containerInfo': '260626823147'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 08:13:03,309 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 08:13:03,326 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:13:03,327 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:12ff:5::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=5ea0aa40104ad11c920d5f13c33599f7195db59d', 'x-hub-signature-256': 'sha256=4b1f06b0155cb095575edcf091f841f34c300a9c5eb6b7b7087874bdc5bd9b55'}
2025-08-20 08:13:03,328 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRjlEODZFRkIyN0ZEMzFFODE2AA==",
                "status": "sent",
                "timestamp": "1755666777",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "4d28a9d2b4626f3edb0f070efb4f304b",
                  "expiration_timestamp": "1755666777",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:13:03,331 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:13:03,332 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRjlEODZFRkIyN0ZEMzFFODE2AA==",
      "status": "sent",
      "timestamp": "1755666777",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "4d28a9d2b4626f3edb0f070efb4f304b",
        "expiration_timestamp": "1755666777",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:13:03,335 - server - INFO - Message queued for processing
2025-08-20 08:13:03,336 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:13:03,338 - server - INFO - No messages in webhook
2025-08-20 08:13:03,338 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:13:03,339 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=18be0b92659f71640c4a87e3ebbd0af8d0203b88', 'x-hub-signature-256': 'sha256=829fec49e4d83bf21586318d63724eba2dab5d5c61834050fbcfc7a5b2d26dc7'}
2025-08-20 08:13:03,340 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQkM5RjVCOTUyRUQ1NTQ2N0E0AA==",
                "status": "read",
                "timestamp": "1755666776",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "52b7fb8253a3058d2f23170a47b873ca",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:13:03,342 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:13:03,342 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQkM5RjVCOTUyRUQ1NTQ2N0E0AA==",
      "status": "read",
      "timestamp": "1755666776",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "52b7fb8253a3058d2f23170a47b873ca",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:13:03,344 - server - INFO - Message queued for processing
2025-08-20 08:13:03,344 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:13:03,346 - server - INFO - No messages in webhook
2025-08-20 08:13:03,348 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:13:03,348 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:12ff:72::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=616f91cc878ea1043bb6ba38cd19f5d5ec88b387', 'x-hub-signature-256': 'sha256=3253ab1746c5c79d45e23636f6b038009b4aab38cc2648769890dfe2db8d342e'}
2025-08-20 08:13:03,349 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRjlEODZFRkIyN0ZEMzFFODE2AA==",
                "status": "read",
                "timestamp": "1755666778",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "4d28a9d2b4626f3edb0f070efb4f304b",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:13:03,352 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:13:03,352 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRjlEODZFRkIyN0ZEMzFFODE2AA==",
      "status": "read",
      "timestamp": "1755666778",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "4d28a9d2b4626f3edb0f070efb4f304b",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:13:03,354 - server - INFO - Message queued for processing
2025-08-20 08:13:03,354 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:13:03,356 - server - INFO - No messages in webhook
2025-08-20 08:13:04,759 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:13:05,837 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:13:05,838 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AWswUUAz5q5PDypJwBKeUxP"}}
2025-08-20 08:13:05,839 - server - WARNING - Failed to send owner notification: 
2025-08-20 08:13:05,839 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 08:13:05,839 - server - INFO - Message processed successfully for 254702944890
2025-08-20 08:13:26,473 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:13:26,473 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '477', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:72::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=71cfdd786f53dc6159510d7a422ee1bd34bdb84d', 'x-hub-signature-256': 'sha256=ef2cabd0e83aa55350fc7a09d47dc631bb4d1d11ba05f89147207d17dd87da86'}
2025-08-20 08:13:26,473 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "."
                },
                "wa_id": "254745026933"
              }
            ],
            "messages": [
              {
                "from": "254745026933",
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAEhggRkVEM0M4NDZCMjI5OTNFODk2RTg1OEVFNEM1RjA2NzAA",
                "timestamp": "1755666804",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:13:26,476 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:13:26,476 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "."
      },
      "wa_id": "254745026933"
    }
  ],
  "messages": [
    {
      "from": "254745026933",
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAEhggRkVEM0M4NDZCMjI5OTNFODk2RTg1OEVFNEM1RjA2NzAA",
      "timestamp": "1755666804",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 08:13:26,477 - server - INFO - Message ID: wamid.HBgMMjU0NzQ1MDI2OTMzFQIAEhggRkVEM0M4NDZCMjI5OTNFODk2RTg1OEVFNEM1RjA2NzAA
2025-08-20 08:13:26,478 - server - INFO - From: 254745026933
2025-08-20 08:13:26,478 - server - INFO - Timestamp: 1755666804
2025-08-20 08:13:26,478 - server - INFO - Type: text
2025-08-20 08:13:26,478 - server - INFO - Content: Hi
2025-08-20 08:13:26,479 - server - INFO - Message queued for processing
2025-08-20 08:13:26,479 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:13:26,480 - server - INFO - Processing message from 254745026933: Hi
2025-08-20 08:13:31,112 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:13:31,155 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:13:31,156 - server - INFO - Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.19041.6216', 'content-type': 'application/json', 'host': '127.0.0.1:8001', 'content-length': '1391', 'expect': '100-continue', 'connection': 'Keep-Alive'}
2025-08-20 08:13:31,158 - server - INFO - Raw webhook payload: {
  "entry": [
    {
      "id": "t3",
      "changes": [
        {
          "value": {
            "messages": [
              {
                "from": "+15551234567",
                "timestamp": "1692547203",
                "id": "t3m1",
                "type": "text",
                "text": {
                  "body": "Third test message for AI after key"
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
2025-08-20 08:13:31,160 - server - INFO - Entry ID: t3
2025-08-20 08:13:31,161 - server - INFO - Change Value: {
  "messages": [
    {
      "from": "+15551234567",
      "timestamp": "1692547203",
      "id": "t3m1",
      "type": "text",
      "text": {
        "body": "Third test message for AI after key"
      }
    }
  ]
}
2025-08-20 08:13:31,162 - server - INFO - Message ID: t3m1
2025-08-20 08:13:31,162 - server - INFO - From: +15551234567
2025-08-20 08:13:31,162 - server - INFO - Timestamp: 1692547203
2025-08-20 08:13:31,162 - server - INFO - Type: text
2025-08-20 08:13:31,163 - server - INFO - Content: Third test message for AI after key
2025-08-20 08:13:31,163 - server - INFO - Message queued for processing
2025-08-20 08:13:31,163 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:13:31,165 - server - INFO - Processing message from +15551234567: Third test message for AI after key
2025-08-20 08:13:36,868 - server - ERROR - Error sending message to 254745026933: 
2025-08-20 08:13:36,869 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 08:13:38,186 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:13:39,068 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:13:39,070 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"A5jTUEdJdWK_Fjl4MRfXPI_"}}
2025-08-20 08:13:39,070 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 08:15:06,797 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 08:15:06,814 - server - INFO - Connected to MongoDB successfully
2025-08-20 08:15:06,817 - server - INFO - Google Sheets client initialized
2025-08-20 08:15:12,079 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'containerInfo': '260626823147', 'service': 'drive.googleapis.com', 'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'consumer': 'projects/260626823147', 'serviceTitle': 'Google Drive API'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 08:15:12,083 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 08:15:12,637 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:15:13,514 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:15:13,515 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"ANylYfyKYrBL9oYEbeANH9B"}}
2025-08-20 08:15:13,516 - server - WARNING - Failed to send owner notification: 
2025-08-20 08:15:13,516 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 08:15:17,184 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:15:17,184 - server - INFO - Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.19041.6216', 'content-type': 'application/json', 'host': '127.0.0.1:8001', 'content-length': '1394', 'connection': 'Keep-Alive'}
2025-08-20 08:15:17,185 - server - INFO - Raw webhook payload: {
  "entry": [
    {
      "id": "t_force",
      "changes": [
        {
          "value": {
            "messages": [
              {
                "from": "+15551234567",
                "timestamp": "1692547210",
                "id": "t_f1",
                "type": "text",
                "text": {
                  "body": "Forced test for AI + owner notify"
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
2025-08-20 08:15:17,186 - server - INFO - Entry ID: t_force
2025-08-20 08:15:17,186 - server - INFO - Change Value: {
  "messages": [
    {
      "from": "+15551234567",
      "timestamp": "1692547210",
      "id": "t_f1",
      "type": "text",
      "text": {
        "body": "Forced test for AI + owner notify"
      }
    }
  ]
}
2025-08-20 08:15:17,187 - server - INFO - Message ID: t_f1
2025-08-20 08:15:17,187 - server - INFO - From: +15551234567
2025-08-20 08:15:17,188 - server - INFO - Timestamp: 1692547210
2025-08-20 08:15:17,188 - server - INFO - Type: text
2025-08-20 08:15:17,188 - server - INFO - Content: Forced test for AI + owner notify
2025-08-20 08:15:17,188 - server - INFO - Message queued for processing
2025-08-20 08:15:17,189 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:15:17,190 - server - INFO - Processing message from +15551234567: Forced test for AI + owner notify
2025-08-20 08:15:23,510 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:15:24,689 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:15:24,690 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"Aq390lSa_x5QzCvgyUK8vAt"}}
2025-08-20 08:15:24,691 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 08:16:05,289 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 08:16:05,306 - server - INFO - Connected to MongoDB successfully
2025-08-20 08:16:05,308 - server - INFO - Google Sheets client initialized
2025-08-20 08:16:18,674 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:16:18,674 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '477', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:3::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=5a04adad01404ddcf62d0a0488a1cdc783eacf6f', 'x-hub-signature-256': 'sha256=6ff393e911322c9fca163ddf0bb2e4ecb50d87d46e540e6e86af63936404ccd8'}
2025-08-20 08:16:18,675 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "."
                },
                "wa_id": "254745026933"
              }
            ],
            "messages": [
              {
                "from": "254745026933",
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAEhggNzEwRTRBQUM1RDJFRTgyQ0U0MTIxNjlEQ0VBQThBMzkA",
                "timestamp": "1755666976",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:16:18,678 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:16:18,679 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "."
      },
      "wa_id": "254745026933"
    }
  ],
  "messages": [
    {
      "from": "254745026933",
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAEhggNzEwRTRBQUM1RDJFRTgyQ0U0MTIxNjlEQ0VBQThBMzkA",
      "timestamp": "1755666976",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 08:16:18,681 - server - INFO - Message ID: wamid.HBgMMjU0NzQ1MDI2OTMzFQIAEhggNzEwRTRBQUM1RDJFRTgyQ0U0MTIxNjlEQ0VBQThBMzkA
2025-08-20 08:16:18,682 - server - INFO - From: 254745026933
2025-08-20 08:16:18,682 - server - INFO - Timestamp: 1755666976
2025-08-20 08:16:18,682 - server - INFO - Type: text
2025-08-20 08:16:18,683 - server - INFO - Content: Hi
2025-08-20 08:16:18,683 - server - INFO - Message queued for processing
2025-08-20 08:16:18,683 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:16:18,685 - server - INFO - Processing message from 254745026933: Hi
2025-08-20 08:16:23,995 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:16:25,104 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:16:25,105 - server - INFO - Message sent to 254745026933: Hello.  My name is [Your Name]. Please state your ...
2025-08-20 08:16:28,693 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'service': 'drive.googleapis.com', 'serviceTitle': 'Google Drive API', 'containerInfo': '260626823147', 'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'consumer': 'projects/260626823147'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 08:16:28,695 - google_sheets_integration - INFO - Logged conversation locally for 254745026933
2025-08-20 08:16:28,710 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:16:28,711 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:d::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=93037ad2da51844e3170fac647a8e30cfa2cb017', 'x-hub-signature-256': 'sha256=4ee4f86eb69e790d6735047e1fd7932c5f66cf673932a4aba2bdeac885bc4ac3'}
2025-08-20 08:16:28,712 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSMjFBNkVFQkU3Qzk2NDU2OTlEAA==",
                "status": "sent",
                "timestamp": "1755666985",
                "recipient_id": "254745026933",
                "conversation": {
                  "id": "8cebaea42299766028a6ab39c85200aa",
                  "expiration_timestamp": "1755666985",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:16:28,717 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:16:28,717 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSMjFBNkVFQkU3Qzk2NDU2OTlEAA==",
      "status": "sent",
      "timestamp": "1755666985",
      "recipient_id": "254745026933",
      "conversation": {
        "id": "8cebaea42299766028a6ab39c85200aa",
        "expiration_timestamp": "1755666985",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:16:28,719 - server - INFO - Message queued for processing
2025-08-20 08:16:28,720 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:16:28,721 - server - INFO - No messages in webhook
2025-08-20 08:16:28,723 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:16:28,723 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:12ff:2::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=9bee8e31421337795a0dee02bc70046e0c45b7ee', 'x-hub-signature-256': 'sha256=80c0ba332b96d7ebd62d1add1cbfe2275aeba24f322aeb144909f9905f61bc5f'}
2025-08-20 08:16:28,724 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQkFGNTc0REYxODI3MTM3QTlEAA==",
                "status": "sent",
                "timestamp": "1755666984",
                "recipient_id": "254745026933",
                "conversation": {
                  "id": "8343d94fbafda4c11083ebb23a598be1",
                  "expiration_timestamp": "1755666984",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:16:28,727 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:16:28,727 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQkFGNTc0REYxODI3MTM3QTlEAA==",
      "status": "sent",
      "timestamp": "1755666984",
      "recipient_id": "254745026933",
      "conversation": {
        "id": "8343d94fbafda4c11083ebb23a598be1",
        "expiration_timestamp": "1755666984",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:16:28,729 - server - INFO - Message queued for processing
2025-08-20 08:16:28,729 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:16:28,731 - server - INFO - No messages in webhook
2025-08-20 08:16:28,733 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:16:28,734 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:56::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=60e927abfec0b102b334aaeb0eed907369822bb1', 'x-hub-signature-256': 'sha256=1554de456b559e2b13de479e630f40a943008db89540485f92a0291d67fb1e05'}
2025-08-20 08:16:28,734 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQkFGNTc0REYxODI3MTM3QTlEAA==",
                "status": "read",
                "timestamp": "1755666985",
                "recipient_id": "254745026933",
                "conversation": {
                  "id": "8343d94fbafda4c11083ebb23a598be1",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:16:28,737 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:16:28,738 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQkFGNTc0REYxODI3MTM3QTlEAA==",
      "status": "read",
      "timestamp": "1755666985",
      "recipient_id": "254745026933",
      "conversation": {
        "id": "8343d94fbafda4c11083ebb23a598be1",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:16:28,740 - server - INFO - Message queued for processing
2025-08-20 08:16:28,740 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:16:28,741 - server - INFO - No messages in webhook
2025-08-20 08:16:28,742 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:16:28,743 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:d::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=473ebac391ee919bffda3d8c865752a0b1c3eebe', 'x-hub-signature-256': 'sha256=c2f9a12ba6a4bbd43e449911bf64ad24fcaab82808d2b31be548ff241450dc80'}
2025-08-20 08:16:28,743 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSMjFBNkVFQkU3Qzk2NDU2OTlEAA==",
                "status": "read",
                "timestamp": "1755666986",
                "recipient_id": "254745026933",
                "conversation": {
                  "id": "8cebaea42299766028a6ab39c85200aa",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:16:28,745 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:16:28,745 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSMjFBNkVFQkU3Qzk2NDU2OTlEAA==",
      "status": "read",
      "timestamp": "1755666986",
      "recipient_id": "254745026933",
      "conversation": {
        "id": "8cebaea42299766028a6ab39c85200aa",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:16:28,750 - server - INFO - Message queued for processing
2025-08-20 08:16:28,750 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:16:28,752 - server - INFO - No messages in webhook
2025-08-20 08:16:29,760 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:16:30,687 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:16:30,689 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AsxBK-9FSj93gI3kh58pZEk"}}
2025-08-20 08:16:30,689 - server - WARNING - Failed to send owner notification: 
2025-08-20 08:16:30,690 - server - INFO - Generated conversation summary for 254745026933
2025-08-20 08:16:30,690 - server - INFO - Message processed successfully for 254745026933
2025-08-20 08:17:06,464 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 08:17:06,488 - server - INFO - Connected to MongoDB successfully
2025-08-20 08:17:06,491 - server - INFO - Google Sheets client initialized
2025-08-20 08:17:15,204 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'containerInfo': '260626823147', 'service': 'drive.googleapis.com', 'consumer': 'projects/260626823147', 'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'serviceTitle': 'Google Drive API'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 08:17:15,206 - google_sheets_integration - INFO - Logged conversation locally for 254745026933
2025-08-20 08:17:16,653 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:17:17,406 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:17:17,407 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:12ff:73::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=966e814aa35de5d09cbfdedaa8ac97baa1c7e9be', 'x-hub-signature-256': 'sha256=1482534810b4a9dfa1e07662e4d992dcc11bc370b4b43d8afaefa6690c41f498'}
2025-08-20 08:17:17,408 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSOEVFNDE0ODVGOEYzNDFCMTNFAA==",
                "status": "sent",
                "timestamp": "1755667036",
                "recipient_id": "254745026933",
                "conversation": {
                  "id": "0242b0daa77843575f6b046118ecf7bf",
                  "expiration_timestamp": "1755667036",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:17:17,411 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:17:17,411 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSOEVFNDE0ODVGOEYzNDFCMTNFAA==",
      "status": "sent",
      "timestamp": "1755667036",
      "recipient_id": "254745026933",
      "conversation": {
        "id": "0242b0daa77843575f6b046118ecf7bf",
        "expiration_timestamp": "1755667036",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:17:17,413 - server - INFO - Message queued for processing
2025-08-20 08:17:17,413 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:17:17,415 - server - INFO - No messages in webhook
2025-08-20 08:17:17,536 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:17:17,537 - server - INFO - Message sent to 254745026933: [2025-08-20 08:17] Unknown (new): An unknown conta...
2025-08-20 08:17:17,538 - server - INFO - Sent owner summary notification to +254745026933: {'messaging_product': 'whatsapp', 'contacts': [{'input': '254745026933', 'wa_id': '254745026933'}], 'messages': [{'id': 'wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQUYzNjhEODY1M0Q2REM5RjFCAA=='}]}
2025-08-20 08:17:17,538 - server - INFO - Generated conversation summary for 254745026933
2025-08-20 08:17:17,680 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:17:17,681 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '582', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=46953c14c3a6606fdfa10dee07f6c2940da3495d', 'x-hub-signature-256': 'sha256=e081babb48485ab10998fd6e6ad7aeeea4ccf920458e8e60cd15c4ee1f7a6f35'}
2025-08-20 08:17:17,682 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSOEVFNDE0ODVGOEYzNDFCMTNFAA==",
                "status": "delivered",
                "timestamp": "1755667036",
                "recipient_id": "254745026933",
                "conversation": {
                  "id": "0242b0daa77843575f6b046118ecf7bf",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:17:17,685 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:17:17,686 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSOEVFNDE0ODVGOEYzNDFCMTNFAA==",
      "status": "delivered",
      "timestamp": "1755667036",
      "recipient_id": "254745026933",
      "conversation": {
        "id": "0242b0daa77843575f6b046118ecf7bf",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:17:17,689 - server - INFO - Message queued for processing
2025-08-20 08:17:17,689 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:17:17,690 - server - INFO - No messages in webhook
2025-08-20 08:17:18,578 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:17:18,579 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:1::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=8f40b888020e4de7833d84109455c92561dbffa1', 'x-hub-signature-256': 'sha256=7bd6eb662b083659343407c45f6eb7839229c8d769d7872890a25c4dc21eadda'}
2025-08-20 08:17:18,580 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQUYzNjhEODY1M0Q2REM5RjFCAA==",
                "status": "sent",
                "timestamp": "1755667037",
                "recipient_id": "254745026933",
                "conversation": {
                  "id": "ccf09d2b000d44a25bb407d92402af40",
                  "expiration_timestamp": "1755667037",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:17:18,582 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:17:18,582 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQUYzNjhEODY1M0Q2REM5RjFCAA==",
      "status": "sent",
      "timestamp": "1755667037",
      "recipient_id": "254745026933",
      "conversation": {
        "id": "ccf09d2b000d44a25bb407d92402af40",
        "expiration_timestamp": "1755667037",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:17:18,584 - server - INFO - Message queued for processing
2025-08-20 08:17:18,584 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:17:18,585 - server - INFO - No messages in webhook
2025-08-20 08:17:19,142 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:17:19,143 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '582', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:d::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=a1956677097fd744611628bb0a7f23ece91f5f7d', 'x-hub-signature-256': 'sha256=66136535fb9c57b6b655e2ca66daf47e8727f7203a8ac3143b519c2969eaf39f'}
2025-08-20 08:17:19,143 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQUYzNjhEODY1M0Q2REM5RjFCAA==",
                "status": "delivered",
                "timestamp": "1755667037",
                "recipient_id": "254745026933",
                "conversation": {
                  "id": "ccf09d2b000d44a25bb407d92402af40",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:17:19,145 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:17:19,145 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQUYzNjhEODY1M0Q2REM5RjFCAA==",
      "status": "delivered",
      "timestamp": "1755667037",
      "recipient_id": "254745026933",
      "conversation": {
        "id": "ccf09d2b000d44a25bb407d92402af40",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:17:19,147 - server - INFO - Message queued for processing
2025-08-20 08:17:19,147 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:17:19,150 - server - INFO - No messages in webhook
2025-08-20 08:17:19,151 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:17:19,151 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '582', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:4::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=a1956677097fd744611628bb0a7f23ece91f5f7d', 'x-hub-signature-256': 'sha256=66136535fb9c57b6b655e2ca66daf47e8727f7203a8ac3143b519c2969eaf39f'}
2025-08-20 08:17:19,152 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQUYzNjhEODY1M0Q2REM5RjFCAA==",
                "status": "delivered",
                "timestamp": "1755667037",
                "recipient_id": "254745026933",
                "conversation": {
                  "id": "ccf09d2b000d44a25bb407d92402af40",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:17:19,156 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:17:19,156 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQUYzNjhEODY1M0Q2REM5RjFCAA==",
      "status": "delivered",
      "timestamp": "1755667037",
      "recipient_id": "254745026933",
      "conversation": {
        "id": "ccf09d2b000d44a25bb407d92402af40",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:17:19,159 - server - INFO - Message queued for processing
2025-08-20 08:17:19,159 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:17:19,161 - server - INFO - No messages in webhook
2025-08-20 08:17:20,465 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:17:20,466 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '389', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:47::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=d5e208b0e203df557b04289c5e6f82dcd2aa1c26', 'x-hub-signature-256': 'sha256=dd30b318052993ed7b5d09ab37b044933c18ba0d112aac0474de723c2f661339'}
2025-08-20 08:17:20,467 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSOEVFNDE0ODVGOEYzNDFCMTNFAA==",
                "status": "read",
                "timestamp": "1755667039",
                "recipient_id": "254745026933"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:17:20,470 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:17:20,470 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSOEVFNDE0ODVGOEYzNDFCMTNFAA==",
      "status": "read",
      "timestamp": "1755667039",
      "recipient_id": "254745026933"
    }
  ]
}
2025-08-20 08:17:20,472 - server - INFO - Message queued for processing
2025-08-20 08:17:20,472 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:17:20,474 - server - INFO - No messages in webhook
2025-08-20 08:17:20,491 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:17:20,491 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '389', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:71::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=8a7f205d9b7b09849db935ec1ba198d9853eea0d', 'x-hub-signature-256': 'sha256=63f5caf4932bb6bd5e53e3afe06b22fec61b9be84993295769b2a85f63808fe3'}
2025-08-20 08:17:20,491 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQUYzNjhEODY1M0Q2REM5RjFCAA==",
                "status": "read",
                "timestamp": "1755667039",
                "recipient_id": "254745026933"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:17:20,493 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:17:20,494 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQUYzNjhEODY1M0Q2REM5RjFCAA==",
      "status": "read",
      "timestamp": "1755667039",
      "recipient_id": "254745026933"
    }
  ]
}
2025-08-20 08:17:20,495 - server - INFO - Message queued for processing
2025-08-20 08:17:20,495 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:17:20,497 - server - INFO - No messages in webhook
2025-08-20 08:17:21,223 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:17:21,224 - server - INFO - Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.19041.6216', 'content-type': 'application/json', 'host': '127.0.0.1:8001', 'content-length': '1394', 'connection': 'Keep-Alive'}
2025-08-20 08:17:21,225 - server - INFO - Raw webhook payload: {
  "entry": [
    {
      "id": "t_force",
      "changes": [
        {
          "value": {
            "messages": [
              {
                "from": "+15551234567",
                "timestamp": "1692547210",
                "id": "t_f1",
                "type": "text",
                "text": {
                  "body": "Forced test for AI + owner notify"
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
2025-08-20 08:17:21,226 - server - INFO - Entry ID: t_force
2025-08-20 08:17:21,226 - server - INFO - Change Value: {
  "messages": [
    {
      "from": "+15551234567",
      "timestamp": "1692547210",
      "id": "t_f1",
      "type": "text",
      "text": {
        "body": "Forced test for AI + owner notify"
      }
    }
  ]
}
2025-08-20 08:17:21,227 - server - INFO - Message ID: t_f1
2025-08-20 08:17:21,227 - server - INFO - From: +15551234567
2025-08-20 08:17:21,228 - server - INFO - Timestamp: 1692547210
2025-08-20 08:17:21,228 - server - INFO - Type: text
2025-08-20 08:17:21,228 - server - INFO - Content: Forced test for AI + owner notify
2025-08-20 08:17:21,228 - server - INFO - Message queued for processing
2025-08-20 08:17:21,229 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:17:21,230 - server - INFO - Processing message from +15551234567: Forced test for AI + owner notify
2025-08-20 08:17:25,607 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:17:26,169 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:17:26,170 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AczGDOJpKaOPhLwiYtdcLDH"}}
2025-08-20 08:17:26,171 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 08:18:43,326 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:18:43,326 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '488', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:12ff:9::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=a576dfc7026b2db88a615ff511a48ff12c57e951', 'x-hub-signature-256': 'sha256=716eb023b24d8e91597fafde4c38ef5677236cfe4ebf6942c6c2f1729890b0ff'}
2025-08-20 08:18:43,326 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggODJGQURGRTZEOTMyN0ZBQjNEMEU1MDZENEI0OENDM0QA",
                "timestamp": "1755667121",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:18:43,328 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:18:43,329 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggODJGQURGRTZEOTMyN0ZBQjNEMEU1MDZENEI0OENDM0QA",
      "timestamp": "1755667121",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 08:18:43,331 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggODJGQURGRTZEOTMyN0ZBQjNEMEU1MDZENEI0OENDM0QA
2025-08-20 08:18:43,332 - server - INFO - From: 254702944890
2025-08-20 08:18:43,332 - server - INFO - Timestamp: 1755667121
2025-08-20 08:18:43,333 - server - INFO - Type: text
2025-08-20 08:18:43,333 - server - INFO - Content: Hi
2025-08-20 08:18:43,333 - server - INFO - Message queued for processing
2025-08-20 08:18:43,334 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:18:43,336 - server - INFO - Processing message from 254702944890: Hi
2025-08-20 08:18:47,803 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:18:48,601 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:18:48,603 - server - INFO - Message sent to 254702944890: Please state your name and the purpose of your mes...
2025-08-20 08:18:50,217 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'consumer': 'projects/260626823147', 'containerInfo': '260626823147', 'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'serviceTitle': 'Google Drive API', 'service': 'drive.googleapis.com'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 08:18:50,219 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 08:18:50,233 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:18:50,233 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:40::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=f7e67da0a21eec0ffd6fe9577aab2f32e776e85a', 'x-hub-signature-256': 'sha256=8a5a20373d821251c86ca2fe95190723c012bc6c241ba789c4f1e40899deb3f6'}
2025-08-20 08:18:50,234 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQzdCQjM4MTBGQUZBM0Q3RTY1AA==",
                "status": "sent",
                "timestamp": "1755667127",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "1621c31a859b46c0cc5e2c05c5aadeab",
                  "expiration_timestamp": "1755667127",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:18:50,238 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:18:50,238 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQzdCQjM4MTBGQUZBM0Q3RTY1AA==",
      "status": "sent",
      "timestamp": "1755667127",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "1621c31a859b46c0cc5e2c05c5aadeab",
        "expiration_timestamp": "1755667127",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:18:50,240 - server - INFO - Message queued for processing
2025-08-20 08:18:50,241 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:18:50,243 - server - INFO - No messages in webhook
2025-08-20 08:18:50,245 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:18:50,246 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:5f::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=34e0207f1843d1f2bc9f2a45ac069c7814d41f7f', 'x-hub-signature-256': 'sha256=435a24be5647068d0049748fbf3654000bb85fa383443ddf678fb6b4443303ae'}
2025-08-20 08:18:50,247 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQzIwQTgwNjlBNzYzNzVDQTE0AA==",
                "status": "sent",
                "timestamp": "1755667128",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "eba56685646be5c07b3ba106e8bcd271",
                  "expiration_timestamp": "1755667128",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:18:50,250 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:18:50,250 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQzIwQTgwNjlBNzYzNzVDQTE0AA==",
      "status": "sent",
      "timestamp": "1755667128",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "eba56685646be5c07b3ba106e8bcd271",
        "expiration_timestamp": "1755667128",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:18:50,252 - server - INFO - Message queued for processing
2025-08-20 08:18:50,252 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:18:50,254 - server - INFO - No messages in webhook
2025-08-20 08:18:50,255 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:18:50,256 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:12ff:2::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=3edbe44559789954ff35460691001da06676e087', 'x-hub-signature-256': 'sha256=c0c0dc71d87de99b1798c9f2ef2b1079d8f791a00577dddb4dd4594050c43841'}
2025-08-20 08:18:50,256 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQzdCQjM4MTBGQUZBM0Q3RTY1AA==",
                "status": "read",
                "timestamp": "1755667128",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "1621c31a859b46c0cc5e2c05c5aadeab",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:18:50,258 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:18:50,259 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQzdCQjM4MTBGQUZBM0Q3RTY1AA==",
      "status": "read",
      "timestamp": "1755667128",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "1621c31a859b46c0cc5e2c05c5aadeab",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:18:50,260 - server - INFO - Message queued for processing
2025-08-20 08:18:50,261 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:18:50,262 - server - INFO - No messages in webhook
2025-08-20 08:18:51,718 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:18:51,811 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:18:51,811 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:4::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=65b648f9f3421114e2345c4a3ab24deab37ea5f8', 'x-hub-signature-256': 'sha256=155c41c6872d3d24987e518f3eb1c7ba22db2d04cd272f84e340308514f2e1d2'}
2025-08-20 08:18:51,812 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQzIwQTgwNjlBNzYzNzVDQTE0AA==",
                "status": "read",
                "timestamp": "1755667129",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "eba56685646be5c07b3ba106e8bcd271",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:18:51,814 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:18:51,815 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQzIwQTgwNjlBNzYzNzVDQTE0AA==",
      "status": "read",
      "timestamp": "1755667129",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "eba56685646be5c07b3ba106e8bcd271",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:18:51,817 - server - INFO - Message queued for processing
2025-08-20 08:18:51,818 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:18:51,819 - server - INFO - No messages in webhook
2025-08-20 08:18:51,820 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:18:51,820 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '497', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:12ff:70::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=d1660ddafdb94dc0bf98e048894bda6e8826f6b7', 'x-hub-signature-256': 'sha256=a18c85eb5156f192504af1db952fa4267d77a0c5f69ad712ad300586440f8ff0'}
2025-08-20 08:18:51,821 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggRkNERDlBQkI2MTU1RUNERUNFMjRCN0FDMjE4NjM1QUUA",
                "timestamp": "1755667129",
                "text": {
                  "body": "How are you"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:18:51,823 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:18:51,824 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggRkNERDlBQkI2MTU1RUNERUNFMjRCN0FDMjE4NjM1QUUA",
      "timestamp": "1755667129",
      "text": {
        "body": "How are you"
      },
      "type": "text"
    }
  ]
}
2025-08-20 08:18:51,826 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggRkNERDlBQkI2MTU1RUNERUNFMjRCN0FDMjE4NjM1QUUA
2025-08-20 08:18:51,826 - server - INFO - From: 254702944890
2025-08-20 08:18:51,826 - server - INFO - Timestamp: 1755667129
2025-08-20 08:18:51,827 - server - INFO - Type: text
2025-08-20 08:18:51,827 - server - INFO - Content: How are you
2025-08-20 08:18:51,827 - server - INFO - Message queued for processing
2025-08-20 08:18:51,828 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:18:51,830 - server - INFO - Processing message from 254702944890: How are you
2025-08-20 08:18:54,191 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:18:54,192 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AiiCqvKJ2bPOrv1ILxnV7cb"}}
2025-08-20 08:18:54,193 - server - WARNING - Failed to send owner notification: 
2025-08-20 08:18:54,194 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 08:18:54,194 - server - INFO - Message processed successfully for 254702944890
2025-08-20 08:18:55,317 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:18:56,249 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:18:56,250 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:4::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=bb3af8dc7e3eb372485ed8a7a532920a8c943d3e', 'x-hub-signature-256': 'sha256=a31b2a0788c59be512f0883983708293675d1c05655e308b2708d7cc31dca8ca'}
2025-08-20 08:18:56,251 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRjc1NjREODQ5QTMyRTIwMjdCAA==",
                "status": "sent",
                "timestamp": "1755667135",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "a2dfa18e4e13bce25fd53feaf12f16c1",
                  "expiration_timestamp": "1755667135",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:18:56,253 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:18:56,254 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRjc1NjREODQ5QTMyRTIwMjdCAA==",
      "status": "sent",
      "timestamp": "1755667135",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "a2dfa18e4e13bce25fd53feaf12f16c1",
        "expiration_timestamp": "1755667135",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:18:56,256 - server - INFO - Message queued for processing
2025-08-20 08:18:56,256 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:18:56,258 - server - INFO - No messages in webhook
2025-08-20 08:18:56,409 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:18:56,410 - server - INFO - Message sent to 254702944890: Please state your name and the purpose of your mes...
2025-08-20 08:18:58,030 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'containerInfo': '260626823147', 'service': 'drive.googleapis.com', 'consumer': 'projects/260626823147', 'serviceTitle': 'Google Drive API'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 08:18:58,032 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 08:18:58,047 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:18:58,047 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:4::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=868f9fc327c0d0fa878a31115d18dd26c3351e9d', 'x-hub-signature-256': 'sha256=89283dc181f4f0d3ff0b7f9f960498556ca3aa04994584fc86365cc1147625d0'}
2025-08-20 08:18:58,048 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQzdCOThCNkI1NDE0QUU3NTMxAA==",
                "status": "sent",
                "timestamp": "1755667136",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "e7c75c0d6aaefbf9037c95d272a0652c",
                  "expiration_timestamp": "1755667136",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:18:58,051 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:18:58,052 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQzdCOThCNkI1NDE0QUU3NTMxAA==",
      "status": "sent",
      "timestamp": "1755667136",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "e7c75c0d6aaefbf9037c95d272a0652c",
        "expiration_timestamp": "1755667136",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:18:58,053 - server - INFO - Message queued for processing
2025-08-20 08:18:58,054 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:18:58,055 - server - INFO - No messages in webhook
2025-08-20 08:18:58,056 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:18:58,056 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '489', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:1::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=fad6a42e50b29877dab05e569da29247c3a883bf', 'x-hub-signature-256': 'sha256=6a22624e9071c486974840c2dab08069d05fb28e84c9f07b347bfe0a4a011b65'}
2025-08-20 08:18:58,057 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggQkI4OUQ4MzQzODQ5M0Q0RDFGMUI2OEQ3ODgyQTI3OEEA",
                "timestamp": "1755667135",
                "text": {
                  "body": "Bye"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:18:58,059 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:18:58,059 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggQkI4OUQ4MzQzODQ5M0Q0RDFGMUI2OEQ3ODgyQTI3OEEA",
      "timestamp": "1755667135",
      "text": {
        "body": "Bye"
      },
      "type": "text"
    }
  ]
}
2025-08-20 08:18:58,061 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggQkI4OUQ4MzQzODQ5M0Q0RDFGMUI2OEQ3ODgyQTI3OEEA
2025-08-20 08:18:58,061 - server - INFO - From: 254702944890
2025-08-20 08:18:58,062 - server - INFO - Timestamp: 1755667135
2025-08-20 08:18:58,062 - server - INFO - Type: text
2025-08-20 08:18:58,062 - server - INFO - Content: Bye
2025-08-20 08:18:58,063 - server - INFO - Message queued for processing
2025-08-20 08:18:58,063 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:18:58,065 - server - INFO - Processing message from 254702944890: Bye
2025-08-20 08:19:00,597 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:19:00,597 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:7::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=c35c21c31be8e6cad8e441097da5ef3e425c8a35', 'x-hub-signature-256': 'sha256=388d1f51fcde6fd648ce4cef889862cc3bec11724d8966cf79cc5dc223c4003e'}
2025-08-20 08:19:00,598 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQzdCOThCNkI1NDE0QUU3NTMxAA==",
                "status": "read",
                "timestamp": "1755667137",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "e7c75c0d6aaefbf9037c95d272a0652c",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:19:00,602 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:19:00,602 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQzdCOThCNkI1NDE0QUU3NTMxAA==",
      "status": "read",
      "timestamp": "1755667137",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "e7c75c0d6aaefbf9037c95d272a0652c",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:19:00,606 - server - INFO - Message queued for processing
2025-08-20 08:19:00,606 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:19:00,608 - server - INFO - No messages in webhook
2025-08-20 08:19:00,608 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:19:00,609 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:c::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=dcd044917e9b63c8f003ac39214a2facc0913fd9', 'x-hub-signature-256': 'sha256=3a23e9cd1dd4d7c7e5df276ecb4400ea2e8811ae166c61afaf62bd3f16f3cc1c'}
2025-08-20 08:19:00,609 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRjc1NjREODQ5QTMyRTIwMjdCAA==",
                "status": "read",
                "timestamp": "1755667135",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "a2dfa18e4e13bce25fd53feaf12f16c1",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:19:00,611 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:19:00,612 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRjc1NjREODQ5QTMyRTIwMjdCAA==",
      "status": "read",
      "timestamp": "1755667135",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "a2dfa18e4e13bce25fd53feaf12f16c1",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:19:00,614 - server - INFO - Message queued for processing
2025-08-20 08:19:00,615 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:19:00,617 - server - INFO - No messages in webhook
2025-08-20 08:19:01,239 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:19:01,616 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:19:01,738 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:19:01,739 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AN2vghBrRmsMJ4ioMZm2mXj"}}
2025-08-20 08:19:01,739 - server - WARNING - Failed to send owner notification: 
2025-08-20 08:19:01,740 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 08:19:01,740 - server - INFO - Message processed successfully for 254702944890
2025-08-20 08:19:02,582 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:19:02,583 - server - INFO - Message sent to 254702944890: Please state your name and the purpose of your mes...
2025-08-20 08:19:04,092 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'consumer': 'projects/260626823147', 'containerInfo': '260626823147', 'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'serviceTitle': 'Google Drive API', 'service': 'drive.googleapis.com'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 08:19:04,094 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 08:19:04,110 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:19:04,111 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '489', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:72::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=ee8753e4051b5eccbe8f490808b251d8fd9da016', 'x-hub-signature-256': 'sha256=df641d948b68c314f704c4a74fce95271e51567d5a7b679a022cbcdc781ebae1'}
2025-08-20 08:19:04,111 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMDNBNDk3M0Q2NzYxMTMzN0VBOERDQUIxNzRFQzRDREYA",
                "timestamp": "1755667141",
                "text": {
                  "body": "Bye"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:19:04,116 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:19:04,116 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMDNBNDk3M0Q2NzYxMTMzN0VBOERDQUIxNzRFQzRDREYA",
      "timestamp": "1755667141",
      "text": {
        "body": "Bye"
      },
      "type": "text"
    }
  ]
}
2025-08-20 08:19:04,118 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggMDNBNDk3M0Q2NzYxMTMzN0VBOERDQUIxNzRFQzRDREYA
2025-08-20 08:19:04,118 - server - INFO - From: 254702944890
2025-08-20 08:19:04,119 - server - INFO - Timestamp: 1755667141
2025-08-20 08:19:04,119 - server - INFO - Type: text
2025-08-20 08:19:04,119 - server - INFO - Content: Bye
2025-08-20 08:19:04,120 - server - INFO - Message queued for processing
2025-08-20 08:19:04,120 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:19:04,121 - server - INFO - Processing message from 254702944890: Bye
2025-08-20 08:19:15,646 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:19:15,646 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:1::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=439f00f04911d3c05586afd9cc22cf8ddceb07a6', 'x-hub-signature-256': 'sha256=d96de12e6a90b77baea9749a73cdb6ccd282009386163532b45f251632ce425f'}
2025-08-20 08:19:15,647 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMTZENjk2QkVFNUZENzQwNTY3AA==",
                "status": "sent",
                "timestamp": "1755667141",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "5ef382d1ac0bf8da65d3d1af4f6ea0a4",
                  "expiration_timestamp": "1755667141",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:19:15,651 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:19:15,652 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMTZENjk2QkVFNUZENzQwNTY3AA==",
      "status": "sent",
      "timestamp": "1755667141",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "5ef382d1ac0bf8da65d3d1af4f6ea0a4",
        "expiration_timestamp": "1755667141",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:19:15,655 - server - INFO - Message queued for processing
2025-08-20 08:19:15,656 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:19:15,658 - server - INFO - No messages in webhook
2025-08-20 08:19:15,661 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:19:15,661 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=b0830f60d82fd95f2797393872ab80a4ca75bcf8', 'x-hub-signature-256': 'sha256=37de881418f66fd9f215c6c0fca75e95307fb94b2f41b6fc0275dc15da481d0a'}
2025-08-20 08:19:15,662 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMTZENjk2QkVFNUZENzQwNTY3AA==",
                "status": "read",
                "timestamp": "1755667142",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "5ef382d1ac0bf8da65d3d1af4f6ea0a4",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:19:15,669 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:19:15,669 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMTZENjk2QkVFNUZENzQwNTY3AA==",
      "status": "read",
      "timestamp": "1755667142",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "5ef382d1ac0bf8da65d3d1af4f6ea0a4",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:19:15,672 - server - INFO - Message queued for processing
2025-08-20 08:19:15,672 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:19:15,674 - server - INFO - No messages in webhook
2025-08-20 08:19:15,676 - server - ERROR - Error sending message to 15551926618: 
2025-08-20 08:19:15,676 - server - WARNING - Failed to send owner notification: 
2025-08-20 08:19:15,678 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 08:19:15,678 - server - INFO - Message processed successfully for 254702944890
2025-08-20 08:19:15,679 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:19:15,679 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:d::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=46114b2b957ed94824b022b180ce86d8e3310912', 'x-hub-signature-256': 'sha256=003a374047b39b5a0075fb70aea4e886d1ea62fd462dd3853bd10535c42ce90f'}
2025-08-20 08:19:15,680 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQUMyNERGMDA1ODlDMDAwODJFAA==",
                "status": "read",
                "timestamp": "1755667143",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "c50ff9bd09bc5a2b0c87b7dd54fdb08e",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:19:15,685 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:19:15,685 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQUMyNERGMDA1ODlDMDAwODJFAA==",
      "status": "read",
      "timestamp": "1755667143",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "c50ff9bd09bc5a2b0c87b7dd54fdb08e",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:19:15,687 - server - INFO - Message queued for processing
2025-08-20 08:19:15,688 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:19:15,689 - server - INFO - No messages in webhook
2025-08-20 08:19:15,690 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:19:15,691 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:70::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=b12501637f0b4dabca456b9a1143950ae4b5c2e1', 'x-hub-signature-256': 'sha256=4f47f519004014d4acb6c5cd8033f0bf3fb3a9042e6b39c339af4486b3747d15'}
2025-08-20 08:19:15,691 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQUMyNERGMDA1ODlDMDAwODJFAA==",
                "status": "sent",
                "timestamp": "1755667142",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "c50ff9bd09bc5a2b0c87b7dd54fdb08e",
                  "expiration_timestamp": "1755667142",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:19:15,694 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:19:15,695 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQUMyNERGMDA1ODlDMDAwODJFAA==",
      "status": "sent",
      "timestamp": "1755667142",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "c50ff9bd09bc5a2b0c87b7dd54fdb08e",
        "expiration_timestamp": "1755667142",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:19:15,696 - server - INFO - Message queued for processing
2025-08-20 08:19:15,696 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:19:15,698 - server - INFO - No messages in webhook
2025-08-20 08:19:16,542 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:19:17,417 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:19:17,418 - server - INFO - Message sent to 254702944890: Please state your name and the purpose of your mes...
2025-08-20 08:19:20,118 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'containerInfo': '260626823147', 'serviceTitle': 'Google Drive API', 'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'consumer': 'projects/260626823147', 'service': 'drive.googleapis.com'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 08:19:20,121 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 08:19:20,144 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:19:20,144 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:7::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=886dafedc69bbaa643844c7566686739461ebd0a', 'x-hub-signature-256': 'sha256=2874e267c2db9ce4a9c8602585362df5d61fbf7c69223f32864c5afa30c2e6fd'}
2025-08-20 08:19:20,146 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOEE5RDY4MjNCMzk3RjE0MUZGAA==",
                "status": "sent",
                "timestamp": "1755667156",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "72d08e7f36405ed746465be9c8e8bb6b",
                  "expiration_timestamp": "1755667156",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:19:20,150 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:19:20,151 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOEE5RDY4MjNCMzk3RjE0MUZGAA==",
      "status": "sent",
      "timestamp": "1755667156",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "72d08e7f36405ed746465be9c8e8bb6b",
        "expiration_timestamp": "1755667156",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:19:20,154 - server - INFO - Message queued for processing
2025-08-20 08:19:20,155 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:19:20,157 - server - INFO - No messages in webhook
2025-08-20 08:19:20,157 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:19:20,158 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '582', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:70::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=71aa82550a4b1c8ee1d23a9e8418eddf4fdc0e40', 'x-hub-signature-256': 'sha256=d6f394914d753c4931817013955985fa27fa135970b9724a841e2dda0aaf1460'}
2025-08-20 08:19:20,161 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOEE5RDY4MjNCMzk3RjE0MUZGAA==",
                "status": "delivered",
                "timestamp": "1755667157",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "72d08e7f36405ed746465be9c8e8bb6b",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:19:20,167 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:19:20,168 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOEE5RDY4MjNCMzk3RjE0MUZGAA==",
      "status": "delivered",
      "timestamp": "1755667157",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "72d08e7f36405ed746465be9c8e8bb6b",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:19:20,171 - server - INFO - Message queued for processing
2025-08-20 08:19:20,172 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:19:20,174 - server - INFO - No messages in webhook
2025-08-20 08:19:20,175 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:19:20,175 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '582', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:12ff:3::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=1223eeae073e184fcd93de6de8e72e6da01e8b06', 'x-hub-signature-256': 'sha256=9e380febb7dedb8060ce25829b9ab1ae52be1a0578c1715b798af706cfd84052'}
2025-08-20 08:19:20,176 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQjI4Qjg0NTFFRDdCNkM2NUQ2AA==",
                "status": "delivered",
                "timestamp": "1755667158",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "f02bfeeb7ea43567d8a87fc99b57845d",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:19:20,180 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:19:20,182 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQjI4Qjg0NTFFRDdCNkM2NUQ2AA==",
      "status": "delivered",
      "timestamp": "1755667158",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "f02bfeeb7ea43567d8a87fc99b57845d",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:19:20,186 - server - INFO - Message queued for processing
2025-08-20 08:19:20,187 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:19:20,189 - server - INFO - No messages in webhook
2025-08-20 08:19:20,190 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:19:20,190 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:2::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=041c94fb3e6ab1cba2614a0c125141838532f9ee', 'x-hub-signature-256': 'sha256=aa007489b679f524c9ffdb645a128eca5d186ee4ec3a9d7bddc68966df0a03c8'}
2025-08-20 08:19:20,191 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQjI4Qjg0NTFFRDdCNkM2NUQ2AA==",
                "status": "sent",
                "timestamp": "1755667157",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "f02bfeeb7ea43567d8a87fc99b57845d",
                  "expiration_timestamp": "1755667157",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:19:20,195 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:19:20,195 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQjI4Qjg0NTFFRDdCNkM2NUQ2AA==",
      "status": "sent",
      "timestamp": "1755667157",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "f02bfeeb7ea43567d8a87fc99b57845d",
        "expiration_timestamp": "1755667157",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:19:20,199 - server - INFO - Message queued for processing
2025-08-20 08:19:20,200 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:19:20,202 - server - INFO - No messages in webhook
2025-08-20 08:19:21,385 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:19:22,663 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:19:22,665 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"Aab3fnsJLOlEfRQ2K3VnI2t"}}
2025-08-20 08:19:22,666 - server - WARNING - Failed to send owner notification: 
2025-08-20 08:19:22,666 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 08:19:22,666 - server - INFO - Message processed successfully for 254702944890
2025-08-20 08:21:58,382 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 08:21:58,404 - server - INFO - Connected to MongoDB successfully
2025-08-20 08:21:58,406 - server - INFO - Google Sheets client initialized
2025-08-20 08:22:03,854 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'service': 'drive.googleapis.com', 'serviceTitle': 'Google Drive API', 'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'containerInfo': '260626823147', 'consumer': 'projects/260626823147'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 08:22:03,858 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 08:22:05,311 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:22:06,020 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:22:06,020 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:44::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=0d494ab771c31fe876803921d27a0eef398bef13', 'x-hub-signature-256': 'sha256=c8fffafb6b9571e96f7139703415ced62428a733e965ef65874c6bce2c50434a'}
2025-08-20 08:22:06,021 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQTA3NzkzMUY3RUQxQzMzNjlDAA==",
                "status": "sent",
                "timestamp": "1755667325",
                "recipient_id": "254745026933",
                "conversation": {
                  "id": "0d9cb7482e66da98b28cf8fdc7d8a5a7",
                  "expiration_timestamp": "1755667325",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:22:06,024 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:22:06,024 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQTA3NzkzMUY3RUQxQzMzNjlDAA==",
      "status": "sent",
      "timestamp": "1755667325",
      "recipient_id": "254745026933",
      "conversation": {
        "id": "0d9cb7482e66da98b28cf8fdc7d8a5a7",
        "expiration_timestamp": "1755667325",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:22:06,025 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:22:06,025 - server - INFO - Message sent to 254745026933: [2025-08-20 08:22] Unknown (new): Dan Kosgey repea...
2025-08-20 08:22:06,026 - server - INFO - Sent owner summary notification to +254745026933: {'messaging_product': 'whatsapp', 'contacts': [{'input': '254745026933', 'wa_id': '254745026933'}], 'messages': [{'id': 'wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSNzhEODlDODhDMzUyMkMwQ0NBAA=='}]}
2025-08-20 08:22:06,026 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 08:22:06,028 - server - INFO - Message queued for processing
2025-08-20 08:22:06,028 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:22:06,030 - server - INFO - No messages in webhook
2025-08-20 08:22:06,966 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:22:06,966 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:4::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=76b520e740a3696f2e72c30a9b4377960218fbaf', 'x-hub-signature-256': 'sha256=6fd40cd66eed846dc744556981c45be0722e436025c116176f641a1a96cb59d9'}
2025-08-20 08:22:06,967 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSNzhEODlDODhDMzUyMkMwQ0NBAA==",
                "status": "sent",
                "timestamp": "1755667325",
                "recipient_id": "254745026933",
                "conversation": {
                  "id": "e77c6b61889b5dc6fc83c64f2fc14ae5",
                  "expiration_timestamp": "1755667325",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:22:06,969 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:22:06,970 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSNzhEODlDODhDMzUyMkMwQ0NBAA==",
      "status": "sent",
      "timestamp": "1755667325",
      "recipient_id": "254745026933",
      "conversation": {
        "id": "e77c6b61889b5dc6fc83c64f2fc14ae5",
        "expiration_timestamp": "1755667325",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:22:06,972 - server - INFO - Message queued for processing
2025-08-20 08:22:06,973 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:22:06,975 - server - INFO - No messages in webhook
2025-08-20 08:22:07,496 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:22:07,496 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '582', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:44::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=ff115d6374e478796e3a5362f93272e5d42e9c1a', 'x-hub-signature-256': 'sha256=20abb81b2cf494c4c7d7eb757a7472ed8bf93bd3e1712547afff6e86c6e89511'}
2025-08-20 08:22:07,497 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQTA3NzkzMUY3RUQxQzMzNjlDAA==",
                "status": "delivered",
                "timestamp": "1755667326",
                "recipient_id": "254745026933",
                "conversation": {
                  "id": "0d9cb7482e66da98b28cf8fdc7d8a5a7",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:22:07,502 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:22:07,502 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQTA3NzkzMUY3RUQxQzMzNjlDAA==",
      "status": "delivered",
      "timestamp": "1755667326",
      "recipient_id": "254745026933",
      "conversation": {
        "id": "0d9cb7482e66da98b28cf8fdc7d8a5a7",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:22:07,504 - server - INFO - Message queued for processing
2025-08-20 08:22:07,504 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:22:07,506 - server - INFO - No messages in webhook
2025-08-20 08:22:07,507 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:22:07,507 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '582', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:44::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=17a2b7ae91b72291b5187fa85cf2f00fd2ea3689', 'x-hub-signature-256': 'sha256=79eeae87ff42128c3d773a9f3ec16c1f24f8bcff41f5d5edd105cf7aac13f4e1'}
2025-08-20 08:22:07,507 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSNzhEODlDODhDMzUyMkMwQ0NBAA==",
                "status": "delivered",
                "timestamp": "1755667326",
                "recipient_id": "254745026933",
                "conversation": {
                  "id": "e77c6b61889b5dc6fc83c64f2fc14ae5",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:22:07,509 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:22:07,510 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSNzhEODlDODhDMzUyMkMwQ0NBAA==",
      "status": "delivered",
      "timestamp": "1755667326",
      "recipient_id": "254745026933",
      "conversation": {
        "id": "e77c6b61889b5dc6fc83c64f2fc14ae5",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:22:07,511 - server - INFO - Message queued for processing
2025-08-20 08:22:07,512 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:22:07,514 - server - INFO - No messages in webhook
2025-08-20 08:22:09,718 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:22:09,718 - server - INFO - Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.19041.6216', 'content-type': 'application/json', 'host': '127.0.0.1:8001', 'content-length': '1394', 'connection': 'Keep-Alive'}
2025-08-20 08:22:09,719 - server - INFO - Raw webhook payload: {
  "entry": [
    {
      "id": "t_force",
      "changes": [
        {
          "value": {
            "messages": [
              {
                "from": "+15551234567",
                "timestamp": "1692547210",
                "id": "t_f1",
                "type": "text",
                "text": {
                  "body": "Forced test for AI + owner notify"
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
2025-08-20 08:22:09,721 - server - INFO - Entry ID: t_force
2025-08-20 08:22:09,721 - server - INFO - Change Value: {
  "messages": [
    {
      "from": "+15551234567",
      "timestamp": "1692547210",
      "id": "t_f1",
      "type": "text",
      "text": {
        "body": "Forced test for AI + owner notify"
      }
    }
  ]
}
2025-08-20 08:22:09,722 - server - INFO - Message ID: t_f1
2025-08-20 08:22:09,722 - server - INFO - From: +15551234567
2025-08-20 08:22:09,723 - server - INFO - Timestamp: 1692547210
2025-08-20 08:22:09,723 - server - INFO - Type: text
2025-08-20 08:22:09,724 - server - INFO - Content: Forced test for AI + owner notify
2025-08-20 08:22:09,724 - server - INFO - Message queued for processing
2025-08-20 08:22:09,724 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:22:09,725 - server - INFO - Processing message from +15551234567: Forced test for AI + owner notify
2025-08-20 08:22:12,009 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:22:12,534 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 08:22:12,534 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AalIlHwV-1SwN-raJCDjCsW"}}
2025-08-20 08:22:12,535 - server - ERROR - Error processing WhatsApp message: 
2025-08-20 08:22:13,537 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:22:13,538 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '389', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:44::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=77c6471c1db6f6e5dd8e7ce6ae7f615fb2a7b038', 'x-hub-signature-256': 'sha256=f24dbe7a2e1daf1b248d76058c586b6f4df36811c853d2f81e968072f10fcd0d'}
2025-08-20 08:22:13,539 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSNzhEODlDODhDMzUyMkMwQ0NBAA==",
                "status": "read",
                "timestamp": "1755667332",
                "recipient_id": "254745026933"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:22:13,541 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:22:13,541 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSNzhEODlDODhDMzUyMkMwQ0NBAA==",
      "status": "read",
      "timestamp": "1755667332",
      "recipient_id": "254745026933"
    }
  ]
}
2025-08-20 08:22:13,542 - server - INFO - Message queued for processing
2025-08-20 08:22:13,543 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:22:13,544 - server - INFO - No messages in webhook
2025-08-20 08:22:13,796 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:22:13,796 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '389', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:74::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=28be941cb217a2c2162d04178119948d1ab53158', 'x-hub-signature-256': 'sha256=2feea62bdef6003b27f186629bad59e77a9ceb8639056e68952b3e8476e2c82b'}
2025-08-20 08:22:13,797 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQTA3NzkzMUY3RUQxQzMzNjlDAA==",
                "status": "read",
                "timestamp": "1755667332",
                "recipient_id": "254745026933"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:22:13,799 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:22:13,800 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSQTA3NzkzMUY3RUQxQzMzNjlDAA==",
      "status": "read",
      "timestamp": "1755667332",
      "recipient_id": "254745026933"
    }
  ]
}
2025-08-20 08:22:13,801 - server - INFO - Message queued for processing
2025-08-20 08:22:13,801 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:22:13,803 - server - INFO - No messages in webhook
2025-08-20 08:23:20,152 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 08:23:20,194 - server - INFO - Connected to MongoDB successfully
2025-08-20 08:23:20,196 - server - INFO - Google Sheets client initialized
2025-08-20 08:26:32,318 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 08:26:32,334 - server - INFO - Connected to MongoDB successfully
2025-08-20 08:26:32,337 - server - INFO - Google Sheets client initialized
2025-08-20 08:28:04,757 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:28:04,758 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '389', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=898314057261aa47fb47ca150dfab605b9a91bc8', 'x-hub-signature-256': 'sha256=75b6c5ee636fc9fd921a65ae014c80074839223ecee1dde8cf28f3f40b304c95'}
2025-08-20 08:28:04,758 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQjI4Qjg0NTFFRDdCNkM2NUQ2AA==",
                "status": "read",
                "timestamp": "1755667683",
                "recipient_id": "254702944890"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:28:04,761 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:28:04,761 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSQjI4Qjg0NTFFRDdCNkM2NUQ2AA==",
      "status": "read",
      "timestamp": "1755667683",
      "recipient_id": "254702944890"
    }
  ]
}
2025-08-20 08:28:04,763 - server - INFO - Message queued for processing
2025-08-20 08:28:04,763 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:28:04,766 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:28:04,766 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '389', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:6::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=ddf1f041c57e1d6767d2fd81b467aa738d803afb', 'x-hub-signature-256': 'sha256=8b15ad3b8c338b1fd19377f77c5697b992f7599bb053d8297ad34bd9fff72d16'}
2025-08-20 08:28:04,767 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOEE5RDY4MjNCMzk3RjE0MUZGAA==",
                "status": "read",
                "timestamp": "1755667683",
                "recipient_id": "254702944890"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:28:04,770 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:28:04,770 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSOEE5RDY4MjNCMzk3RjE0MUZGAA==",
      "status": "read",
      "timestamp": "1755667683",
      "recipient_id": "254702944890"
    }
  ]
}
2025-08-20 08:28:04,772 - server - INFO - Message queued for processing
2025-08-20 08:28:04,772 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:28:15,961 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:28:15,961 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '488', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:73::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=e54e9ec8e6c5529fa680fbbf63fef9f546e408b0', 'x-hub-signature-256': 'sha256=dd4cb689fe5c50329fe5454cdd20bc8f83bf93668db732a8f99e3b1758ec092b'}
2025-08-20 08:28:15,962 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNjc4MTYyNkFDN0ZFRDVFNkU4OUQxQUJGQkZDNjg1MTAA",
                "timestamp": "1755667694",
                "text": {
                  "body": "Hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:28:15,966 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:28:15,966 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNjc4MTYyNkFDN0ZFRDVFNkU4OUQxQUJGQkZDNjg1MTAA",
      "timestamp": "1755667694",
      "text": {
        "body": "Hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 08:28:15,970 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhggNjc4MTYyNkFDN0ZFRDVFNkU4OUQxQUJGQkZDNjg1MTAA
2025-08-20 08:28:15,970 - server - INFO - From: 254702944890
2025-08-20 08:28:15,971 - server - INFO - Timestamp: 1755667694
2025-08-20 08:28:15,971 - server - INFO - Type: text
2025-08-20 08:28:15,971 - server - INFO - Content: Hi
2025-08-20 08:28:15,972 - server - INFO - Message queued for processing
2025-08-20 08:28:15,972 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:28:15,973 - server - INFO - Processing message from 254702944890: Hi
2025-08-20 08:28:17,268 - server - ERROR - Error classifying message: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 43
}
]
2025-08-20 08:28:17,463 - server - ERROR - Error generating AI response: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 42
}
]
2025-08-20 08:28:18,627 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:28:19,480 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:28:19,481 - server - INFO - Message sent to 254702944890: Thank you for your message. I'll get back to you s...
2025-08-20 08:28:19,682 - server - ERROR - Error generating summary: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 40
}
]
2025-08-20 08:28:20,697 - google_sheets_integration - ERROR - Error setting up spreadsheet: {'code': 403, 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'errors': [{'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.', 'domain': 'usageLimits', 'reason': 'accessNotConfigured', 'extendedHelp': 'https://console.developers.google.com'}], 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'SERVICE_DISABLED', 'domain': 'googleapis.com', 'metadata': {'activationUrl': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147', 'service': 'drive.googleapis.com', 'serviceTitle': 'Google Drive API', 'containerInfo': '260626823147', 'consumer': 'projects/260626823147'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'Google Drive API has not been used in project 260626823147 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.'}, {'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Google developers console API activation', 'url': 'https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=260626823147'}]}]}
2025-08-20 08:28:20,702 - google_sheets_integration - INFO - Logged conversation locally for 254702944890
2025-08-20 08:28:20,721 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:28:20,722 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:8::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=5f8be6a3e63b70de379b61e9958089d6254861ca', 'x-hub-signature-256': 'sha256=193929bced7f1d0d6d1cc46ae72cd89a86e1f1e0603175fbcc18cb7cc386be68'}
2025-08-20 08:28:20,723 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMjRBQURENzc4RjlCRjZDNDZFAA==",
                "status": "sent",
                "timestamp": "1755667698",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "aa1ee688fefcba48cfa90e89656d1c3f",
                  "expiration_timestamp": "1755667698",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:28:20,725 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:28:20,725 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMjRBQURENzc4RjlCRjZDNDZFAA==",
      "status": "sent",
      "timestamp": "1755667698",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "aa1ee688fefcba48cfa90e89656d1c3f",
        "expiration_timestamp": "1755667698",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:28:20,727 - server - INFO - Message queued for processing
2025-08-20 08:28:20,727 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:28:20,729 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:28:20,729 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:6::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=182f314d6582d030678bc3e87a9185099f578d87', 'x-hub-signature-256': 'sha256=6eb6e1bb0052ee11266888e4ad4544e87a363edf679c323a7a89869e0e161eb4'}
2025-08-20 08:28:20,730 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRjZDRjU4RDIwRUMwQTNBRkZFAA==",
                "status": "sent",
                "timestamp": "1755667699",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "d084c95d399ed7a2af0a1786af8f7755",
                  "expiration_timestamp": "1755667699",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:28:20,734 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:28:20,735 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRjZDRjU4RDIwRUMwQTNBRkZFAA==",
      "status": "sent",
      "timestamp": "1755667699",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "d084c95d399ed7a2af0a1786af8f7755",
        "expiration_timestamp": "1755667699",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:28:20,737 - server - INFO - Message queued for processing
2025-08-20 08:28:20,737 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:28:20,738 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:28:20,739 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:1::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=867cc1aa02f3712a82d174c664616f551237d63b', 'x-hub-signature-256': 'sha256=0915e339bb463ebe57b8e97b6ade85c0d43bf853b0b441a7dd517899c8327123'}
2025-08-20 08:28:20,739 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMjRBQURENzc4RjlCRjZDNDZFAA==",
                "status": "read",
                "timestamp": "1755667698",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "aa1ee688fefcba48cfa90e89656d1c3f",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:28:20,741 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:28:20,742 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMjRBQURENzc4RjlCRjZDNDZFAA==",
      "status": "read",
      "timestamp": "1755667698",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "aa1ee688fefcba48cfa90e89656d1c3f",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:28:20,743 - server - INFO - Message queued for processing
2025-08-20 08:28:20,744 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:28:20,923 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:28:20,923 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '577', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:a::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=4aa2cce37dbb19bf0e1c3d45670a7a285c53496d', 'x-hub-signature-256': 'sha256=0efc067969ef30a85b2b29665954b26186c1cffa369009e1b53a072bfa16289d'}
2025-08-20 08:28:20,924 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRjZDRjU4RDIwRUMwQTNBRkZFAA==",
                "status": "read",
                "timestamp": "1755667699",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "d084c95d399ed7a2af0a1786af8f7755",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:28:20,926 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:28:20,926 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSRjZDRjU4RDIwRUMwQTNBRkZFAA==",
      "status": "read",
      "timestamp": "1755667699",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "d084c95d399ed7a2af0a1786af8f7755",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:28:20,927 - server - INFO - Message queued for processing
2025-08-20 08:28:20,928 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:28:21,532 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:28:22,230 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 08:28:22,231 - server - INFO - Message sent to 254745026933: [2025-08-20 08:28] Unknown (new): Conversation wit...
2025-08-20 08:28:22,232 - server - INFO - Sent owner summary notification to +254745026933: {'messaging_product': 'whatsapp', 'contacts': [{'input': '254745026933', 'wa_id': '254745026933'}], 'messages': [{'id': 'wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSNUVFRkM4QzExMEQ3Q0E5QkRCAA=='}]}
2025-08-20 08:28:22,233 - server - INFO - Generated conversation summary for 254702944890
2025-08-20 08:28:22,233 - server - INFO - Message processed successfully for 254702944890
2025-08-20 08:28:22,395 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:28:22,395 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:70::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=f1095d45a4927d5fe479207eaaf3508d76ace527', 'x-hub-signature-256': 'sha256=69b4bcea4d7be9439de20eee983b98672f527062e384dd01b2aa006cf8f5aebf'}
2025-08-20 08:28:22,396 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSMzVGNkUyQ0ZBRDQ3NjczMkNGAA==",
                "status": "sent",
                "timestamp": "1755667701",
                "recipient_id": "254745026933",
                "conversation": {
                  "id": "2475bb177ef63cea89c55ea3f9749aca",
                  "expiration_timestamp": "1755667701",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:28:22,399 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:28:22,400 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSMzVGNkUyQ0ZBRDQ3NjczMkNGAA==",
      "status": "sent",
      "timestamp": "1755667701",
      "recipient_id": "254745026933",
      "conversation": {
        "id": "2475bb177ef63cea89c55ea3f9749aca",
        "expiration_timestamp": "1755667701",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:28:22,402 - server - INFO - Message queued for processing
2025-08-20 08:28:22,403 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:28:23,129 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:28:23,129 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:74::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=9e9751a7953d5666d89d428f9f4af41a4bc284a4', 'x-hub-signature-256': 'sha256=3e53529aedf7991b53bda62e957a32932c2da8e6c04fb850ced201ee45ae57b5'}
2025-08-20 08:28:23,130 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSNUVFRkM4QzExMEQ3Q0E5QkRCAA==",
                "status": "sent",
                "timestamp": "1755667702",
                "recipient_id": "254745026933",
                "conversation": {
                  "id": "5324dd26be1c2466a288d33c11e097ca",
                  "expiration_timestamp": "1755667702",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:28:23,134 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:28:23,135 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSNUVFRkM4QzExMEQ3Q0E5QkRCAA==",
      "status": "sent",
      "timestamp": "1755667702",
      "recipient_id": "254745026933",
      "conversation": {
        "id": "5324dd26be1c2466a288d33c11e097ca",
        "expiration_timestamp": "1755667702",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:28:23,137 - server - INFO - Message queued for processing
2025-08-20 08:28:23,138 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:28:23,502 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:28:23,502 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '582', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:4b::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=cc66ca407994766f5374dd9f6adcf39da1a8e5b9', 'x-hub-signature-256': 'sha256=ea4046ef1639efc0c4c30993379a9cba4a60e88afe231f68fd52424c30dc753b'}
2025-08-20 08:28:23,503 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSMzVGNkUyQ0ZBRDQ3NjczMkNGAA==",
                "status": "delivered",
                "timestamp": "1755667702",
                "recipient_id": "254745026933",
                "conversation": {
                  "id": "2475bb177ef63cea89c55ea3f9749aca",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:28:23,506 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:28:23,507 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSMzVGNkUyQ0ZBRDQ3NjczMkNGAA==",
      "status": "delivered",
      "timestamp": "1755667702",
      "recipient_id": "254745026933",
      "conversation": {
        "id": "2475bb177ef63cea89c55ea3f9749aca",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:28:23,510 - server - INFO - Message queued for processing
2025-08-20 08:28:23,510 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 08:28:23,561 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 08:28:23,562 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '582', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:a::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=bfc0fd60a7e4252cba89d92db162ccd4d009a8e9', 'x-hub-signature-256': 'sha256=4161e922130efbde1bd0b529bc04234e005e64480933b873abf3ef74ef0cbd1d'}
2025-08-20 08:28:23,562 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSNUVFRkM4QzExMEQ3Q0E5QkRCAA==",
                "status": "delivered",
                "timestamp": "1755667702",
                "recipient_id": "254745026933",
                "conversation": {
                  "id": "5324dd26be1c2466a288d33c11e097ca",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 08:28:23,565 - server - INFO - Entry ID: 648237557784508
2025-08-20 08:28:23,566 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzQ1MDI2OTMzFQIAERgSNUVFRkM4QzExMEQ3Q0E5QkRCAA==",
      "status": "delivered",
      "timestamp": "1755667702",
      "recipient_id": "254745026933",
      "conversation": {
        "id": "5324dd26be1c2466a288d33c11e097ca",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 08:28:23,569 - server - INFO - Message queued for processing
2025-08-20 08:28:23,570 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 09:28:29,336 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 09:28:29,368 - server - INFO - Connected to MongoDB successfully
2025-08-20 09:28:29,372 - server - INFO - Google Sheets client initialized
2025-08-20 09:29:43,436 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 09:29:43,437 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '476', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:8::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=da6fb160a69d256e8c1b153ced2f6faff739c5e3', 'x-hub-signature-256': 'sha256=aa2b0eeeb56239f7b4705994e8784ae55b78ff20eecbfbfba517ccc8fe69f92e'}
2025-08-20 09:29:43,437 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhgWM0VCMDBBN0MwMTg5Qjk3Mzc3QzFCRQA=",
                "timestamp": "1755671381",
                "text": {
                  "body": "hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 09:29:43,439 - server - INFO - Entry ID: 648237557784508
2025-08-20 09:29:43,440 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhgWM0VCMDBBN0MwMTg5Qjk3Mzc3QzFCRQA=",
      "timestamp": "1755671381",
      "text": {
        "body": "hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 09:29:43,442 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhgWM0VCMDBBN0MwMTg5Qjk3Mzc3QzFCRQA=
2025-08-20 09:29:43,442 - server - INFO - From: 254702944890
2025-08-20 09:29:43,443 - server - INFO - Timestamp: 1755671381
2025-08-20 09:29:43,443 - server - INFO - Type: text
2025-08-20 09:29:43,443 - server - INFO - Content: hi
2025-08-20 09:29:43,444 - server - INFO - Message queued for processing
2025-08-20 09:29:43,444 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 09:29:43,446 - server - INFO - Processing message from 254702944890: hi
2025-08-20 09:29:46,094 - server - ERROR - Error generating AI response: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 14
}
]
2025-08-20 09:29:47,828 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 09:29:48,303 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 09:29:48,304 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#10) Application does not have permission for this action","type":"OAuthException","code":10,"error_data":{"messaging_product":"whatsapp","details":"There was a problem with the access token or permissions you are using for the API call."},"fbtrace_id":"AgAMSs7_anDixZx2qGO8rrf"}}
2025-08-20 09:29:48,305 - server - ERROR - Error processing WhatsApp message: 500: WhatsApp send failed: 400 {"error":{"message":"(#10) Application does not have permission for this action","type":"OAuthException","code":10,"error_data":{"messaging_product":"whatsapp","details":"There was a problem with the access token or permissions you are using for the API call."},"fbtrace_id":"AgAMSs7_anDixZx2qGO8rrf"}}
2025-08-20 09:30:59,060 - server - INFO - Loaded environment variables. Webhook token: whatsapp_webhook_2025
2025-08-20 09:30:59,094 - server - INFO - Connected to MongoDB successfully
2025-08-20 09:30:59,098 - server - INFO - Google Sheets client initialized
2025-08-20 09:31:04,337 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 09:31:04,337 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '476', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:71::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=013b574cd9cbb7965c8bb0b15219d4874f646e2f', 'x-hub-signature-256': 'sha256=bdc2f54783e6dff9f25b896c3369b1e9c8814e4b5da16ad4d8dff1a2080aaadb'}
2025-08-20 09:31:04,338 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "contacts": [
              {
                "profile": {
                  "name": "Santa's shop"
                },
                "wa_id": "254702944890"
              }
            ],
            "messages": [
              {
                "from": "254702944890",
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhgWM0VCMEQ2NjI4NkNCQjI4Q0U1RUU5MwA=",
                "timestamp": "1755671463",
                "text": {
                  "body": "hi"
                },
                "type": "text"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 09:31:04,342 - server - INFO - Entry ID: 648237557784508
2025-08-20 09:31:04,342 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "contacts": [
    {
      "profile": {
        "name": "Santa's shop"
      },
      "wa_id": "254702944890"
    }
  ],
  "messages": [
    {
      "from": "254702944890",
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhgWM0VCMEQ2NjI4NkNCQjI4Q0U1RUU5MwA=",
      "timestamp": "1755671463",
      "text": {
        "body": "hi"
      },
      "type": "text"
    }
  ]
}
2025-08-20 09:31:04,344 - server - INFO - Message ID: wamid.HBgMMjU0NzAyOTQ0ODkwFQIAEhgWM0VCMEQ2NjI4NkNCQjI4Q0U1RUU5MwA=
2025-08-20 09:31:04,344 - server - INFO - From: 254702944890
2025-08-20 09:31:04,345 - server - INFO - Timestamp: 1755671463
2025-08-20 09:31:04,346 - server - INFO - Type: text
2025-08-20 09:31:04,346 - server - INFO - Content: hi
2025-08-20 09:31:04,347 - server - INFO - Message queued for processing
2025-08-20 09:31:04,347 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 09:31:04,349 - server - INFO - Processing message from 254702944890: hi
2025-08-20 09:31:05,477 - server - ERROR - Error classifying message: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 54
}
]
2025-08-20 09:31:05,659 - server - ERROR - Error generating AI response: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 54
}
]
2025-08-20 09:31:07,788 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 200 OK"
2025-08-20 09:31:08,382 - httpx - INFO - HTTP Request: POST https://graph.facebook.com/v18.0/764456666746638/messages "HTTP/1.1 400 Bad Request"
2025-08-20 09:31:08,511 - server - ERROR - WhatsApp send failed status=400 body={"error":{"message":"(#10) Application does not have permission for this action","type":"OAuthException","code":10,"error_data":{"messaging_product":"whatsapp","details":"There was a problem with the access token or permissions you are using for the API call."},"fbtrace_id":"AJtU-P2RTnF7_H65aJySXri"}}
2025-08-20 09:31:08,512 - server - ERROR - Error processing WhatsApp message: 500: WhatsApp send failed: 400 {"error":{"message":"(#10) Application does not have permission for this action","type":"OAuthException","code":10,"error_data":{"messaging_product":"whatsapp","details":"There was a problem with the access token or permissions you are using for the API call."},"fbtrace_id":"AJtU-P2RTnF7_H65aJySXri"}}
2025-08-20 09:31:08,748 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 09:31:08,749 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '613', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:21ff:6::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=784eb0a611436b9c9a47b679a37782474d0d3d9b', 'x-hub-signature-256': 'sha256=b683aed01fbb596592cab62217da0632fdbfa2171422a6102321894a287f6bae'}
2025-08-20 09:31:08,750 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMzM1RTg3NjkyMUFGRDk1MzY3AA==",
                "status": "sent",
                "timestamp": "1755671467",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "6804f3537ab3e5b084888b9a201b0cff",
                  "expiration_timestamp": "1755671467",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 09:31:08,753 - server - INFO - Entry ID: 648237557784508
2025-08-20 09:31:08,754 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMzM1RTg3NjkyMUFGRDk1MzY3AA==",
      "status": "sent",
      "timestamp": "1755671467",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "6804f3537ab3e5b084888b9a201b0cff",
        "expiration_timestamp": "1755671467",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 09:31:08,755 - server - INFO - Message queued for processing
2025-08-20 09:31:08,755 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 09:31:08,757 - server - INFO - No messages in webhook
2025-08-20 09:31:10,078 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 09:31:10,078 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '582', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:10ff:4::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=6c875d9c3b8413177bc6eb671dc431bdd8d824c8', 'x-hub-signature-256': 'sha256=f6eb5ad8a38c5da200ad7be5c7517d883b25a58f83be87d7338a4a01b2e1a58c'}
2025-08-20 09:31:10,079 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMzM1RTg3NjkyMUFGRDk1MzY3AA==",
                "status": "delivered",
                "timestamp": "1755671468",
                "recipient_id": "254702944890",
                "conversation": {
                  "id": "6804f3537ab3e5b084888b9a201b0cff",
                  "origin": {
                    "type": "service"
                  }
                },
                "pricing": {
                  "billable": false,
                  "pricing_model": "PMP",
                  "category": "service",
                  "type": "free_customer_service"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 09:31:10,081 - server - INFO - Entry ID: 648237557784508
2025-08-20 09:31:10,081 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMzM1RTg3NjkyMUFGRDk1MzY3AA==",
      "status": "delivered",
      "timestamp": "1755671468",
      "recipient_id": "254702944890",
      "conversation": {
        "id": "6804f3537ab3e5b084888b9a201b0cff",
        "origin": {
          "type": "service"
        }
      },
      "pricing": {
        "billable": false,
        "pricing_model": "PMP",
        "category": "service",
        "type": "free_customer_service"
      }
    }
  ]
}
2025-08-20 09:31:10,083 - server - INFO - Message queued for processing
2025-08-20 09:31:10,083 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 09:31:10,084 - server - INFO - No messages in webhook
2025-08-20 09:32:17,945 - server - INFO - ========== INCOMING WEBHOOK MESSAGE START ==========
2025-08-20 09:32:17,946 - server - INFO - Headers: {'host': 'ce94a285334a.ngrok-free.app', 'user-agent': 'facebookexternalua', 'content-length': '389', 'accept': '*/*', 'accept-encoding': 'deflate, gzip', 'content-type': 'application/json', 'x-forwarded-for': '2a03:2880:22ff:71::', 'x-forwarded-host': 'ce94a285334a.ngrok-free.app', 'x-forwarded-proto': 'https', 'x-hub-signature': 'sha1=24f8cd9f725ac6cdad5cf5a24c0727f7d60e185f', 'x-hub-signature-256': 'sha256=b0afddbe464cb78d3f657d547ec260797f381057f6d75358f7d9ea4353b2fc87'}
2025-08-20 09:32:17,947 - server - INFO - Raw webhook payload: {
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "648237557784508",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15551926618",
              "phone_number_id": "764456666746638"
            },
            "statuses": [
              {
                "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMzM1RTg3NjkyMUFGRDk1MzY3AA==",
                "status": "read",
                "timestamp": "1755671536",
                "recipient_id": "254702944890"
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
2025-08-20 09:32:17,949 - server - INFO - Entry ID: 648237557784508
2025-08-20 09:32:17,949 - server - INFO - Change Value: {
  "messaging_product": "whatsapp",
  "metadata": {
    "display_phone_number": "15551926618",
    "phone_number_id": "764456666746638"
  },
  "statuses": [
    {
      "id": "wamid.HBgMMjU0NzAyOTQ0ODkwFQIAERgSMzM1RTg3NjkyMUFGRDk1MzY3AA==",
      "status": "read",
      "timestamp": "1755671536",
      "recipient_id": "254702944890"
    }
  ]
}
2025-08-20 09:32:17,950 - server - INFO - Message queued for processing
2025-08-20 09:32:17,951 - server - INFO - ========== INCOMING WEBHOOK MESSAGE END ==========
2025-08-20 09:32:17,952 - server - INFO - No messages in webhook
